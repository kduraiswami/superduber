(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Buffer(t){t?(this.array=t.array,this.pos=t.pos):(this.array=new ArrayBuffer(this.defaultLength),this.length=this.defaultLength,this.setupViews())}module.exports=Buffer,Buffer.prototype={pos:0,itemSize:4,defaultLength:8192,arrayType:"ARRAY_BUFFER",get index(){return this.pos/this.itemSize},setupViews:function(){this.ubytes=new Uint8Array(this.array),this.bytes=new Int8Array(this.array),this.ushorts=new Uint16Array(this.array),this.shorts=new Int16Array(this.array)},bind:function(t){var e=t[this.arrayType];this.buffer?t.bindBuffer(e,this.buffer):(this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.array.slice(0,this.pos),t.STATIC_DRAW),this.array=null)},destroy:function(t){this.buffer&&t.deleteBuffer(this.buffer)},resize:function(){if(this.length<this.pos+this.itemSize){for(;this.length<this.pos+this.itemSize;)this.length=2*Math.round(1.5*this.length/2);this.array=new ArrayBuffer(this.length);var t=new Uint8Array(this.array);t.set(this.ubytes),this.setupViews()}}};
},{}],2:[function(require,module,exports){
"use strict";var LineVertexBuffer=require("./line_vertex_buffer"),LineElementBuffer=require("./line_element_buffer"),FillVertexBuffer=require("./fill_vertex_buffer"),FillElementBuffer=require("./fill_elements_buffer"),OutlineElementBuffer=require("./outline_elements_buffer"),GlyphVertexBuffer=require("./glyph_vertex_buffer"),IconVertexBuffer=require("./icon_vertex_buffer");module.exports=function(e){return e=e||{},{glyphVertex:new GlyphVertexBuffer(e.glyphVertex),iconVertex:new IconVertexBuffer(e.iconVertex),fillVertex:new FillVertexBuffer(e.fillVertex),fillElement:new FillElementBuffer(e.fillElement),outlineElement:new OutlineElementBuffer(e.outlineElement),lineVertex:new LineVertexBuffer(e.lineVertex),lineElement:new LineElementBuffer(e.lineElement)}};
},{"./fill_elements_buffer":3,"./fill_vertex_buffer":4,"./glyph_vertex_buffer":5,"./icon_vertex_buffer":6,"./line_element_buffer":7,"./line_vertex_buffer":8,"./outline_elements_buffer":9}],3:[function(require,module,exports){
"use strict";function FillElementsBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=FillElementsBuffer,FillElementsBuffer.prototype=util.inherit(Buffer,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(e,t,i){var r=this.pos/2;this.resize(),this.ushorts[r+0]=e,this.ushorts[r+1]=t,this.ushorts[r+2]=i,this.pos+=this.itemSize}});
},{"../../util/util":90,"./buffer":1}],4:[function(require,module,exports){
"use strict";function FillVertexBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=FillVertexBuffer,FillVertexBuffer.prototype=util.inherit(Buffer,{itemSize:4,add:function(e,i){var t=this.pos/2;this.resize(),this.shorts[t+0]=e,this.shorts[t+1]=i,this.pos+=this.itemSize}});
},{"../../util/util":90,"./buffer":1}],5:[function(require,module,exports){
"use strict";function GlyphVertexBuffer(t){Buffer.call(this,t)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=GlyphVertexBuffer,GlyphVertexBuffer.angleFactor=128/Math.PI,GlyphVertexBuffer.prototype=util.inherit(Buffer,{defaultLength:32768,itemSize:16,add:function(t,e,r,i,h,s,o,u,a,f,n){var l=this.pos,b=l/2,y=GlyphVertexBuffer.angleFactor;this.resize(),this.shorts[b+0]=t,this.shorts[b+1]=e,this.shorts[b+2]=Math.round(64*r),this.shorts[b+3]=Math.round(64*i),this.ubytes[l+8]=Math.floor(h/4),this.ubytes[l+9]=Math.floor(s/4),this.ubytes[l+10]=Math.floor(10*n),this.ubytes[l+11]=Math.round(o*y)%256,this.ubytes[l+12]=Math.floor(10*u),this.ubytes[l+13]=Math.floor(10*Math.min(f,25)),this.ubytes[l+14]=Math.max(Math.round(a[0]*y),0)%256,this.ubytes[l+15]=Math.min(Math.round(a[1]*y),255)%256,this.pos+=this.itemSize},bind:function(t,e){Buffer.prototype.bind.call(this,t);var r=this.itemSize;t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,r,0),t.vertexAttribPointer(e.a_offset,2,t.SHORT,!1,r,4),t.vertexAttribPointer(e.a_data1,4,t.UNSIGNED_BYTE,!1,r,8),t.vertexAttribPointer(e.a_data2,4,t.UNSIGNED_BYTE,!1,r,12)}});
},{"../../util/util":90,"./buffer":1}],6:[function(require,module,exports){
"use strict";function GlyphVertexBuffer(t){Buffer.call(this,t)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=GlyphVertexBuffer,GlyphVertexBuffer.angleFactor=128/Math.PI,GlyphVertexBuffer.prototype=util.inherit(Buffer,{defaultLength:32768,itemSize:16,add:function(t,e,r,i,s,h,u,o,a,f,n){var l=this.pos,b=l/2,y=GlyphVertexBuffer.angleFactor;this.resize(),this.shorts[b+0]=t,this.shorts[b+1]=e,this.shorts[b+2]=Math.round(64*r),this.shorts[b+3]=Math.round(64*i),this.ubytes[l+8]=s/4,this.ubytes[l+9]=h/4,this.ubytes[l+10]=Math.floor(10*(n||0)),this.ubytes[l+11]=Math.round(u*y)%256,this.ubytes[l+12]=Math.floor(10*(o||0)),this.ubytes[l+13]=Math.floor(10*Math.min(f||25,25)),this.ubytes[l+14]=Math.max(Math.round(a[0]*y),0)%256,this.ubytes[l+15]=Math.min(Math.round(a[1]*y),255)%256,this.pos+=this.itemSize},bind:function(t,e){Buffer.prototype.bind.call(this,t);var r=this.itemSize;t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,r,0),t.vertexAttribPointer(e.a_offset,2,t.SHORT,!1,r,4),t.vertexAttribPointer(e.a_data1,4,t.UNSIGNED_BYTE,!1,r,8),t.vertexAttribPointer(e.a_data2,4,t.UNSIGNED_BYTE,!1,r,12)}});
},{"../../util/util":90,"./buffer":1}],7:[function(require,module,exports){
"use strict";function LineElementBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=LineElementBuffer,LineElementBuffer.prototype=util.inherit(Buffer,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(e,t,i){var r=this.pos/2;this.resize(),this.ushorts[r+0]=e,this.ushorts[r+1]=t,this.ushorts[r+2]=i,this.pos+=this.itemSize}});
},{"../../util/util":90,"./buffer":1}],8:[function(require,module,exports){
"use strict";function LineVertexBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=LineVertexBuffer,LineVertexBuffer.extrudeScale=63,LineVertexBuffer.prototype=util.inherit(Buffer,{itemSize:8,defaultLength:32768,add:function(e,t,r,i,s){var u=this.pos,f=u/2,h=this.index,o=LineVertexBuffer.extrudeScale;return this.resize(),this.shorts[f+0]=2*Math.floor(e.x)|r,this.shorts[f+1]=2*Math.floor(e.y)|i,this.bytes[u+4]=Math.round(o*t.x),this.bytes[u+5]=Math.round(o*t.y),this.bytes[u+6]=(s||0)/128,this.bytes[u+7]=(s||0)%128,this.pos+=this.itemSize,h}});
},{"../../util/util":90,"./buffer":1}],9:[function(require,module,exports){
"use strict";function OutlineElementsBuffer(e){Buffer.call(this,e)}var util=require("../../util/util"),Buffer=require("./buffer");module.exports=OutlineElementsBuffer,OutlineElementsBuffer.prototype=util.inherit(Buffer,{itemSize:4,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(e,t){var i=this.pos/2;this.resize(),this.ushorts[i+0]=e,this.ushorts[i+1]=t,this.pos+=this.itemSize}});
},{"../../util/util":90,"./buffer":1}],10:[function(require,module,exports){
"use strict";function createBucket(e,t,r,l,i){var o=new StyleDeclarationSet("layout",e.type,e.layout,{}).values(),u={lastIntegerZoom:1/0,lastIntegerZoomTime:0,lastZoom:0},a={};for(var c in o)a[c]=o[c].calculate(l,u);var y="line"===e.type?LineBucket:"fill"===e.type?FillBucket:"symbol"===e.type?SymbolBucket:null,n=new y(t,new LayoutProperties[e.type](a),r,i);return n.id=e.id,n.type=e.type,n["source-layer"]=e["source-layer"],n.interactive=e.interactive,n.minZoom=e.minzoom,n.maxZoom=e.maxzoom,n.filter=featureFilter(e.filter),n.features=[],n}module.exports=createBucket;var LineBucket=require("./line_bucket"),FillBucket=require("./fill_bucket"),SymbolBucket=require("./symbol_bucket"),LayoutProperties=require("../style/layout_properties"),featureFilter=require("feature-filter"),StyleDeclarationSet=require("../style/style_declaration_set");
},{"../style/layout_properties":46,"../style/style_declaration_set":52,"./fill_bucket":13,"./line_bucket":14,"./symbol_bucket":15,"feature-filter":92}],11:[function(require,module,exports){
"use strict";function ElementGroups(e,t,n){this.vertexBuffer=e,this.elementBuffer=t,this.secondElementBuffer=n,this.groups=[]}function ElementGroup(e,t,n){this.vertexStartIndex=e,this.elementStartIndex=t,this.secondElementStartIndex=n,this.elementLength=0,this.vertexLength=0,this.secondElementLength=0}module.exports=ElementGroups,ElementGroups.prototype.makeRoomFor=function(e){(!this.current||this.current.vertexLength+e>65535)&&(this.current=new ElementGroup(this.vertexBuffer.index,this.elementBuffer&&this.elementBuffer.index,this.secondElementBuffer&&this.secondElementBuffer.index),this.groups.push(this.current))};
},{}],12:[function(require,module,exports){
"use strict";function FeatureTree(t){this.coord=TileCoord.fromID(t),this.rtree=rbush(9),this.toBeInserted=[]}function geometryContainsPoint(t,e,r,o){return"Point"===e?pointContainsPoint(t,r,o):"LineString"===e?lineContainsPoint(t,r,o):"Polygon"===e?polyContainsPoint(t,r)||lineContainsPoint(t,r,o):!1}function distToSegmentSquared(t,e,r){var o=e.distSqr(r);if(0===o)return t.distSqr(e);var n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/o;return t.distSqr(0>n?e:n>1?r:r.sub(e)._mult(n)._add(e))}function lineContainsPoint(t,e,r){for(var o=r*r,n=0;n<t.length;n++)for(var i=t[n],s=1;s<i.length;s++){var u=i[s-1],a=i[s];if(distToSegmentSquared(e,u,a)<o)return!0}return!1}function polyContainsPoint(t,e){for(var r,o,n,i=!1,s=0;s<t.length;s++){r=t[s];for(var u=0,a=r.length-1;u<r.length;a=u++)o=r[u],n=r[a],o.y>e.y!=n.y>e.y&&e.x<(n.x-o.x)*(e.y-o.y)/(n.y-o.y)+o.x&&(i=!i)}return i}function pointContainsPoint(t,e,r){for(var o=r*r,n=0;n<t.length;n++)for(var i=t[n],s=0;s<i.length;s++)if(i[s].distSqr(e)<=o)return!0;return!1}var rbush=require("rbush"),Point=require("point-geometry"),vt=require("vector-tile"),util=require("../util/util"),TileCoord=require("../source/tile_coord");module.exports=FeatureTree,FeatureTree.prototype.insert=function(t,e,r){t.layers=e,t.feature=r,this.toBeInserted.push(t)},FeatureTree.prototype._load=function(){this.rtree.load(this.toBeInserted),this.toBeInserted=[]},FeatureTree.prototype.query=function(t,e){this.toBeInserted.length&&this._load();for(var r=t.params||{},o=4096*(r.radius||0)/t.scale,n=t.x,i=t.y,s=[],u=this.rtree.search([n-o,i-o,n+o,i+o]),a=0;a<u.length;a++){var l=u[a].feature,y=u[a].layers,d=vt.VectorTileFeature.types[l.type];if((!r.$type||d===r.$type)&&geometryContainsPoint(l.loadGeometry(),d,new Point(n,i),o))for(var h=l.toGeoJSON(this.coord.x,this.coord.y,this.coord.z),f=0;f<y.length;f++){var c=y[f];r.layer&&c!==r.layer.id||s.push(util.extend({layer:c},h))}}e(null,s)};
},{"../source/tile_coord":38,"../util/util":90,"point-geometry":104,"rbush":105,"vector-tile":107}],13:[function(require,module,exports){
"use strict";function FillBucket(e){this.buffers=e,this.elementGroups=new ElementGroups(e.fillVertex,e.fillElement,e.outlineElement)}var ElementGroups=require("./element_groups");module.exports=FillBucket,FillBucket.prototype.addFeatures=function(){for(var e=this.features,t=0;t<e.length;t++){var l=e[t];this.addFeature(l.loadGeometry())}},FillBucket.prototype.addFeature=function(e){for(var t=0;t<e.length;t++)this.addFill(e[t])},FillBucket.prototype.addFill=function(e){if(!(e.length<3)){var t=e.length;this.elementGroups.makeRoomFor(t+1);var l=this.elementGroups.current,r=this.buffers.fillVertex,n=this.buffers.fillElement,i=this.buffers.outlineElement;l.vertexLength++;for(var o,u,s,a=r.index-l.vertexStartIndex,d=0;d<e.length;d++)u=r.index-l.vertexStartIndex,s=e[d],r.add(s.x,s.y),l.vertexLength++,d>=2&&(s.x!==e[0].x||s.y!==e[0].y)&&(n.add(a,o,u),l.elementLength++),d>=1&&(i.add(o,u),l.secondElementLength++),o=u}};
},{"./element_groups":11}],14:[function(require,module,exports){
"use strict";function LineBucket(e,t,r,i){this.buffers=e,this.elementGroups=new ElementGroups(e.lineVertex,e.lineElement),this.layoutProperties=t,this.overscaling=i}var ElementGroups=require("./element_groups");module.exports=LineBucket,LineBucket.prototype.addFeatures=function(){for(var e=this.features,t=0;t<e.length;t++){var r=e[t];this.addFeature(r.loadGeometry())}},LineBucket.prototype.addFeature=function(e){for(var t=this.layoutProperties,r=0;r<e.length;r++)this.addLine(e[r],t["line-join"],t["line-cap"],t["line-miter-limit"],t["line-round-limit"])},LineBucket.prototype.addLine=function(e,t,r,i,n){function l(e,t,r,i){var n,l=i?1:0;n=e.mult(q),t&&n._sub(e.perp()._mult(t)),y=d.add(f,n,l,0,G)-v,g>=0&&x>=0&&(m.add(g,x,y),p.elementLength++),g=x,x=y,n=e.mult(-q),r&&n._sub(e.perp()._mult(r)),y=d.add(f,n,l,1,G)-v,g>=0&&x>=0&&(m.add(g,x,y),p.elementLength++),g=x,x=y,p.vertexLength+=2}for(var u=e.length;u>2&&e[u-1].equals(e[u-2]);)u--;if(!(e.length<2)){"bevel"===t&&(i=1.05);var s=e[0],a=e[u-1],o=s.equals(a),d=this.buffers.lineVertex,m=this.buffers.lineElement;this.elementGroups.makeRoomFor(4*u);var p=this.elementGroups.current,v=p.vertexStartIndex;if(2!==u||!o){var f,h,b,c,_,g,x,y,L=r,k=o?"butt":r,q=1,G=0;o&&(f=e[u-2],_=s.sub(f)._unit()._perp());for(var B=0;u>B;B++)if(b=o&&B===u-1?e[1]:e[B+1],!b||!e[B].equals(b)){_&&(c=_),f&&(h=f),f=e[B],h&&(G+=f.dist(h)*this.overscaling),_=b?b.sub(f)._unit()._perp():c,c=c||_;var E=c.add(_)._unit(),F=E.x*_.x+E.y*_.y,P=1/F,V=void 0===g||void 0===x,j=h&&b,w=j?t:b?L:k;if(j&&"round"===w&&n>P&&(w="miter"),"miter"===w&&P>i&&(w="bevel"),"bevel"===w&&(P>4&&(w="flipbevel"),i>P&&(w="miter")),"miter"===w)E._mult(P),l(E,0,0,!1);else if("flipbevel"===w){if(P>100)q=-q,E=_;else{var I=P*c.add(_).mag()/c.sub(_).mag();E._perp()._mult(q*I),q=-q}l(E,0,0,!1)}else{var M,R;if("bevel"===w){var S=c.x*_.y-c.y*_.x,z=-Math.sqrt(P*P-1);q*S>0?(R=0,M=z):(M=0,R=z)}else M=R="square"===w?1:0;V||l(c,M,R,!1),V||"round"!==w||l(c,1,1,!0),(V||"bevel"!==w)&&(g=x=-1,q=1),V&&"round"===L&&l(_,-1,-1,!0),b&&l(_,-M,-R,!1)}}}}};
},{"./element_groups":11}],15:[function(require,module,exports){
"use strict";function SymbolBucket(e,t,o){this.buffers=e,this.elementGroups={text:new ElementGroups(e.glyphVertex),icon:new ElementGroups(e.iconVertex)},this.layoutProperties=t,this.collision=o}function byScale(e,t){return e.scale-t.scale}var ElementGroups=require("./element_groups"),Anchor=require("../symbol/anchor"),interpolate=require("../symbol/interpolate"),Point=require("point-geometry"),resolveTokens=require("../util/token"),Placement=require("../symbol/placement"),Shaping=require("../symbol/shaping"),resolveText=require("../symbol/resolve_text"),resolveIcons=require("../symbol/resolve_icons"),mergeLines=require("../symbol/mergelines");module.exports=SymbolBucket;var fullRange=[2*Math.PI,0];SymbolBucket.prototype.addFeatures=function(){var e=this.layoutProperties,t=this.features,o=this.textFeatures,s=.5,i=.5;switch(e["text-anchor"]){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(e["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}var a=.5;"right"===e["text-justify"]?a=1:"left"===e["text-justify"]&&(a=0);var n,r=24,l=e["text-line-height"]*r,c="line"!==e["symbol-placement"]&&e["text-max-width"]*r,h=e["text-letter-spacing"]*r,m=e["text-font"],x=[e["text-offset"][0]*r,e["text-offset"][1]*r],p=[];for(n=0;n<t.length;n++)p.push(t[n].loadGeometry());if("line"===e["symbol-placement"]){var u=mergeLines(t,o,p);p=u.geometries,t=u.features,o=u.textFeatures}for(n=0;n<t.length;n++)if(p[n]){var y=!1;o[n]&&(y=Shaping.shape(o[n],m,this.stacks,c,l,s,i,a,h,x));var g=!1;this.icons&&e["icon-image"]&&(g=this.icons[resolveTokens(t[n].properties,e["icon-image"])],g&&("undefined"==typeof this.elementGroups.sdfIcons?this.elementGroups.sdfIcons=g.sdf:this.elementGroups.sdfIcons!==g.sdf&&console.warn("Style sheet warning: Cannot mix SDF and non-SDF icons in one bucket"))),(y||g)&&this.addFeature(p[n],this.stacks,y,g)}},SymbolBucket.prototype.addFeature=function(e,t,o,s){for(var i=this.layoutProperties,a=this.collision,n=.5,r=24,l="viewport"===i["text-rotation-alignment"],c="viewport"===i["icon-rotation-alignment"],h=i["text-max-size"]/r,m=a.tilePixelRatio*h,x=a.tilePixelRatio*i["icon-max-size"],p=i["text-optional"]||!o,u=i["icon-optional"]||!s,y=i["symbol-avoid-edges"],g=0;g<e.length;g++){var f,d=e[g];if("line"===i["symbol-placement"]){var v=0,b=0;if(o){for(var S=1/0,k=-1/0,P=0;P<o.length;P++)S=Math.min(S,o[P].x),k=Math.max(k,o[P].x);var w=k-S;b=(w/2+2*r)*h}f=interpolate(d,i["symbol-min-distance"],n,a.maxPlacementScale,a.tilePixelRatio,Math.max(b,v)),f.sort(byScale)}else f=[new Anchor(d[0].x,d[0].y,0,n)];for(var M=new Point(0,-17),G=0,q=f.length;q>G;G++){var F=f[G],I=!(F.x<0||F.x>4096||F.y<0||F.y>4096);if(!y||I){var R,B,D=null,L=null;if((!o||(R=Placement.getGlyphs(F,M,o,t,m,l,d,i),D=i["text-allow-overlap"]?R.minScale:a.getPlacementScale(R.boxes,R.minScale,y),D||p))&&(!s||(B=Placement.getIcon(F,s,x,d,i),L=i["icon-allow-overlap"]?B.minScale:a.getPlacementScale(B.boxes,B.minScale,y),L||u))){p||u?!u&&D?D=Math.max(L,D):!p&&L&&(L=Math.max(L,D)):L=D=Math.max(L,D);var T=!D||i["text-allow-overlap"]?fullRange:a.getPlacementRange(R.boxes,D,l),V=!L||i["icon-allow-overlap"]?fullRange:a.getPlacementRange(B.boxes,L,c),z=[Math.min(V[0],T[0]),Math.max(V[1],T[1])];p||u?u?p||(V=z):T=z:V=T=z,D&&(i["text-ignore-placement"]||a.insert(R.boxes,F,D,T,l),I&&this.addSymbols(this.buffers.glyphVertex,this.elementGroups.text,R.shapes,D,T)),L&&(i["icon-ignore-placement"]||a.insert(B.boxes,F,L,V,c),I&&this.addSymbols(this.buffers.iconVertex,this.elementGroups.icon,B.shapes,L,V))}}}}},SymbolBucket.prototype.addSymbols=function(e,t,o,s,i){var a=this.collision.zoom;t.makeRoomFor(0);for(var n=t.current,r=Math.log(s)/Math.LN2+a,l=0;l<o.length;l++){var c=o[l],h=c.tl,m=c.tr,x=c.bl,p=c.br,u=c.tex,y=c.angle,g=c.anchor,f=Math.max(a+Math.log(c.minScale)/Math.LN2,r),d=Math.min(a+Math.log(c.maxScale)/Math.LN2,25);f>=d||(f===r&&(f=0),e.add(g.x,g.y,h.x,h.y,u.x,u.y,y,f,i,d,r),e.add(g.x,g.y,m.x,m.y,u.x+u.w,u.y,y,f,i,d,r),e.add(g.x,g.y,x.x,x.y,u.x,u.y+u.h,y,f,i,d,r),e.add(g.x,g.y,m.x,m.y,u.x+u.w,u.y,y,f,i,d,r),e.add(g.x,g.y,x.x,x.y,u.x,u.y+u.h,y,f,i,d,r),e.add(g.x,g.y,p.x,p.y,u.x+u.w,u.y+u.h,y,f,i,d,r),n.vertexLength+=6)}},SymbolBucket.prototype.getDependencies=function(e,t,o){function s(e){(e||i)&&o(e),i=!0}var i=!1;this.getTextDependencies(e,t,s),this.getIconDependencies(e,t,s)},SymbolBucket.prototype.getIconDependencies=function(e,t,o){if(this.layoutProperties["icon-image"]){var s=this.features,i=this.layoutProperties,a=resolveIcons(s,i);a.length?t.send("get icons",{icons:a},function(e,t){return e?o(e):(this.icons=t,void o())}.bind(this)):o()}else o()},SymbolBucket.prototype.getTextDependencies=function(e,t,o){var s=this.features,i=this.layoutProperties;void 0===e.stacks&&(e.stacks={});var a=this.stacks=e.stacks,n=i["text-font"];void 0===a[n]&&(a[n]={glyphs:{},rects:{}});var r=a[n],l=resolveText(s,i,r.glyphs);this.textFeatures=l.textFeatures,t.send("get glyphs",{uid:e.uid,fontstack:n,codepoints:l.codepoints},function(e,t){if(e)return o(e);var s=t.glyphs,i=t.rects,a=r.glyphs,n=r.rects;for(var l in s)a[l]=s[l],n[l]=i[l];o()})};
},{"../symbol/anchor":55,"../symbol/interpolate":60,"../symbol/mergelines":61,"../symbol/placement":62,"../symbol/resolve_icons":63,"../symbol/resolve_text":64,"../symbol/shaping":66,"../util/token":89,"./element_groups":11,"point-geometry":104}],16:[function(require,module,exports){
"use strict";function LatLng(t,n){if(isNaN(t)||isNaN(n))throw new Error("Invalid LatLng object: ("+t+", "+n+")");this.lat=+t,this.lng=+n}module.exports=LatLng;var wrap=require("../util/util").wrap;LatLng.prototype.wrap=function(){return new LatLng(this.lat,wrap(this.lng,-180,180))},LatLng.convert=function(t){return t instanceof LatLng?t:Array.isArray(t)?new LatLng(t[0],t[1]):t};
},{"../util/util":90}],17:[function(require,module,exports){
"use strict";function LatLngBounds(t,n){if(t)for(var e=n?[t,n]:t,s=0,i=e.length;i>s;s++)this.extend(e[s])}module.exports=LatLngBounds;var LatLng=require("./lat_lng");LatLngBounds.prototype={extend:function(t){var n,e,s=this._sw,i=this._ne;if(t instanceof LatLng)n=t,e=t;else{if(!(t instanceof LatLngBounds))return t?this.extend(LatLng.convert(t)||LatLngBounds.convert(t)):this;if(n=t._sw,e=t._ne,!n||!e)return this}return s||i?(s.lat=Math.min(n.lat,s.lat),s.lng=Math.min(n.lng,s.lng),i.lat=Math.max(e.lat,i.lat),i.lng=Math.max(e.lng,i.lng)):(this._sw=new LatLng(n.lat,n.lng),this._ne=new LatLng(e.lat,e.lng)),this},getCenter:function(){return new LatLng((this._sw.lat+this._ne.lat)/2,(this._sw.lng+this._ne.lng)/2)},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},getNorthWest:function(){return new LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._sw.lng},getSouth:function(){return this._sw.lat},getEast:function(){return this._ne.lng},getNorth:function(){return this._ne.lat}},LatLngBounds.convert=function(t){return!t||t instanceof LatLngBounds?t:new LatLngBounds(t)};
},{"./lat_lng":16}],18:[function(require,module,exports){
"use strict";function Transform(t,i){this.tileSize=512,this._minZoom=t||0,this._maxZoom=i||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this.zoom=0,this.center=new LatLng(0,0),this.angle=0}var LatLng=require("./lat_lng"),Point=require("point-geometry"),wrap=require("../util/util").wrap;module.exports=Transform,Transform.prototype={get minZoom(){return this._minZoom},set minZoom(t){this._minZoom=t,this.zoom=Math.max(this.zoom,t)},get maxZoom(){return this._maxZoom},set maxZoom(t){this._maxZoom=t,this.zoom=Math.min(this.zoom,t)},get worldSize(){return this.tileSize*this.scale},get centerPoint(){return this.size._div(2)},get size(){return new Point(this.width,this.height)},get bearing(){return-this.angle/Math.PI*180},set bearing(t){this.angle=-wrap(t,-180,180)*Math.PI/180},get zoom(){return this._zoom},set zoom(t){t=Math.min(Math.max(t,this.minZoom),this.maxZoom),this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain()},zoomScale:function(t){return Math.pow(2,t)},scaleZoom:function(t){return Math.log(t)/Math.LN2},project:function(t,i){return new Point(this.lngX(t.lng,i),this.latY(t.lat,i))},unproject:function(t,i){return new LatLng(this.yLat(t.y,i),this.xLng(t.x,i))},get x(){return this.lngX(this.center.lng)},get y(){return this.latY(this.center.lat)},get point(){return new Point(this.x,this.y)},lngX:function(t,i){return(180+t)*(i||this.worldSize)/360},latY:function(t,i){var n=180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360));return(180-n)*(i||this.worldSize)/360},xLng:function(t,i){return 360*t/(i||this.worldSize)-180},yLat:function(t,i){var n=180-360*t/(i||this.worldSize);return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90},panBy:function(t){var i=this.centerPoint._add(t);this.center=this.pointLocation(i),this._constrain()},setZoomAround:function(t,i){var n=this.locationPoint(i),o=this.size._sub(n),e=this.pointLocation(o);this.zoom=t,this.panBy(o.sub(this.locationPoint(e)))},setBearingAround:function(t,i){var n=this.locationPoint(i).sub(this.centerPoint);this.panBy(n),this.bearing=t,this.panBy(n.mult(-1))},locationPoint:function(t){var i=this.project(t);return this.centerPoint._sub(this.point._sub(i)._rotate(this.angle))},pointLocation:function(t){var i=this.centerPoint._sub(t)._rotate(-this.angle);return this.unproject(this.point.sub(i))},locationCoordinate:function(t){var i=this.zoomScale(this.tileZoom)/this.worldSize;return{column:this.lngX(t.lng)*i,row:this.latY(t.lat)*i,zoom:this.tileZoom}},pointCoordinate:function(t,i){var n=this.zoomScale(this.zoomFraction),o=this.zoomScale(this.tileZoom-t.zoom),e=this.centerPoint._sub(i)._rotate(-this.angle)._div(this.tileSize*n);return{column:t.column*o-e.x,row:t.row*o-e.y,zoom:this.tileZoom}},_constrain:function(){if(this.center){var t,i,n,o,e,s,h,r,a=this.size;this.latRange&&(t=this.latY(this.latRange[1]),i=this.latY(this.latRange[0]),e=i-t<a.y?a.y/(i-t):0),this.lngRange&&(n=this.lngX(this.lngRange[0]),o=this.lngX(this.lngRange[1]),s=o-n<a.x?a.x/(o-n):0);var c=Math.max(s||0,e||0);if(c)return this.center=this.unproject(new Point(s?(o+n)/2:this.x,e?(i+t)/2:this.y)),void(this.zoom+=this.scaleZoom(c));if(this.latRange){var u=this.y,l=a.y/2;t>u-l&&(r=t+l),u+l>i&&(r=i-l)}if(this.lngRange){var m=this.x,g=a.x/2;n>m-g&&(h=n+g),m+g>o&&(h=o-g)}(void 0!==h||void 0!==r)&&(this.center=this.unproject(new Point(void 0!==h?h:this.x,void 0!==r?r:this.y)))}}};
},{"../util/util":90,"./lat_lng":16,"point-geometry":104}],19:[function(require,module,exports){
"use strict";var simplexFont={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};module.exports=function(l,n,t,e){e=e||1;var r,o,u,s,i,x,f,p,h=[];for(r=0,o=l.length;o>r;r++)if(i=simplexFont[l[r]]){for(p=null,u=0,s=i[1].length;s>u;u+=2)-1===i[1][u]&&-1===i[1][u+1]?p=null:(x=n+i[1][u]*e,f=t-i[1][u+1]*e,p&&h.push(p.x,p.y,x,f),p={x:x,y:f});n+=i[0]*e}return h};
},{}],20:[function(require,module,exports){
"use strict";if("undefined"==typeof window)new(require("./source/worker"))(self);else{var mapboxgl=module.exports=window.mapboxgl={};mapboxgl.Map=require("./ui/map"),mapboxgl.Navigation=require("./ui/control/navigation"),mapboxgl.Attribution=require("./ui/control/attribution"),mapboxgl.Popup=require("./ui/popup"),mapboxgl.Source=require("./source/source"),mapboxgl.GeoJSONSource=require("./source/geojson_source"),mapboxgl.VideoSource=require("./source/video_source"),mapboxgl.Style=require("./style/style"),mapboxgl.LatLng=require("./geo/lat_lng"),mapboxgl.LatLngBounds=require("./geo/lat_lng_bounds"),mapboxgl.Point=require("point-geometry"),mapboxgl.Evented=require("./util/evented"),mapboxgl.util=require("./util/util");var browser=require("./util/browser");mapboxgl.util.supported=browser.supported;var ajax=require("./util/ajax");mapboxgl.util.getJSON=ajax.getJSON,mapboxgl.util.getArrayBuffer=ajax.getArrayBuffer;var config=require("./util/config");mapboxgl.config=config,Object.defineProperty(mapboxgl,"accessToken",{get:function(){return config.ACCESS_TOKEN},set:function(e){config.ACCESS_TOKEN=e}})}
},{"./geo/lat_lng":16,"./geo/lat_lng_bounds":17,"./source/geojson_source":33,"./source/source":36,"./source/video_source":41,"./source/worker":42,"./style/style":49,"./ui/control/attribution":68,"./ui/control/navigation":70,"./ui/map":75,"./ui/popup":76,"./util/ajax":78,"./util/browser":79,"./util/config":83,"./util/evented":84,"./util/util":90,"point-geometry":104}],21:[function(require,module,exports){
"use strict";function drawBackground(t,a,r){var e,i=t.gl,o=a.paint["background-color"],n=a.paint["background-image"],l=a.paint["background-opacity"],u=n?t.spriteAtlas.getPosition(n.from,!0):null,m=n?t.spriteAtlas.getPosition(n.to,!0):null;if(u&&m){e=t.patternShader,i.switchShader(e,r),i.uniform1i(e.u_image,0),i.uniform2fv(e.u_pattern_tl_a,u.tl),i.uniform2fv(e.u_pattern_br_a,u.br),i.uniform2fv(e.u_pattern_tl_b,m.tl),i.uniform2fv(e.u_pattern_br_b,m.br),i.uniform1f(e.u_opacity,l);var c=t.transform,f=u.size,s=m.size,_=c.locationCoordinate(c.center),S=1/Math.pow(2,c.zoomFraction);i.uniform1f(e.u_mix,n.t);var d=mat3.create();mat3.scale(d,d,[1/(f[0]*n.fromScale),1/(f[1]*n.fromScale)]),mat3.translate(d,d,[_.column*c.tileSize%(f[0]*n.fromScale),_.row*c.tileSize%(f[1]*n.fromScale)]),mat3.rotate(d,d,-c.angle),mat3.scale(d,d,[S*c.width/2,-S*c.height/2]);var b=mat3.create();mat3.scale(b,b,[1/(s[0]*n.toScale),1/(s[1]*n.toScale)]),mat3.translate(b,b,[_.column*c.tileSize%(s[0]*n.toScale),_.row*c.tileSize%(s[1]*n.toScale)]),mat3.rotate(b,b,-c.angle),mat3.scale(b,b,[S*c.width/2,-S*c.height/2]),i.uniformMatrix3fv(e.u_patternmatrix_a,!1,d),i.uniformMatrix3fv(e.u_patternmatrix_b,!1,b),t.spriteAtlas.bind(i,!0)}else e=t.fillShader,i.switchShader(e,r),i.uniform4fv(e.u_color,o);i.disable(i.STENCIL_TEST),i.bindBuffer(i.ARRAY_BUFFER,t.backgroundBuffer),i.vertexAttribPointer(e.a_pos,t.backgroundBuffer.itemSize,i.SHORT,!1,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,t.backgroundBuffer.itemCount),i.enable(i.STENCIL_TEST),i.stencilMask(0),i.stencilFunc(i.EQUAL,128,128)}var mat3=require("gl-matrix").mat3;module.exports=drawBackground;
},{"gl-matrix":98}],22:[function(require,module,exports){
"use strict";function drawDebug(e,r){var i=e.gl,t=TileCoord.fromID(r.id);i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.switchShader(e.debugShader,r.posMatrix),i.bindBuffer(i.ARRAY_BUFFER,e.debugBuffer),i.vertexAttribPointer(e.debugShader.a_pos,e.debugBuffer.itemSize,i.SHORT,!1,0,0),i.uniform4f(e.debugShader.u_color,1,0,0,1),i.lineWidth(4),i.drawArrays(i.LINE_STRIP,0,e.debugBuffer.itemCount);var u=t.z+"/"+t.x+"/"+t.y,d=textVertices(u,50,200,5);i.bindBuffer(i.ARRAY_BUFFER,e.debugTextBuffer),i.bufferData(i.ARRAY_BUFFER,new Int16Array(d),i.STREAM_DRAW),i.vertexAttribPointer(e.debugShader.a_pos,e.debugTextBuffer.itemSize,i.SHORT,!1,0,0),i.lineWidth(8*browser.devicePixelRatio),i.uniform4f(e.debugShader.u_color,1,1,1,1),i.drawArrays(i.LINES,0,d.length/e.debugTextBuffer.itemSize),i.lineWidth(2*browser.devicePixelRatio),i.uniform4f(e.debugShader.u_color,0,0,0,1),i.drawArrays(i.LINES,0,d.length/e.debugTextBuffer.itemSize),i.blendFunc(i.ONE_MINUS_DST_ALPHA,i.ONE)}var textVertices=require("../lib/debugtext"),browser=require("../util/browser"),TileCoord=require("../source/tile_coord");module.exports=drawDebug;
},{"../lib/debugtext":19,"../source/tile_coord":38,"../util/browser":79}],23:[function(require,module,exports){
"use strict";function drawFill(e,t,r,i){if(i.buffers){var a=i.elementGroups[t.ref||t.id];if(a){var l,n,o,f,s=e.gl,u=e.translateMatrix(r,i,t.paint["fill-translate"],t.paint["fill-translate-anchor"]),m=t.paint["fill-color"];s.stencilMask(63),s.clear(s.STENCIL_BUFFER_BIT),s.stencilFunc(s.NOTEQUAL,128,128),s.stencilOpSeparate(s.FRONT,s.INCR_WRAP,s.KEEP,s.KEEP),s.stencilOpSeparate(s.BACK,s.DECR_WRAP,s.KEEP,s.KEEP),s.colorMask(!1,!1,!1,!1),s.switchShader(e.fillShader,u),l=i.buffers.fillVertex,l.bind(s),n=i.buffers.fillElement,n.bind(s);for(var c,S,E=0;E<a.groups.length;E++)o=a.groups[E],c=o.vertexStartIndex*l.itemSize,s.vertexAttribPointer(e.fillShader.a_pos,2,s.SHORT,!1,4,c+0),f=3*o.elementLength,S=o.elementStartIndex*n.itemSize,s.drawElements(s.TRIANGLES,f,s.UNSIGNED_SHORT,S);s.colorMask(!0,!0,!0,!0),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.stencilMask(0);var d=t.paint["fill-outline-color"];if(t.paint["fill-antialias"]===!0&&(!t.paint["fill-image"]||d)){s.switchShader(e.outlineShader,u),s.lineWidth(2*browser.devicePixelRatio),d?s.stencilFunc(s.EQUAL,128,128):s.stencilFunc(s.EQUAL,128,191),s.uniform2f(e.outlineShader.u_world,s.drawingBufferWidth,s.drawingBufferHeight),s.uniform4fv(e.outlineShader.u_color,d?d:m),l=i.buffers.fillVertex,n=i.buffers.outlineElement,n.bind(s);for(var p=0;p<a.groups.length;p++)o=a.groups[p],c=o.vertexStartIndex*l.itemSize,s.vertexAttribPointer(e.outlineShader.a_pos,2,s.SHORT,!1,4,c+0),f=2*o.secondElementLength,S=o.secondElementStartIndex*n.itemSize,s.drawElements(s.LINES,f,s.UNSIGNED_SHORT,S)}var _,h=t.paint["fill-image"],v=t.paint["fill-opacity"]||1;if(h){var b=e.spriteAtlas.getPosition(h.from,!0),x=e.spriteAtlas.getPosition(h.to,!0);if(!b||!x)return;_=e.patternShader,s.switchShader(_,r),s.uniform1i(_.u_image,0),s.uniform2fv(_.u_pattern_tl_a,b.tl),s.uniform2fv(_.u_pattern_br_a,b.br),s.uniform2fv(_.u_pattern_tl_b,x.tl),s.uniform2fv(_.u_pattern_br_b,x.br),s.uniform1f(_.u_opacity,v),s.uniform1f(_.u_mix,h.t);var A=8/Math.pow(2,e.transform.tileZoom-i.zoom),g=mat3.create();mat3.scale(g,g,[1/(b.size[0]*A*h.fromScale),1/(b.size[1]*A*h.fromScale)]);var R=mat3.create();mat3.scale(R,R,[1/(x.size[0]*A*h.toScale),1/(x.size[1]*A*h.toScale)]),s.uniformMatrix3fv(_.u_patternmatrix_a,!1,g),s.uniformMatrix3fv(_.u_patternmatrix_b,!1,R),e.spriteAtlas.bind(s,!0)}else _=e.fillShader,s.switchShader(_,r),s.uniform4fv(_.u_color,m);s.stencilFunc(s.NOTEQUAL,0,63),s.bindBuffer(s.ARRAY_BUFFER,e.tileExtentBuffer),s.vertexAttribPointer(_.a_pos,e.tileExtentBuffer.itemSize,s.SHORT,!1,0,0),s.drawArrays(s.TRIANGLE_STRIP,0,e.tileExtentBuffer.itemCount),s.stencilMask(0),s.stencilFunc(s.EQUAL,128,128)}}}var browser=require("../util/browser"),mat3=require("gl-matrix").mat3;module.exports=drawFill;
},{"../util/browser":79,"gl-matrix":98}],24:[function(require,module,exports){
"use strict";var browser=require("../util/browser");module.exports=function(i,t,e,r){if(r.buffers){var a=r.elementGroups[t.ref||t.id];if(a){var n=i.gl;if(!(t.paint["line-width"]<=0)){var o=1/browser.devicePixelRatio,f=t.paint["line-blur"]+o,l=t.paint["line-width"]/2,u=-1,s=0,m=0;t.paint["line-gap-width"]>0&&(u=t.paint["line-gap-width"]/2+.5*o,l=t.paint["line-width"],s=u-o/2);var _,d=s+l+o/2+m,h=t.paint["line-color"],p=i.transform.scale/(1<<r.zoom)/8,v=i.translateMatrix(e,r,t.paint["line-translate"],t.paint["line-translate-anchor"]),b=t.paint["line-dasharray"],c=t.paint["line-image"];if(b){_=i.linesdfpatternShader,n.switchShader(_,v,r.exMatrix),n.uniform2fv(_.u_linewidth,[d,u]),n.uniform1f(_.u_ratio,p),n.uniform1f(_.u_blur,f),n.uniform4fv(_.u_color,h);var w=i.lineAtlas.getDash(b.from,"round"===t.layout["line-cap"]),x=i.lineAtlas.getDash(b.to,"round"===t.layout["line-cap"]);i.lineAtlas.bind(n);var S=Math.pow(2,Math.floor(Math.log(i.transform.scale)/Math.LN2)-r.zoom)/8,g=[S/w.width/b.fromScale,-w.height/2],z=i.lineAtlas.width/(b.fromScale*w.width*256*browser.devicePixelRatio)/2,A=[S/x.width/b.toScale,-x.height/2],M=i.lineAtlas.width/(b.toScale*x.width*256*browser.devicePixelRatio)/2;n.uniform2fv(_.u_patternscale_a,g),n.uniform1f(_.u_tex_y_a,w.y),n.uniform2fv(_.u_patternscale_b,A),n.uniform1f(_.u_tex_y_b,x.y),n.uniform1i(_.u_image,0),n.uniform1f(_.u_sdfgamma,Math.max(z,M)),n.uniform1f(_.u_mix,b.t)}else if(c){var y=i.spriteAtlas.getPosition(c.from,!0),P=i.spriteAtlas.getPosition(c.to,!0);if(!y||!P)return;var R=8/Math.pow(2,i.transform.tileZoom-r.zoom);i.spriteAtlas.bind(n,!0),_=i.linepatternShader,n.switchShader(_,v,r.exMatrix),n.uniform2fv(_.u_linewidth,[d,u]),n.uniform1f(_.u_ratio,p),n.uniform1f(_.u_blur,f),n.uniform2fv(_.u_pattern_size_a,[y.size[0]*R*c.fromScale,P.size[1]]),n.uniform2fv(_.u_pattern_size_b,[P.size[0]*R*c.toScale,P.size[1]]),n.uniform2fv(_.u_pattern_tl_a,y.tl),n.uniform2fv(_.u_pattern_br_a,y.br),n.uniform2fv(_.u_pattern_tl_b,P.tl),n.uniform2fv(_.u_pattern_br_b,P.br),n.uniform1f(_.u_fade,c.t),n.uniform1f(_.u_opacity,t.paint["line-opacity"])}else _=i.lineShader,n.switchShader(_,v,r.exMatrix),n.uniform2fv(_.u_linewidth,[d,u]),n.uniform1f(_.u_ratio,p),n.uniform1f(_.u_blur,f),n.uniform4fv(_.u_color,h);var E=r.buffers.lineVertex;E.bind(n);var I=r.buffers.lineElement;I.bind(n);for(var N=0;N<a.groups.length;N++){var T=a.groups[N],D=T.vertexStartIndex*E.itemSize;n.vertexAttribPointer(_.a_pos,2,n.SHORT,!1,8,D+0),n.vertexAttribPointer(_.a_data,4,n.BYTE,!1,8,D+4);var G=3*T.elementLength,L=T.elementStartIndex*I.itemSize;n.drawElements(n.TRIANGLES,G,n.UNSIGNED_SHORT,L)}}}}};
},{"../util/browser":79}],25:[function(require,module,exports){
"use strict";function drawRaster(r,t,e,i){var a=r.gl;a.disable(a.STENCIL_TEST);var o=r.rasterShader;a.switchShader(o,e),a.uniform1f(o.u_brightness_low,t.paint["raster-brightness-min"]),a.uniform1f(o.u_brightness_high,t.paint["raster-brightness-max"]),a.uniform1f(o.u_saturation_factor,saturationFactor(t.paint["raster-saturation"])),a.uniform1f(o.u_contrast_factor,contrastFactor(t.paint["raster-contrast"])),a.uniform3fv(o.u_spin_weights,spinWeights(t.paint["raster-hue-rotate"]));var n,u,s=i.source&&i.source._pyramid.findLoadedParent(i.id,0,{}),f=getOpacities(i,s,t,r.transform);if(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,i.texture),s){a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,s.texture);var c=TileCoord.fromID(i.id),d=s&&TileCoord.fromID(s.id);n=Math.pow(2,d.z-c.z),u=[c.x*n%1,c.y*n%1]}else f[1]=0;a.uniform2fv(o.u_tl_parent,u||[0,0]),a.uniform1f(o.u_scale_parent,n||1),a.uniform1f(o.u_buffer_scale,1),a.uniform1f(o.u_opacity0,f[0]),a.uniform1f(o.u_opacity1,f[1]),a.uniform1i(o.u_image0,0),a.uniform1i(o.u_image1,1),a.bindBuffer(a.ARRAY_BUFFER,i.boundsBuffer||r.tileExtentBuffer),a.vertexAttribPointer(o.a_pos,2,a.SHORT,!1,8,0),a.vertexAttribPointer(o.a_texture_pos,2,a.SHORT,!1,8,4),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.enable(a.STENCIL_TEST)}function spinWeights(r){r*=Math.PI/180;var t=Math.sin(r),e=Math.cos(r);return[(2*e+1)/3,(-Math.sqrt(3)*t-e+1)/3,(Math.sqrt(3)*t-e+1)/3]}function contrastFactor(r){return r>0?1/(1-r):1+r}function saturationFactor(r){return r>0?1-1/(1.001-r):-r}function getOpacities(r,t,e,i){if(!r.source)return[1,0];var a=(new Date).getTime(),o=e.paint["raster-fade-duration"],n=(a-r.timeAdded)/o,u=t?(a-t.timeAdded)/o:-1,s=TileCoord.fromID(r.id),f=t&&TileCoord.fromID(t.id),c=r.source._pyramid.coveringZoomLevel(i),d=t?Math.abs(f.z-c)>Math.abs(s.z-c):!1,_=[];!t||d?(_[0]=util.clamp(n,0,1),_[1]=1-_[0]):(_[0]=util.clamp(1-u,0,1),_[1]=1-_[0]);var m=e.paint["raster-opacity"];return _[0]*=m,_[1]*=m,_}var TileCoord=require("../source/tile_coord"),util=require("../util/util");module.exports=drawRaster;
},{"../source/tile_coord":38,"../util/util":90}],26:[function(require,module,exports){
"use strict";function drawSymbols(r,a,t,o){if(o.buffers){var e=o.elementGroups[a.ref||a.id];if(e){var i=r.gl;i.disable(i.STENCIL_TEST),e.text.groups.length&&drawSymbol(r,a,t,o,e.text,"text",!0),e.icon.groups.length&&drawSymbol(r,a,t,o,e.icon,"icon",e.sdfIcons),i.enable(i.STENCIL_TEST)}}}function drawSymbol(r,a,t,o,e,i,f){var n=r.gl;t=r.translateMatrix(t,o,a.paint[i+"-translate"],a.paint[i+"-translate-anchor"]);var u=mat4.clone(r.projectionMatrix),l="map"===a.layout[i+"-rotation-alignment"],s=l?r.transform.angle:0;s&&mat4.rotateZ(u,u,s);var m=a.paint[i+"-size"]||a.layout[i+"-max-size"],d=m/defaultSizes[i];mat4.scale(u,u,[d,d,1]);var p,h,g,c="text"===i;if(c||r.style.sprite.loaded()){n.activeTexture(n.TEXTURE0),p=f?r.sdfShader:r.iconShader,c?(r.glyphAtlas.updateTexture(n),h=o.buffers.glyphVertex,g=[r.glyphAtlas.width/4,r.glyphAtlas.height/4]):(r.spriteAtlas.bind(n,l||r.options.rotating||r.options.zooming||1!==d||f),h=o.buffers.iconVertex,g=[r.spriteAtlas.width/4,r.spriteAtlas.height/4]),n.switchShader(p,t,u),n.uniform1i(p.u_texture,0),n.uniform2fv(p.u_texsize,g),h.bind(n,p);var x=Math.round(r.transform.angle/Math.PI*128),y=Math.log(m/a.layout[i+"-max-size"])/Math.LN2||0,b=l&&a.layout[i+"-keep-upright"];n.uniform1f(p.u_flip,b?1:0),n.uniform1f(p.u_angle,(x+256)%256),n.uniform1f(p.u_zoom,10*(r.transform.zoom-y));var v=r.frameHistory.getFadeProperties(300);n.uniform1f(p.u_fadedist,10*v.fadedist),n.uniform1f(p.u_minfadezoom,Math.floor(10*v.minfadezoom)),n.uniform1f(p.u_maxfadezoom,Math.floor(10*v.maxfadezoom)),n.uniform1f(p.u_fadezoom,10*(r.transform.zoom+v.bump));var S=e.groups[0].vertexStartIndex,_=e.groups[0].vertexLength;if(f){var z=8,w=1.19,T=6,A=.105*defaultSizes[i]/m/browser.devicePixelRatio;n.uniform1f(p.u_gamma,A),n.uniform4fv(p.u_color,a.paint[i+"-color"]),n.uniform1f(p.u_buffer,.75),n.drawArrays(n.TRIANGLES,S,_),a.paint[i+"-halo-color"]&&(n.uniform1f(p.u_gamma,a.paint[i+"-halo-blur"]*w/d/z+A),n.uniform4fv(p.u_color,a.paint[i+"-halo-color"]),n.uniform1f(p.u_buffer,(T-a.paint[i+"-halo-width"]/d)/z),n.drawArrays(n.TRIANGLES,S,_))}else n.uniform1f(p.u_opacity,a.paint["icon-opacity"]),n.drawArrays(n.TRIANGLES,S,_)}}var browser=require("../util/browser"),mat4=require("gl-matrix").mat4;module.exports=drawSymbols;var defaultSizes={icon:1,text:24};
},{"../util/browser":79,"gl-matrix":98}],27:[function(require,module,exports){
"use strict";function drawVertices(r,e,t,o){r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.switchShader(e.dotShader,o.posMatrix),r.uniform1f(e.dotShader.u_size,4*browser.devicePixelRatio),r.uniform1f(e.dotShader.u_blur,.25),r.uniform4fv(e.dotShader.u_color,[.25,0,0,.25]);var a,i,d,s,n;if(t.layoutProperties.fill){a=t.buffers.fillVertex,a.bind(r),i=t.elementGroups.groups;for(var u=0;u<i.length;u++)d=i[u],s=d.vertexStartIndex,n=d.vertexLength,r.vertexAttribPointer(e.dotShader.a_pos,2,r.SHORT,!1,0,0),r.drawArrays(r.POINTS,s,n)}var l=mat4.clone(o.posMatrix);if(mat4.scale(l,l,[.5,.5,1]),r.switchShader(e.dotShader,l),t.layoutProperties.line){a=t.buffers.lineVertex,a.bind(r),i=t.elementGroups.groups;for(var S=0;S<i.length;S++)d=i[S],s=d.vertexStartIndex,n=d.vertexLength,r.vertexAttribPointer(e.dotShader.a_pos,2,r.SHORT,!1,0,0),r.drawArrays(r.POINTS,s,n)}r.blendFunc(r.ONE_MINUS_DST_ALPHA,r.ONE)}var browser=require("../util/browser"),mat4=require("gl-matrix").mat4;module.exports=drawVertices;
},{"../util/browser":79,"gl-matrix":98}],28:[function(require,module,exports){
"use strict";function FrameHistory(){this.frameHistory=[]}module.exports=FrameHistory,FrameHistory.prototype.getFadeProperties=function(t){void 0===t&&(t=300);for(var e=(new Date).getTime();this.frameHistory.length>3&&this.frameHistory[1].time+t<e;)this.frameHistory.shift();this.frameHistory[1].time+t<e&&(this.frameHistory[0].z=this.frameHistory[1].z);var r=this.frameHistory.length;3>r&&console.warn("there should never be less than three frames in the history");var i=this.frameHistory[0].z,s=this.frameHistory[r-1],o=s.z,a=Math.min(i,o),m=Math.max(i,o),h=s.z-this.frameHistory[1].z,f=s.time-this.frameHistory[1].time,y=h/(f/t);isNaN(y)&&console.warn("fadedist should never be NaN");var n=(e-s.time)/t*y;return{fadedist:y,minfadezoom:a,maxfadezoom:m,bump:n}},FrameHistory.prototype.record=function(t){var e=(new Date).getTime();this.frameHistory.length||this.frameHistory.push({time:0,z:t},{time:0,z:t}),(2===this.frameHistory.length||this.frameHistory[this.frameHistory.length-1].z!==t)&&this.frameHistory.push({time:e,z:t})};
},{}],29:[function(require,module,exports){
"use strict";var shaders=require("./shaders"),util=require("../util/util");exports.extend=function(r){var t=r.lineWidth,e=r.getParameter(r.ALIASED_LINE_WIDTH_RANGE);return r.lineWidth=function(a){t.call(r,util.clamp(a,e[0],e[1]))},r.getShader=function(r,t){var e=t===this.FRAGMENT_SHADER?"fragment":"vertex";if(!shaders[r]||!shaders[r][e])throw new Error("Could not find shader "+r);var a=this.createShader(t);if(this.shaderSource(a,shaders[r][e]),this.compileShader(a),!this.getShaderParameter(a,this.COMPILE_STATUS))throw new Error(this.getShaderInfoLog(a));return a},r.initializeShader=function(r,t,e){var a={program:this.createProgram(),fragment:this.getShader(r,this.FRAGMENT_SHADER),vertex:this.getShader(r,this.VERTEX_SHADER),attributes:[]};if(this.attachShader(a.program,a.vertex),this.attachShader(a.program,a.fragment),this.linkProgram(a.program),this.getProgramParameter(a.program,this.LINK_STATUS)){for(var i=0;i<t.length;i++)a[t[i]]=this.getAttribLocation(a.program,t[i]),a.attributes.push(a[t[i]]);for(var h=0;h<e.length;h++)a[e[h]]=this.getUniformLocation(a.program,e[h])}else console.error(this.getProgramInfoLog(a.program));return a},r.switchShader=function(r,t,e){if(t||console.trace("posMatrix does not have required argument"),this.currentShader!==r){this.useProgram(r.program);for(var a=this.currentShader?this.currentShader.attributes:[],i=r.attributes,h=0;h<a.length;h++)i.indexOf(a[h])<0&&this.disableVertexAttribArray(a[h]);for(var s=0;s<i.length;s++)a.indexOf(i[s])<0&&this.enableVertexAttribArray(i[s]);this.currentShader=r}r.posMatrix!==t&&(this.uniformMatrix4fv(r.u_matrix,!1,t),r.posMatrix=t),e&&r.exMatrix!==e&&r.u_exmatrix&&(this.uniformMatrix4fv(r.u_exmatrix,!1,e),r.exMatrix=e)},r};
},{"../util/util":90,"./shaders":32}],30:[function(require,module,exports){
"use strict";function LineAtlas(t,i){this.width=t,this.height=i,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}}module.exports=LineAtlas,LineAtlas.prototype.setSprite=function(t){this.sprite=t},LineAtlas.prototype.getDash=function(t,i){var e=t.join(",")+i;return this.positions[e]||(this.positions[e]=this.addDash(t,i)),this.positions[e]},LineAtlas.prototype.addDash=function(t,i){var e=i?7:0,h=2*e+1,s=128;if(this.nextRow+h>this.height)return console.warn("LineAtlas out of space"),null;for(var a=0,r=0;r<t.length;r++)a+=t[r];for(var n=this.width/a,o=n/2,d=t.length%2===1,E=-e;e>=E;E++)for(var T=this.nextRow+e+E,l=this.width*T,R=d?-t[t.length-1]:0,u=t[0],g=1,p=0;p<this.width;p++){for(;p/n>u;)R=u,u+=t[g],d&&g===t.length-1&&(u+=t[0]),g++;var x,f=Math.abs(p-R*n),A=Math.abs(p-u*n),w=Math.min(f,A),_=g%2===1;if(i){var y=e?E/e*(o+1):0;if(_){var D=o-Math.abs(y);x=Math.sqrt(w*w+D*D)}else x=o-Math.sqrt(w*w+y*y)}else x=(_?1:-1)*w;this.data[3+4*(l+p)]=Math.max(0,Math.min(255,x+s))}var c={y:(this.nextRow+e+.5)/this.height,height:2*e/this.height,width:a};return this.nextRow+=h,this.dirty=!0,c},LineAtlas.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},LineAtlas.prototype.debug=function(){var t=document.createElement("canvas");document.body.appendChild(t),t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.background="#ff0",t.width=this.width,t.height=this.height;for(var i=t.getContext("2d"),e=i.getImageData(0,0,this.width,this.height),h=0;h<this.data.length;h++)if(this.sdf){var s=4*h;e.data[s]=e.data[s+1]=e.data[s+2]=0,e.data[s+3]=this.data[h]}else e.data[h]=this.data[h];i.putImageData(e,0,0)};
},{}],31:[function(require,module,exports){
"use strict";function GLPainter(t,e){this.gl=glutil.extend(t),this.transform=e,this.reusableTextures={},this.preFbos={},this.tileExtent=4096,this.frameHistory=new FrameHistory,this.setup()}var glutil=require("./gl_util"),browser=require("../util/browser"),mat4=require("gl-matrix").mat4,FrameHistory=require("./frame_history");module.exports=GLPainter,GLPainter.prototype.resize=function(t,e){var i=this.gl;this.projectionMatrix=mat4.create(),mat4.ortho(this.projectionMatrix,0,t,e,0,0,-1),this.width=t*browser.devicePixelRatio,this.height=e*browser.devicePixelRatio,i.viewport(0,0,this.width,this.height)},GLPainter.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE),t.enable(t.STENCIL_TEST),this.debugShader=t.initializeShader("debug",["a_pos"],["u_matrix","u_pointsize","u_color"]),this.gaussianShader=t.initializeShader("gaussian",["a_pos"],["u_matrix","u_image","u_offset"]),this.rasterShader=t.initializeShader("raster",["a_pos","a_texture_pos"],["u_matrix","u_brightness_low","u_brightness_high","u_saturation_factor","u_spin_weights","u_contrast_factor","u_opacity0","u_opacity1","u_image0","u_image1","u_tl_parent","u_scale_parent","u_buffer_scale"]),this.lineShader=t.initializeShader("line",["a_pos","a_data"],["u_matrix","u_exmatrix","u_linewidth","u_color","u_ratio","u_blur"]),this.linepatternShader=t.initializeShader("linepattern",["a_pos","a_data"],["u_matrix","u_exmatrix","u_linewidth","u_ratio","u_pattern_size_a","u_pattern_size_b","u_pattern_tl_a","u_pattern_br_a","u_pattern_tl_b","u_pattern_br_b","u_blur","u_fade","u_opacity"]),this.linesdfpatternShader=t.initializeShader("linesdfpattern",["a_pos","a_data"],["u_matrix","u_exmatrix","u_linewidth","u_color","u_ratio","u_blur","u_patternscale_a","u_tex_y_a","u_patternscale_b","u_tex_y_b","u_image","u_sdfgamma","u_mix"]),this.dotShader=t.initializeShader("dot",["a_pos"],["u_matrix","u_size","u_color","u_blur"]),this.sdfShader=t.initializeShader("sdf",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_color","u_gamma","u_buffer","u_angle","u_zoom","u_flip","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom"]),this.iconShader=t.initializeShader("icon",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_angle","u_zoom","u_flip","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_opacity"]),this.outlineShader=t.initializeShader("outline",["a_pos"],["u_matrix","u_color","u_world"]),this.patternShader=t.initializeShader("pattern",["a_pos"],["u_matrix","u_pattern_tl_a","u_pattern_br_a","u_pattern_tl_b","u_pattern_br_b","u_mix","u_patternmatrix_a","u_patternmatrix_b","u_opacity","u_image"]),this.fillShader=t.initializeShader("fill",["a_pos"],["u_matrix","u_color"]),this.identityMatrix=mat4.create(),this.backgroundBuffer=t.createBuffer(),this.backgroundBuffer.itemSize=2,this.backgroundBuffer.itemCount=4,t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),this.tileExtentBuffer=t.createBuffer(),this.tileExtentBuffer.itemSize=4,this.tileExtentBuffer.itemCount=4,t.bindBuffer(t.ARRAY_BUFFER,this.tileExtentBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([0,0,0,0,this.tileExtent,0,32767,0,0,this.tileExtent,0,32767,this.tileExtent,this.tileExtent,32767,32767]),t.STATIC_DRAW),this.debugBuffer=t.createBuffer(),this.debugBuffer.itemSize=2,this.debugBuffer.itemCount=5,t.bindBuffer(t.ARRAY_BUFFER,this.debugBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([0,0,4095,0,4095,4095,0,4095,0,0]),t.STATIC_DRAW),this.debugTextBuffer=t.createBuffer(),this.debugTextBuffer.itemSize=2},GLPainter.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},GLPainter.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},GLPainter.prototype.drawClippingMask=function(t){var e=this.gl;e.switchShader(this.fillShader,t.posMatrix),e.colorMask(!1,!1,!1,!1),e.clearStencil(0),e.stencilMask(191),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.EQUAL,192,64),e.stencilMask(192),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP),e.bindBuffer(e.ARRAY_BUFFER,this.tileExtentBuffer),e.vertexAttribPointer(this.fillShader.a_pos,this.tileExtentBuffer.itemSize,e.SHORT,!1,8,0),e.drawArrays(e.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),e.stencilFunc(e.EQUAL,128,128),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilMask(0),e.colorMask(!0,!0,!0,!0)},GLPainter.prototype.prepareBuffers=function(){},GLPainter.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)};var draw={symbol:require("./draw_symbol"),line:require("./draw_line"),fill:require("./draw_fill"),raster:require("./draw_raster"),background:require("./draw_background"),debug:require("./draw_debug"),vertices:require("./draw_vertices")};GLPainter.prototype.render=function(t,e){this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphAtlas=t.glyphAtlas,this.glyphAtlas.bind(this.gl),this.frameHistory.record(this.transform.zoom),this.prepareBuffers(),this.clearColor();for(var i=t._groups.length-1;i>=0;i--){var r=t._groups[i],a=t.sources[r.source];a?(this.clearStencil(),a.render(r,this)):void 0===r.source&&this.drawLayers(r,this.identityMatrix)}},GLPainter.prototype.drawTile=function(t,e){this.drawClippingMask(t),this.drawLayers(e,t.posMatrix,t),this.options.debug&&draw.debug(this,t)},GLPainter.prototype.drawLayers=function(t,e,i){for(var r=t.length-1;r>=0;r--){var a=t[r];a.hidden||(draw[a.type](this,a,e,i),this.options.vertices&&draw.vertices(this,a,e,i))}},GLPainter.prototype.drawStencilBuffer=function(){var t=this.gl;t.switchShader(this.fillShader,this.identityMatrix),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.stencilMask(0),t.stencilFunc(t.EQUAL,128,128),t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.vertexAttribPointer(this.fillShader.a_pos,this.backgroundBuffer.itemSize,t.SHORT,!1,0,0),t.uniform4fv(this.fillShader.u_color,[0,0,0,.5]),t.drawArrays(t.TRIANGLE_STRIP,0,this.backgroundBuffer.itemCount),t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE)},GLPainter.prototype.translateMatrix=function(t,e,i,r){if(!i[0]&&!i[1])return t;if("viewport"===r){var a=Math.sin(-this.transform.angle),s=Math.cos(-this.transform.angle);i=[i[0]*s-i[1]*a,i[0]*a+i[1]*s]}var u=this.transform.scale/(1<<e.zoom)/(e.tileExtent/e.tileSize),n=[i[0]/u,i[1]/u,0],_=new Float32Array(16);return mat4.translate(_,t,n),_},GLPainter.prototype.saveTexture=function(t){var e=this.reusableTextures[t.size];e?e.push(t):this.reusableTextures[t.size]=[t]},GLPainter.prototype.getTexture=function(t){var e=this.reusableTextures[t];return e&&e.length>0?e.pop():null};
},{"../util/browser":79,"./draw_background":21,"./draw_debug":22,"./draw_fill":23,"./draw_line":24,"./draw_raster":25,"./draw_symbol":26,"./draw_vertices":27,"./frame_history":28,"./gl_util":29,"gl-matrix":98}],32:[function(require,module,exports){
"use strict";var glify=void 0;module.exports={debug:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform float u_pointsize;\nuniform mat4 u_matrix;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.w = 1.0;\n  tmpvar_1.xy = a_pos;\n  tmpvar_1.z = float((a_pos.x >= 32767.0));\n  gl_Position = (u_matrix * tmpvar_1);\n  gl_PointSize = u_pointsize;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvoid main ()\n{\n  gl_FragColor = u_color;\n}\n\n"},dot:{vertex:"precision mediump float;\nuniform mat4 u_matrix;\nuniform float u_size;\nattribute vec2 a_pos;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  gl_PointSize = u_size;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nuniform float u_blur;\nvoid main ()\n{\n  mediump vec2 x_1;\n  x_1 = (gl_PointCoord - 0.5);\n  mediump float tmpvar_2;\n  tmpvar_2 = clamp (((\n    sqrt(dot (x_1, x_1))\n   - 0.5) / (\n    (0.5 - u_blur)\n   - 0.5)), 0.0, 1.0);\n  gl_FragColor = (u_color * (tmpvar_2 * (tmpvar_2 * \n    (3.0 - (2.0 * tmpvar_2))\n  )));\n}\n\n"},fill:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  gl_PointSize = 2.0;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvoid main ()\n{\n  gl_FragColor = u_color;\n}\n\n"},gaussian:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\nuniform vec2 u_offset;\nvarying highp vec2 a[3];\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_matrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  highp vec2 tmpvar_3;\n  tmpvar_3 = ((tmpvar_2.xy / 2.0) + 0.5);\n  a[0] = tmpvar_3;\n  vec2 cse_4;\n  cse_4 = (u_offset * 1.18243);\n  a[1] = (tmpvar_3 + cse_4);\n  a[2] = (tmpvar_3 - cse_4);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 a[3];\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (((texture2D (u_image, a[0]) * 0.40262) + (texture2D (u_image, a[1]) * 0.29869)) + (texture2D (u_image, a[2]) * 0.29869));\n  gl_FragColor = tmpvar_1;\n}\n\n"},line:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_data;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform vec2 u_linewidth;\nvarying vec2 a;\nvoid main ()\n{\n  vec2 c_1;\n  vec2 tmpvar_2;\n  tmpvar_2 = (vec2(mod (a_pos, 2.0)));\n  c_1.x = tmpvar_2.x;\n  c_1.y = sign((tmpvar_2.y - 0.5));\n  a = c_1;\n  vec4 tmpvar_3;\n  tmpvar_3.zw = vec2(0.0, 0.0);\n  tmpvar_3.xy = ((u_linewidth.x * a_data.xy) * 0.015873);\n  vec4 tmpvar_4;\n  tmpvar_4.zw = vec2(0.0, 1.0);\n  tmpvar_4.xy = floor((a_pos * 0.5));\n  gl_Position = ((u_matrix * tmpvar_4) + (u_exmatrix * tmpvar_3));\n}\n\n",fragment:"precision mediump float;\nuniform vec2 u_linewidth;\nuniform vec4 u_color;\nuniform float u_blur;\nvarying vec2 a;\nvoid main ()\n{\n  float tmpvar_1;\n  tmpvar_1 = (sqrt(dot (a, a)) * u_linewidth.x);\n  gl_FragColor = (u_color * clamp ((\n    min ((tmpvar_1 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_1))\n   / u_blur), 0.0, 1.0));\n}\n\n"},linepattern:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_data;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform vec2 u_linewidth;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  vec2 e_1;\n  vec2 tmpvar_2;\n  tmpvar_2 = (vec2(mod (a_pos, 2.0)));\n  e_1.x = tmpvar_2.x;\n  e_1.y = sign((tmpvar_2.y - 0.5));\n  a = e_1;\n  vec4 tmpvar_3;\n  tmpvar_3.zw = vec2(0.0, 1.0);\n  tmpvar_3.xy = floor((a_pos / 2.0));\n  vec4 tmpvar_4;\n  tmpvar_4.zw = vec2(0.0, 0.0);\n  tmpvar_4.xy = (u_linewidth.x * (a_data.xy * 0.015873));\n  gl_Position = ((u_matrix * tmpvar_3) + (u_exmatrix * tmpvar_4));\n  b = ((a_data.z * 128.0) + a_data.w);\n}\n\n",fragment:"precision mediump float;\nuniform vec2 u_linewidth;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_blur;\nuniform float u_fade;\nuniform float u_opacity;\nuniform sampler2D u_image;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float tmpvar_1;\n  tmpvar_1 = (sqrt(dot (a, a)) * u_linewidth.x);\n  vec2 tmpvar_2;\n  tmpvar_2.x = (float(mod ((b / u_pattern_size_a.x), 1.0)));\n  float cse_3;\n  cse_3 = (a.y * u_linewidth.x);\n  tmpvar_2.y = (0.5 + (cse_3 / u_pattern_size_a.y));\n  vec2 tmpvar_4;\n  tmpvar_4.x = (float(mod ((b / u_pattern_size_b.x), 1.0)));\n  tmpvar_4.y = (0.5 + (cse_3 / u_pattern_size_b.y));\n  lowp vec4 tmpvar_5;\n  tmpvar_5 = (mix (texture2D (u_image, mix (u_pattern_tl_a, u_pattern_br_a, tmpvar_2)), texture2D (u_image, mix (u_pattern_tl_b, u_pattern_br_b, tmpvar_4)), u_fade) * (clamp (\n    (min ((tmpvar_1 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_1)) / u_blur)\n  , 0.0, 1.0) * u_opacity));\n  gl_FragColor = tmpvar_5;\n}\n\n"},linesdfpattern:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_data;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform vec2 u_linewidth;\nuniform vec2 u_patternscale_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_a;\nuniform float u_tex_y_b;\nvarying vec2 a;\nvarying vec2 b;\nvarying vec2 c;\nvoid main ()\n{\n  vec2 f_1;\n  float tmpvar_2;\n  tmpvar_2 = ((a_data.z * 128.0) + a_data.w);\n  vec2 tmpvar_3;\n  tmpvar_3 = (vec2(mod (a_pos, 2.0)));\n  f_1.x = tmpvar_3.x;\n  f_1.y = sign((tmpvar_3.y - 0.5));\n  a = f_1;\n  vec4 tmpvar_4;\n  tmpvar_4.zw = vec2(0.0, 0.0);\n  tmpvar_4.xy = ((u_linewidth.x * a_data.xy) * 0.015873);\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = floor((a_pos * 0.5));\n  gl_Position = ((u_matrix * tmpvar_5) + (u_exmatrix * tmpvar_4));\n  vec2 tmpvar_6;\n  tmpvar_6.x = (tmpvar_2 * u_patternscale_a.x);\n  tmpvar_6.y = ((f_1.y * u_patternscale_a.y) + u_tex_y_a);\n  b = tmpvar_6;\n  vec2 tmpvar_7;\n  tmpvar_7.x = (tmpvar_2 * u_patternscale_b.x);\n  tmpvar_7.y = ((f_1.y * u_patternscale_b.y) + u_tex_y_b);\n  c = tmpvar_7;\n}\n\n",fragment:"precision mediump float;\nuniform vec2 u_linewidth;\nuniform vec4 u_color;\nuniform float u_blur;\nuniform float u_sdfgamma;\nuniform float u_mix;\nuniform sampler2D u_image;\nvarying vec2 a;\nvarying vec2 b;\nvarying vec2 c;\nvoid main ()\n{\n  float tmpvar_1;\n  tmpvar_1 = (sqrt(dot (a, a)) * u_linewidth.x);\n  float edge0_2;\n  edge0_2 = (0.5 - u_sdfgamma);\n  lowp float tmpvar_3;\n  tmpvar_3 = clamp (((\n    mix (texture2D (u_image, b).w, texture2D (u_image, c).w, u_mix)\n   - edge0_2) / (\n    (0.5 + u_sdfgamma)\n   - edge0_2)), 0.0, 1.0);\n  lowp vec4 tmpvar_4;\n  tmpvar_4 = (u_color * (clamp (\n    (min ((tmpvar_1 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_1)) / u_blur)\n  , 0.0, 1.0) * (tmpvar_3 * \n    (tmpvar_3 * (3.0 - (2.0 * tmpvar_3)))\n  )));\n  gl_FragColor = tmpvar_4;\n}\n\n"},outline:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\nuniform vec2 u_world;\nvarying highp vec2 a;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_matrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  a = (((tmpvar_2.xy + 1.0) / 2.0) * u_world);\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvarying vec2 a;\nvoid main ()\n{\n  highp vec2 x_1;\n  x_1 = (a - gl_FragCoord.xy);\n  highp float tmpvar_2;\n  tmpvar_2 = clamp (((\n    sqrt(dot (x_1, x_1))\n   - 1.0) / -1.0), 0.0, 1.0);\n  highp vec4 tmpvar_3;\n  tmpvar_3 = (u_color * (tmpvar_2 * (tmpvar_2 * \n    (3.0 - (2.0 * tmpvar_2))\n  )));\n  gl_FragColor = tmpvar_3;\n}\n\n"},pattern:{vertex:"precision mediump float;\nuniform mat4 u_matrix;\nuniform mat3 u_patternmatrix_a;\nuniform mat3 u_patternmatrix_b;\nattribute vec2 a_pos;\nvarying vec2 a;\nvarying vec2 b;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  vec3 tmpvar_2;\n  tmpvar_2.z = 1.0;\n  tmpvar_2.xy = a_pos;\n  a = (u_patternmatrix_a * tmpvar_2).xy;\n  vec3 tmpvar_3;\n  tmpvar_3.z = 1.0;\n  tmpvar_3.xy = a_pos;\n  b = (u_patternmatrix_b * tmpvar_3).xy;\n}\n\n",fragment:"precision mediump float;\nuniform float u_opacity;\nuniform float u_mix;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform sampler2D u_image;\nvarying vec2 a;\nvarying vec2 b;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (mix (texture2D (u_image, mix (u_pattern_tl_a, u_pattern_br_a, \n    (vec2(mod (a, 1.0)))\n  )), texture2D (u_image, mix (u_pattern_tl_b, u_pattern_br_b, \n    (vec2(mod (b, 1.0)))\n  )), u_mix) * u_opacity);\n  gl_FragColor = tmpvar_1;\n}\n\n"},raster:{vertex:"precision mediump float;\nuniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\nvarying vec2 a;\nvarying vec2 b;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_matrix * tmpvar_1);\n  vec2 tmpvar_2;\n  tmpvar_2 = (((\n    (a_texture_pos / 32767.0)\n   - 0.5) / u_buffer_scale) + 0.5);\n  a = tmpvar_2;\n  b = ((tmpvar_2 * u_scale_parent) + u_tl_parent);\n}\n\n",fragment:"precision mediump float;\nuniform float u_opacity0;\nuniform float u_opacity1;\nuniform float u_brightness_low;\nuniform float u_brightness_high;\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 a;\nvarying vec2 b;\nuniform vec3 u_spin_weights;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = ((texture2D (u_image0, a) * u_opacity0) + (texture2D (u_image1, b) * u_opacity1));\n  lowp vec3 tmpvar_2;\n  tmpvar_2.x = dot (tmpvar_1.xyz, u_spin_weights);\n  tmpvar_2.y = dot (tmpvar_1.xyz, u_spin_weights.zxy);\n  tmpvar_2.z = dot (tmpvar_1.xyz, u_spin_weights.yzx);\n  lowp vec4 tmpvar_3;\n  tmpvar_3.xyz = mix (vec3(u_brightness_low), vec3(u_brightness_high), ((\n    ((tmpvar_2 + ((\n      (((tmpvar_1.x + tmpvar_1.y) + tmpvar_1.z) / 3.0)\n     - tmpvar_2) * u_saturation_factor)) - 0.5)\n   * u_contrast_factor) + 0.5));\n  tmpvar_3.w = tmpvar_1.w;\n  gl_FragColor = tmpvar_3;\n}\n\n"},icon:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec4 a_data1;\nattribute vec4 a_data2;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform float u_angle;\nuniform float u_zoom;\nuniform float u_flip;\nuniform float u_fadedist;\nuniform float u_minfadezoom;\nuniform float u_maxfadezoom;\nuniform float u_fadezoom;\nuniform float u_opacity;\nuniform vec2 u_texsize;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float m_1;\n  m_1 = 0.0;\n  float tmpvar_2;\n  tmpvar_2 = (float(mod ((a_data1.w + u_angle), 256.0)));\n  if ((((u_flip > 0.0) && (tmpvar_2 >= 64.0)) && (tmpvar_2 < 192.0))) {\n    m_1 = 1.0;\n  };\n  float tmpvar_3;\n  tmpvar_3 = (((2.0 - \n    float((u_zoom >= a_data2.x))\n  ) - (1.0 - \n    float((u_zoom >= a_data2.y))\n  )) + m_1);\n  float tmpvar_4;\n  tmpvar_4 = clamp (((u_fadezoom - a_data1.z) / u_fadedist), 0.0, 1.0);\n  if ((u_fadedist >= 0.0)) {\n    b = tmpvar_4;\n  } else {\n    b = (1.0 - tmpvar_4);\n  };\n  if ((u_maxfadezoom < a_data1.z)) {\n    b = 0.0;\n  };\n  if ((u_minfadezoom >= a_data1.z)) {\n    b = 1.0;\n  };\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = a_pos;\n  vec4 tmpvar_6;\n  tmpvar_6.w = 0.0;\n  tmpvar_6.xy = (a_offset / 64.0);\n  tmpvar_6.z = ((tmpvar_3 + float(\n    (0.0 >= b)\n  )) + (float(\n    (u_angle >= a_data2.z)\n  ) * (1.0 - \n    float((u_angle >= a_data2.w))\n  )));\n  gl_Position = ((u_matrix * tmpvar_5) + (u_exmatrix * tmpvar_6));\n  a = (a_data1.xy / u_texsize);\n  b = (b * u_opacity);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (texture2D (u_texture, a) * b);\n  gl_FragColor = tmpvar_1;\n}\n\n"},sdf:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec4 a_data1;\nattribute vec4 a_data2;\nuniform mat4 u_matrix;\nuniform mat4 u_exmatrix;\nuniform float u_angle;\nuniform float u_zoom;\nuniform float u_flip;\nuniform float u_fadedist;\nuniform float u_minfadezoom;\nuniform float u_maxfadezoom;\nuniform float u_fadezoom;\nuniform vec2 u_texsize;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float l_1;\n  l_1 = 0.0;\n  float tmpvar_2;\n  tmpvar_2 = (float(mod ((a_data1.w + u_angle), 256.0)));\n  if ((((u_flip > 0.0) && (tmpvar_2 >= 64.0)) && (tmpvar_2 < 192.0))) {\n    l_1 = 1.0;\n  };\n  float tmpvar_3;\n  tmpvar_3 = (((2.0 - \n    float((u_zoom >= a_data2.x))\n  ) - (1.0 - \n    float((u_zoom >= a_data2.y))\n  )) + l_1);\n  float tmpvar_4;\n  tmpvar_4 = clamp (((u_fadezoom - a_data1.z) / u_fadedist), 0.0, 1.0);\n  if ((u_fadedist >= 0.0)) {\n    b = tmpvar_4;\n  } else {\n    b = (1.0 - tmpvar_4);\n  };\n  if ((u_maxfadezoom < a_data1.z)) {\n    b = 0.0;\n  };\n  if ((u_minfadezoom >= a_data1.z)) {\n    b = 1.0;\n  };\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = a_pos;\n  vec4 tmpvar_6;\n  tmpvar_6.w = 0.0;\n  tmpvar_6.xy = (a_offset / 64.0);\n  tmpvar_6.z = ((tmpvar_3 + float(\n    (0.0 >= b)\n  )) + (float(\n    (u_angle >= a_data2.z)\n  ) * (1.0 - \n    float((u_angle >= a_data2.w))\n  )));\n  gl_Position = ((u_matrix * tmpvar_5) + (u_exmatrix * tmpvar_6));\n  a = (a_data1.xy / u_texsize);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec4 u_color;\nuniform float u_buffer;\nuniform float u_gamma;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float edge0_1;\n  edge0_1 = (u_buffer - u_gamma);\n  lowp float tmpvar_2;\n  tmpvar_2 = clamp (((texture2D (u_texture, a).w - edge0_1) / (\n    (u_buffer + u_gamma)\n   - edge0_1)), 0.0, 1.0);\n  lowp vec4 tmpvar_3;\n  tmpvar_3 = (u_color * ((tmpvar_2 * \n    (tmpvar_2 * (3.0 - (2.0 * tmpvar_2)))\n  ) * b));\n  gl_FragColor = tmpvar_3;\n}\n\n"}};
},{}],33:[function(require,module,exports){
"use strict";function GeoJSONSource(i){i=i||{},this._data=i.data,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),this._pyramid=new TilePyramid({tileSize:512,minzoom:this.minzoom,maxzoom:this.maxzoom,cacheSize:20,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this)})}var util=require("../util/util"),Evented=require("../util/evented"),TilePyramid=require("./tile_pyramid"),Source=require("./source");module.exports=GeoJSONSource,GeoJSONSource.prototype=util.inherit(Evented,{minzoom:0,maxzoom:14,_dirty:!0,setData:function(i){return this._data=i,this._dirty=!0,this.fire("change"),this.map&&this.update(this.map.transform),this},onAdd:function(i){this.map=i},loaded:function(){return this._loaded&&this._pyramid.loaded()},update:function(i){this._dirty&&this._updateData(),this._loaded&&this._pyramid.update(this.used,i)},reload:function(){this._pyramid.reload()},render:Source._renderTiles,featuresAt:Source._vectorFeaturesAt,_updateData:function(){this._dirty=!1,this.workerID=this.dispatcher.send("parse geojson",{data:this._data,tileSize:512,source:this.id,maxZoom:this.maxzoom},function(i){return i?void this.fire("error",{error:i}):(this._loaded=!0,this._pyramid.reload(),void this.fire("change"))}.bind(this))},_loadTile:function(i){var t={uid:i.uid,id:i.id,zoom:i.zoom,maxZoom:this.maxzoom,tileSize:512,source:this.id,depth:i.zoom>=this.maxzoom?this.map.options.maxZoom-i.zoom:1};i.workerID=this.dispatcher.send("load geojson tile",t,function(t,e){if(i.unloadVectorData(this.map.painter),!i.aborted){if(t)return void this.fire("tile.error",{tile:i});i.loadVectorData(e),this.fire("tile.load",{tile:i})}}.bind(this),this.workerID)},_abortTile:function(i){i.aborted=!0},_addTile:function(i){this.fire("tile.add",{tile:i})},_removeTile:function(i){this.fire("tile.remove",{tile:i})},_unloadTile:function(i){i.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(i.uid),this.dispatcher.send("remove tile",{uid:i.uid,source:this.id},null,i.workerID)}});
},{"../util/evented":84,"../util/util":90,"./source":36,"./tile_pyramid":39}],34:[function(require,module,exports){
"use strict";function GeoJSONWrapper(e){this.features=e,this.length=e.length}function FeatureWrapper(e){this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=4096}var Point=require("point-geometry"),VectorTileFeature=require("vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this.features[e])},FeatureWrapper.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],o=[],a=0;a<r.length;a++)o.push(new Point(r[a][0],r[a][1]));this.geometry.push(o)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,o=1/0,a=-1/0,p=0;p<e.length;p++)for(var i=e[p],n=0;n<i.length;n++){var h=i[n];t=Math.min(t,h.x),r=Math.max(r,h.x),o=Math.min(o,h.y),a=Math.max(a,h.y)}return[t,o,r,a]},FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON;
},{"point-geometry":104,"vector-tile":107}],35:[function(require,module,exports){
"use strict";function RasterTileSource(e){util.extend(this,util.pick(e,"url","tileSize")),Source._loadTileJSON.call(this,e)}var util=require("../util/util"),ajax=require("../util/ajax"),Evented=require("../util/evented"),TileCoord=require("./tile_coord"),Source=require("./source"),normalizeURL=require("../util/mapbox").normalizeTileURL;module.exports=RasterTileSource,RasterTileSource.prototype=util.inherit(Evented,{minzoom:0,maxzoom:22,tileSize:512,_loaded:!1,onAdd:function(e){this.map=e},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(e){this._pyramid&&this._pyramid.update(this.used,e,this.map.style.rasterFadeDuration)},render:Source._renderTiles,_loadTile:function(e){ajax.getImage(normalizeURL(TileCoord.url(e.id,this.tiles),this.url),function(t,i){if(!e.aborted){if(t)return void this.fire("tile.error",{tile:e});var r=this.map.painter.gl;e.texture=this.map.painter.getTexture(i.width),e.texture?(r.bindTexture(r.TEXTURE_2D,e.texture),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,i)):(e.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,e.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),e.texture.size=i.width),r.generateMipmap(r.TEXTURE_2D),e.timeAdded=(new Date).getTime(),this.map.animationLoop.set(this.style.rasterFadeDuration),e.source=this,e.loaded=!0,this.fire("tile.load",{tile:e})}}.bind(this))},_abortTile:function(e){e.aborted=!0},_addTile:function(e){this.fire("tile.add",{tile:e})},_removeTile:function(e){this.fire("tile.remove",{tile:e})},_unloadTile:function(e){e.texture&&this.map.painter.saveTexture(e.texture)},featuresAt:function(e,t,i){i(null,[])}});
},{"../util/ajax":78,"../util/evented":84,"../util/mapbox":87,"../util/util":90,"./source":36,"./tile_coord":38}],36:[function(require,module,exports){
"use strict";var util=require("../util/util"),ajax=require("../util/ajax"),browser=require("../util/browser"),TileCoord=require("./tile_coord"),TilePyramid=require("./tile_pyramid"),normalizeURL=require("../util/mapbox").normalizeSourceURL;exports._loadTileJSON=function(e){var i=function(e,i){return e?void this.fire("error",{error:e}):(util.extend(this,util.pick(i,"tiles","minzoom","maxzoom","attribution")),this._pyramid=new TilePyramid({tileSize:this.tileSize,cacheSize:20,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:this.reparseOverscaled,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this)}),void this.fire("load"))}.bind(this);e.url?ajax.getJSON(normalizeURL(e.url),i):browser.frame(i.bind(this,null,e))},exports._renderTiles=function(e,i){if(this._pyramid)for(var r=this._pyramid.renderedIDs(),t=0;t<r.length;t++){var o=TileCoord.fromID(r[t]),a=this._pyramid.getTile(r[t]),s=o.z,l=o.x,u=o.y,n=o.w;s=Math.min(s,this.maxzoom),l+=n*(1<<s),a.calculateMatrices(s,l,u,i.transform,i),i.drawTile(a,e)}},exports._vectorFeaturesAt=function(e,i,r){if(!this._pyramid)return r(null,[]);var t=this._pyramid.tileAt(e);return t?void this.dispatcher.send("query features",{uid:t.tile.uid,x:t.x,y:t.y,scale:t.scale,source:this.id,params:i},r,t.tile.workerID):r(null,[])},exports.create=function(e){var i={vector:require("./vector_tile_source"),raster:require("./raster_tile_source"),geojson:require("./geojson_source"),video:require("./video_source")};for(var r in i)if(e instanceof i[r])return e;return new i[e.type](e)};
},{"../util/ajax":78,"../util/browser":79,"../util/mapbox":87,"../util/util":90,"./geojson_source":33,"./raster_tile_source":35,"./tile_coord":38,"./tile_pyramid":39,"./vector_tile_source":40,"./video_source":41}],37:[function(require,module,exports){
"use strict";function Tile(t,i){this.id=t,this.uid=util.uniqueId(),this.loaded=!1,this.zoom=TileCoord.fromID(t).z,this.uses=0,this.tileSize=i}var glmatrix=require("gl-matrix"),mat2=glmatrix.mat2,mat4=glmatrix.mat4,vec2=glmatrix.vec2,TileCoord=require("./tile_coord"),util=require("../util/util"),BufferSet=require("../data/buffer/buffer_set");module.exports=Tile,Tile.prototype={tileExtent:4096,calculateMatrices:function(t,i,e,a,r){var s=Math.pow(2,t),o=a.worldSize/s;this.scale=o,this.posMatrix=mat4.create(),mat4.translate(this.posMatrix,this.posMatrix,[a.centerPoint.x,a.centerPoint.y,0]),mat4.rotateZ(this.posMatrix,this.posMatrix,a.angle),mat4.translate(this.posMatrix,this.posMatrix,[-a.centerPoint.x,-a.centerPoint.y,0]);var n=a.width/2-a.x,l=a.height/2-a.y;mat4.translate(this.posMatrix,this.posMatrix,[n+i*o,l+e*o,1]),this.invPosMatrix=mat4.create(),mat4.invert(this.invPosMatrix,this.posMatrix),mat4.scale(this.posMatrix,this.posMatrix,[o/this.tileExtent,o/this.tileExtent,1]),mat4.multiply(this.posMatrix,r.projectionMatrix,this.posMatrix),this.exMatrix=mat4.clone(r.projectionMatrix),mat4.rotateZ(this.exMatrix,this.exMatrix,a.angle),this.rotationMatrix=mat2.create(),mat2.rotate(this.rotationMatrix,this.rotationMatrix,a.angle)},positionAt:function(t){if(!this.invPosMatrix)return null;var i=vec2.transformMat4([],[t.x,t.y],this.invPosMatrix);return vec2.scale(i,i,4096/this.scale),{x:i[0],y:i[1],scale:this.scale}},loadVectorData:function(t){this.loaded=!0,t&&(this.buffers=new BufferSet(t.buffers),this.elementGroups=t.elementGroups)},unloadVectorData:function(t){for(var i in this.buffers)this.buffers[i].destroy(t.gl);this.buffers=null}};
},{"../data/buffer/buffer_set":2,"../util/util":90,"./tile_coord":38,"gl-matrix":98}],38:[function(require,module,exports){
"use strict";function edge(o,r){if(o.row>r.row){var n=o;o=r,r=n}return{x0:o.column,y0:o.row,x1:r.column,y1:r.row,dx:r.column-o.column,dy:r.row-o.row}}function scanSpans(o,r,n,e,t){var i=Math.max(n,Math.floor(r.y0)),a=Math.min(e,Math.ceil(r.y1));if(o.x0===r.x0&&o.y0===r.y0?o.x0+r.dy/o.dy*o.dx<r.x1:o.x1-r.dy/o.dy*o.dx<r.x0){var d=o;o=r,r=d}for(var l=o.dx/o.dy,y=r.dx/r.dy,x=o.dx>0,c=r.dx<0,f=i;a>f;f++){var u=l*Math.max(0,Math.min(o.dy,f+x-o.y0))+o.x0,T=y*Math.max(0,Math.min(r.dy,f+c-r.y0))+r.x0;t(Math.floor(T),Math.ceil(u),f)}}function scanTriangle(o,r,n,e,t,i){var a,d=edge(o,r),l=edge(r,n),y=edge(n,o);d.dy>l.dy&&(a=d,d=l,l=a),d.dy>y.dy&&(a=d,d=y,y=a),l.dy>y.dy&&(a=l,l=y,y=a),d.dy&&scanSpans(y,d,e,t,i),l.dy&&scanSpans(y,l,e,t,i)}var TileCoord=exports;TileCoord.toID=function(o,r,n,e){e=e||0,e*=2,0>e&&(e=-1*e-1);var t=1<<o;return 32*(t*t*e+t*n+r)+o},TileCoord.asString=function(o){var r=TileCoord.fromID(o);return r.z+"/"+r.x+"/"+r.y},TileCoord.fromID=function(o){var r=o%32,n=1<<r,e=(o-r)/32,t=e%n,i=(e-t)/n%n,a=Math.floor(e/(n*n));return a%2!==0&&(a=-1*a-1),a/=2,{z:r,x:t,y:i,w:a}},TileCoord.zoom=function(o){return o%32},TileCoord.url=function(o,r,n){var e=TileCoord.fromID(o);return r[(e.x+e.y)%r.length].replace("{prefix}",(e.x%16).toString(16)+(e.y%16).toString(16)).replace("{z}",Math.min(e.z,n||e.z)).replace("{x}",e.x).replace("{y}",e.y)},TileCoord.parent=function(o,r){var n=TileCoord.fromID(o);return 0===n.z?null:n.z>r?TileCoord.toID(n.z-1,n.x,n.y,n.w):TileCoord.toID(n.z-1,Math.floor(n.x/2),Math.floor(n.y/2),n.w)},TileCoord.parentWithZoom=function(o,r){for(var n=TileCoord.fromID(o);n.z>r;)n.z--,n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2);return TileCoord.toID(n.z,n.x,n.y,n.w)},TileCoord.children=function(o,r){var n=TileCoord.fromID(o);return n.z>=r?[TileCoord.toID(n.z+1,n.x,n.y,n.w)]:(n.z+=1,n.x*=2,n.y*=2,[TileCoord.toID(n.z,n.x,n.y,n.w),TileCoord.toID(n.z,n.x+1,n.y,n.w),TileCoord.toID(n.z,n.x,n.y+1,n.w),TileCoord.toID(n.z,n.x+1,n.y+1,n.w)])},TileCoord.zoomTo=function(o,r){return o.column=o.column*Math.pow(2,r-o.zoom),o.row=o.row*Math.pow(2,r-o.zoom),o.zoom=r,o},TileCoord.cover=function(o,r,n){function e(o,r,e){var a,d;if(e>=0&&t>=e)for(a=o;r>a;a++)d=(a+t)%t,i[TileCoord.toID(n,d,e,Math.floor(a/t))]={x:d,y:e}}var t=1<<o,i={};return scanTriangle(r[0],r[1],r[2],0,t,e),scanTriangle(r[2],r[3],r[0],0,t,e),Object.keys(i)};
},{}],39:[function(require,module,exports){
"use strict";function TilePyramid(i){this.tileSize=i.tileSize,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,this.reparseOverscaled=i.reparseOverscaled,this._load=i.load,this._abort=i.abort,this._unload=i.unload,this._add=i.add,this._remove=i.remove,this._tiles={},this._cache=new Cache(i.cacheSize,function(i){return this._unload(i)}.bind(this))}var Tile=require("./tile"),TileCoord=require("./tile_coord"),Point=require("point-geometry"),Cache=require("../util/mru_cache"),util=require("../util/util");module.exports=TilePyramid,TilePyramid.prototype={loaded:function(){for(var i in this._tiles)if(!this._tiles[i].loaded)return!1;return!0},orderedIDs:function(){return Object.keys(this._tiles).sort(function(i,e){return e%32-i%32}).map(function(i){return+i})},renderedIDs:function(){return this.orderedIDs().filter(function(i){return this._tiles[i].loaded&&!this._coveredTiles[i]}.bind(this))},reload:function(){this._cache.reset();for(var i in this._tiles)this._load(this._tiles[i])},getTile:function(i){return this._tiles[i]},getZoom:function(i){return i.zoom+Math.log(i.tileSize/this.tileSize)/Math.LN2},coveringZoomLevel:function(i){return Math.floor(this.getZoom(i))},coveringTiles:function(i){var e=this.coveringZoomLevel(i),t=e;if(e<this.minzoom)return[];e>this.maxzoom&&(e=this.maxzoom);var o=i,r=TileCoord.zoomTo(o.locationCoordinate(o.center),e),s=new Point(r.column-.5,r.row-.5);return TileCoord.cover(e,[TileCoord.zoomTo(o.pointCoordinate(r,{x:0,y:0}),e),TileCoord.zoomTo(o.pointCoordinate(r,{x:o.width,y:0}),e),TileCoord.zoomTo(o.pointCoordinate(r,{x:o.width,y:o.height}),e),TileCoord.zoomTo(o.pointCoordinate(r,{x:0,y:o.height}),e)],this.reparseOverscaled?t:e).sort(function(i,e){return s.dist(TileCoord.fromID(i))-s.dist(TileCoord.fromID(e))})},findLoadedChildren:function(i,e,t){for(var o=!0,r=TileCoord.fromID(i).z,s=TileCoord.children(i,this.maxzoom),n=0;n<s.length;n++)this._tiles[s[n]]&&this._tiles[s[n]].loaded?t[s[n]]=!0:(o=!1,e>r&&this.findLoadedChildren(s[n],e,t));return o},findLoadedParent:function(i,e,t){for(var o=TileCoord.fromID(i).z;o>=e;o--){i=TileCoord.parent(i,this.maxzoom);var r=this._tiles[i];if(r&&r.loaded)return t[i]=!0,r}},update:function(i,e,t){var o,r,s,n=Math.floor(this.getZoom(e)),d=util.clamp(n-10,this.minzoom,this.maxzoom),l=util.clamp(n+1,this.minzoom,this.maxzoom),a={},h=(new Date).getTime();this._coveredTiles={};var u=i?this.coveringTiles(e):[];for(o=0;o<u.length;o++)r=+u[o],s=this.addTile(r),a[r]=!0,s.loaded||this.findLoadedChildren(r,l,a)||this.findLoadedParent(r,d,a);for(r in a)s=this._tiles[r],s&&s.timeAdded>h-(t||0)&&(this.findLoadedChildren(r,l,a)?(this._coveredTiles[r]=!0,a[r]=!0):this.findLoadedParent(r,d,a));var m=util.keysDifference(this._tiles,a);for(o=0;o<m.length;o++)this.removeTile(+m[o])},addTile:function(i){var e=this._tiles[i];if(e)return e;var t=this._wrappedID(i);if(e=this._tiles[t]||this._cache.get(t),!e){var o=TileCoord.fromID(i).z,r=o>this.maxzoom?Math.pow(2,o-this.maxzoom):1;e=new Tile(t,this.tileSize*r),this._load(e)}return e.uses++,this._tiles[i]=e,this._add(e,i),e},removeTile:function(i){var e=this._tiles[i];e&&(e.uses--,delete this._tiles[i],this._remove(e,i),e.uses>0||(e.loaded?this._cache.add(this._wrappedID(i),e):(this._abort(e),this._unload(e))))},clearTiles:function(){for(var i in this._tiles)this.removeTile(i);this._cache.reset()},tileAt:function(i){for(var e=this.orderedIDs(),t=0;t<e.length;t++){var o=this._tiles[e[t]],r=o.positionAt(i);if(r&&r.x>=0&&r.x<4096&&r.y>=0&&r.y<4096)return{tile:o,x:r.x,y:r.y,scale:r.scale}}},_wrappedID:function(i){var e=TileCoord.fromID(i);return 0===e.w?i:TileCoord.toID(e.z,e.x,e.y,0)}};
},{"../util/mru_cache":88,"../util/util":90,"./tile":37,"./tile_coord":38,"point-geometry":104}],40:[function(require,module,exports){
"use strict";function VectorTileSource(e){if(util.extend(this,util.pick(e,"url","tileSize")),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");Source._loadTileJSON.call(this,e)}var util=require("../util/util"),Evented=require("../util/evented"),TileCoord=require("./tile_coord"),Source=require("./source");module.exports=VectorTileSource,VectorTileSource.prototype=util.inherit(Evented,{minzoom:0,maxzoom:22,tileSize:512,reparseOverscaled:!0,_loaded:!1,onAdd:function(e){this.map=e},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(e){this._pyramid&&this._pyramid.update(this.used,e)},reload:function(){this._pyramid.reload()},render:Source._renderTiles,featuresAt:Source._vectorFeaturesAt,_loadTile:function(e){var i=e.zoom>this.maxzoom?Math.pow(2,e.zoom-this.maxzoom):1,t={url:TileCoord.url(e.id,this.tiles,this.maxzoom),uid:e.uid,id:e.id,zoom:e.zoom,maxZoom:this.maxzoom,tileSize:this.tileSize*i,source:this.id,overscaling:i};e.workerID?this.dispatcher.send("reload tile",t,this._tileLoaded.bind(this,e),e.workerID):e.workerID=this.dispatcher.send("load tile",t,this._tileLoaded.bind(this,e))},_tileLoaded:function(e,i,t){if(!e.aborted){if(i)return void this.fire("tile.error",{tile:e});e.loadVectorData(t),this.fire("tile.load",{tile:e})}},_abortTile:function(e){e.aborted=!0,this.dispatcher.send("abort tile",{uid:e.uid,source:this.id},null,e.workerID)},_addTile:function(e){this.fire("tile.add",{tile:e})},_removeTile:function(e){this.fire("tile.remove",{tile:e})},_unloadTile:function(e){e.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(e.uid),this.dispatcher.send("remove tile",{uid:e.uid,source:this.id},null,e.workerID)}});
},{"../util/evented":84,"../util/util":90,"./source":36,"./tile_coord":38}],41:[function(require,module,exports){
"use strict";function VideoSource(e){this.coordinates=e.coordinates,ajax.getVideo("string"==typeof e.url?[e.url]:e.url,function(e,t){if(!e){this.video=t,this.video.loop=!0;var i;this.video.addEventListener("playing",function(){i=this.map.style.animationLoop.set(1/0),this.map._rerender()}.bind(this)),this.video.addEventListener("pause",function(){this.map.style.animationLoop.cancel(i)}.bind(this)),this._loaded=!0,this.map&&(this.video.play(),this.createTile(),this.fire("change"))}}.bind(this))}var util=require("../util/util"),Tile=require("./tile"),TileCoord=require("./tile_coord"),LatLng=require("../geo/lat_lng"),Point=require("point-geometry"),Evented=require("../util/evented"),ajax=require("../util/ajax");module.exports=VideoSource,VideoSource.prototype=util.inherit(Evented,{onAdd:function(e){this.map=e,this.video&&(this.video.play(),this.createTile())},createTile:function(){for(var e=this.map,t=this.coordinates.map(function(t){var i=LatLng.convert(t);return TileCoord.zoomTo(e.transform.locationCoordinate(i),0)}),i=1/0,o=1/0,r=-1/0,a=-1/0,n=0;n<t.length;n++)i=Math.min(i,t[n].column),o=Math.min(o,t[n].row),r=Math.max(r,t[n].column),a=Math.max(a,t[n].row);var u=r-i,s=a-o,l=Math.max(u,s),d=TileCoord.zoomTo({column:(i+r)/2,row:(o+a)/2,zoom:0},Math.floor(-Math.log(l)/Math.LN2)),h=4096,T=t.map(function(e){var t=TileCoord.zoomTo(e,d.zoom);return new Point(Math.round((t.column-d.column)*h),Math.round((t.row-d.row)*h))}),c=e.painter.gl,E=32767,m=new Int16Array([T[0].x,T[0].y,0,0,T[1].x,T[1].y,E,0,T[3].x,T[3].y,0,E,T[2].x,T[2].y,E,E]);this.tile=new Tile,this.tile.buckets={},this.tile.boundsBuffer=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,this.tile.boundsBuffer),c.bufferData(c.ARRAY_BUFFER,m,c.STATIC_DRAW),this.center=d},loaded:function(){return this.video&&this.video.readyState>=2},update:function(){},render:function(e,t){if(this._loaded&&!(this.video.readyState<2)){var i=this.center;this.tile.calculateMatrices(i.zoom,i.column,i.row,this.map.transform,t);var o=t.gl;this.tile.texture?(o.bindTexture(o.TEXTURE_2D,this.tile.texture),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.tile.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.tile.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this.video)),t.drawLayers(e,this.tile.posMatrix,this.tile)}},featuresAt:function(e,t,i){return i(null,[])}});
},{"../geo/lat_lng":16,"../util/ajax":78,"../util/evented":84,"../util/util":90,"./tile":37,"./tile_coord":38,"point-geometry":104}],42:[function(require,module,exports){
"use strict";function Worker(e){this.self=e,this.actor=new Actor(e,this),this.loading={},this.loaded={},this.layers=[],this.geoJSONIndexes={}}var Actor=require("../util/actor"),WorkerTile=require("./worker_tile"),util=require("../util/util"),ajax=require("../util/ajax"),vt=require("vector-tile"),Protobuf=require("pbf"),TileCoord=require("./tile_coord"),geojsonvt=require("geojson-vt"),GeoJSONWrapper=require("./geojson_wrapper");module.exports=Worker,util.extend(Worker.prototype,{"set layers":function(e){this.layers=e},"load tile":function(e,r){var t=e.source,i=e.uid;this.loading[t]||(this.loading[t]={}),this.loading[t][i]=ajax.getArrayBuffer(e.url,function(o,a){if(delete this.loading[t][i],o)return r(o);var s=new WorkerTile(e);s.data=new vt.VectorTile(new Protobuf(new Uint8Array(a))),s.parse(s.data,this.layers,this.actor,r),this.loaded[t]=this.loaded[t]||{},this.loaded[t][i]=s}.bind(this))},"reload tile":function(e,r){var t=this.loaded[e.source],i=e.uid;if(t&&t[i]){var o=t[i];o.parse(o.data,this.layers,this.actor,r)}},"abort tile":function(e){var r=this.loading[e.source],t=e.uid;r&&r[t]&&(r[t].abort(),delete r[t])},"remove tile":function(e){var r=this.loaded[e.source],t=e.uid;r&&r[t]&&delete r[t]},"parse geojson":function(e,r){var t=function(t,i){return t?r(t):(this.geoJSONIndexes[e.source]=geojsonvt(i,{baseZoom:e.maxZoom}),void r(null))}.bind(this);"string"==typeof e.data?ajax.getJSON(e.data,t):t(null,e.data)},"load geojson tile":function(e,r){var t=e.source,i=TileCoord.fromID(e.id),o=this.geoJSONIndexes[t].getTile(i.z,i.x,i.y);if(!o)return r(null,null);var a=new WorkerTile(e);a.parse(new GeoJSONWrapper(o.features),this.layers,this.actor,r),this.loaded[t]=this.loaded[t]||{},this.loaded[t][e.uid]=a},"query features":function(e,r){var t=this.loaded[e.source]&&this.loaded[e.source][e.uid];t?t.featureTree.query(e,r):r(null,[])}});
},{"../util/actor":77,"../util/ajax":78,"../util/util":90,"./geojson_wrapper":34,"./tile_coord":38,"./worker_tile":43,"geojson-vt":95,"pbf":102,"vector-tile":107}],43:[function(require,module,exports){
"use strict";function WorkerTile(e){this.id=e.id,this.uid=e.uid,this.zoom=e.zoom,this.maxZoom=e.maxZoom,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=e.overscaling}var FeatureTree=require("../data/feature_tree"),Collision=require("../symbol/collision"),BufferSet=require("../data/buffer/buffer_set"),createBucket=require("../data/create_bucket");module.exports=WorkerTile,WorkerTile.prototype.parse=function(e,t,i,r){function o(e,t){for(var i=0;i<e.length;i++){var r=e.feature(i);for(var o in t){var s=t[o];s.filter(r)&&s.features.push(r)}}}function s(e){return function(t){e.dependenciesLoaded=!0,a(d,e,t)}}function a(e,t,i){if(!(t.getDependencies&&!t.dependenciesLoaded||t.collision&&!t.previousPlaced)){if(!i){var r=Date.now();t.features.length&&t.addFeatures();var o=Date.now()-r;if(t.interactive)for(var s=0;s<t.features.length;s++){var u=t.features[s];e.featureTree.insert(u.bbox(),t.layers,u)}"undefined"!=typeof self&&(self.bucketStats=self.bucketStats||{_total:0},self.bucketStats._total+=o,self.bucketStats[t.id]=(self.bucketStats[t.id]||0)+o)}return S--,S?void(t.next&&(t.next.previousPlaced=!0,a(e,t.next))):void n()}}function n(){var e=[],t={};for(l in h)e.push(h[l].array);for(l in m)t[l]=m[l].elementGroups;r(null,{elementGroups:t,buffers:h},e)}this.featureTree=new FeatureTree(this.id);var u,l,f,c,d=this,h=new BufferSet,v=new Collision(this.zoom,4096,this.tileSize),m={},p=[],g={};for(u=0;u<t.length;u++)if(f=t[u],f.source===this.source&&!f.ref){var b=f.minzoom;if(!(b&&this.zoom<b&&b<this.maxZoom)){var y=f.maxzoom;if(!(y&&this.zoom>=y)){var k=f.layout.visibility;if("none"!==k)if(c=createBucket(f,h,v,this.zoom,this.overscaling),c.layers=[f.id],m[c.id]=c,p.push(c),e.layers){var z=f["source-layer"];g[z]||(g[z]={}),g[z][c.id]=c}else g[c.id]=c}}}for(u=0;u<t.length;u++)f=t[u],f.source===this.source&&f.ref&&(c=m[f.ref],c&&c.layers.push(f.id));if(e.layers)for(l in g)f=e.layers[l],f&&o(f,g[l]);else o(e,g);var x,S=p.length;for(u=0;u<p.length;u++)c=p[u],c.collision&&(x?x.next=c:c.previousPlaced=!0,x=c),c.getDependencies&&c.getDependencies(this,i,s(c)),c.collision||c.getDependencies||a(d,c)};
},{"../data/buffer/buffer_set":2,"../data/create_bucket":10,"../data/feature_tree":12,"../symbol/collision":57}],44:[function(require,module,exports){
"use strict";function AnimationLoop(){this.n=0,this.times=[]}module.exports=AnimationLoop,AnimationLoop.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},AnimationLoop.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},AnimationLoop.prototype.cancel=function(t){this.times=this.times.filter(function(i){return i.id!==t})};
},{}],45:[function(require,module,exports){
"use strict";function ImageSprite(t){this.base=t,this.retina=browser.devicePixelRatio>1,t=this.base+(this.retina?"@2x":""),ajax.getJSON(t+".json",function(t,i){return t?void this.fire("error",{error:t}):(this.data=i,void(this.img&&this.fire("load")))}.bind(this)),ajax.getImage(t+".png",function(t,i){if(t)return void this.fire("error",{error:t});for(var e=i.getData(),r=i.data=new Uint8Array(e.length),a=0;a<e.length;a+=4){var o=e[a+3]/255;r[a+0]=e[a+0]*o,r[a+1]=e[a+1]*o,r[a+2]=e[a+2]*o,r[a+3]=e[a+3]}this.img=i,this.data&&this.fire("load")}.bind(this))}function SpritePosition(){}var Evented=require("../util/evented"),ajax=require("../util/ajax"),browser=require("../util/browser");module.exports=ImageSprite,ImageSprite.prototype=Object.create(Evented),ImageSprite.prototype.toJSON=function(){return this.base},ImageSprite.prototype.loaded=function(){return!(!this.data||!this.img)},ImageSprite.prototype.resize=function(){if(browser.devicePixelRatio>1!==this.retina){var t=new ImageSprite(this.base);t.on("load",function(){this.img=t.img,this.data=t.data,this.retina=t.retina}.bind(this))}},SpritePosition.prototype={x:0,y:0,width:0,height:0,pixelRatio:1,sdf:!1},ImageSprite.prototype.getSpritePosition=function(t){if(!this.loaded())return new SpritePosition;var i=this.data&&this.data[t];return i&&this.img?i:new SpritePosition};
},{"../util/ajax":78,"../util/browser":79,"../util/evented":84}],46:[function(require,module,exports){
"use strict";var reference=require("./reference");module.exports={},reference.layout.forEach(function(e){var r=function(e){for(var r in e)this[r]=e[r]},o=reference[e];for(var t in o)void 0!==o[t]["default"]&&(r.prototype[t]=o[t]["default"]);module.exports[e.replace("layout_","")]=r});
},{"./reference":48}],47:[function(require,module,exports){
"use strict";var reference=require("./reference"),parseCSSColor=require("csscolorparser").parseCSSColor;module.exports={},reference.paint.forEach(function(e){var r=function(){},o=reference[e];for(var p in o){var t=o[p],a=t["default"];void 0!==a&&("color"===t.type&&(a=parseCSSColor(a)),r.prototype[p]=a)}r.prototype.hidden=!1,module.exports[e.replace("paint_","")]=r});
},{"./reference":48,"csscolorparser":91}],48:[function(require,module,exports){
module.exports=require("mapbox-gl-style-spec/reference/v7");
},{"mapbox-gl-style-spec/reference/v7":100}],49:[function(require,module,exports){
"use strict";function Style(e,r){this.animationLoop=r||new AnimationLoop,this.dispatcher=new Dispatcher(Math.max(browser.hardwareConcurrency-1,1),this),this.glyphAtlas=new GlyphAtlas(1024,1024),this.spriteAtlas=new SpriteAtlas(512,512),this.spriteAtlas.resize(browser.devicePixelRatio),this.lineAtlas=new LineAtlas(256,512),this._layers={},this._order=[],this._groups=[],this.sources={},this.zoomHistory={},util.bindAll(["_forwardSourceEvent","_forwardTileEvent"],this);var t=function(e,r){if(e)return void this.fire("error",{error:e});this._loaded=!0,this.stylesheet=r,7!==r.version&&console.warn("Stylesheet version must be 7"),Array.isArray(r.layers)||console.warn("Stylesheet must have layers");var t=r.sources;for(var s in t)this.addSource(s,t[s]);r.sprite&&(this.sprite=new ImageSprite(r.sprite),this.sprite.on("load",this.fire.bind(this,"change"))),this.glyphSource=new GlyphSource(r.glyphs,this.glyphAtlas),this._resolve(),this.fire("load")}.bind(this);"string"==typeof e?ajax.getJSON(normalizeURL(e),t):browser.frame(t.bind(this,null,e))}var Evented=require("../util/evented"),Source=require("../source/source"),StyleLayer=require("./style_layer"),ImageSprite=require("./image_sprite"),GlyphSource=require("../symbol/glyph_source"),GlyphAtlas=require("../symbol/glyph_atlas"),SpriteAtlas=require("../symbol/sprite_atlas"),LineAtlas=require("../render/line_atlas"),util=require("../util/util"),ajax=require("../util/ajax"),normalizeURL=require("../util/mapbox").normalizeStyleURL,browser=require("../util/browser"),Dispatcher=require("../util/dispatcher"),Point=require("point-geometry"),AnimationLoop=require("./animation_loop");module.exports=Style,Style.prototype=util.inherit(Evented,{_loaded:!1,loaded:function(){if(!this._loaded)return!1;for(var e in this.sources)if(!this.sources[e].loaded())return!1;return this.sprite&&!this.sprite.loaded()?!1:!0},_resolve:function(){var e,r;this._layers={},this._order=[];for(var t=0;t<this.stylesheet.layers.length;t++)r=new StyleLayer(this.stylesheet.layers[t],this.stylesheet.constants||{}),this._layers[r.id]=r,this._order.push(r.id);for(e in this._layers)this._layers[e].resolveLayout();for(e in this._layers)this._layers[e].resolveReference(this._layers),this._layers[e].resolvePaint();this._groupLayers(),this._broadcastLayers()},_groupLayers:function(){var e;this._groups=[];for(var r=0;r<this._order.length;++r){var t=this._layers[this._order[r]];e&&t.source===e.source||(e=[],e.source=t.source,this._groups.push(e)),e.push(t)}},_broadcastLayers:function(){var e=[];for(var r in this._layers)e.push(this._layers[r].json());this.dispatcher.broadcast("set layers",e)},_cascade:function(e,r){if(this._loaded){r=r||{transition:!0};for(var t in this._layers)this._layers[t].cascade(e,r,this.stylesheet.transition||{},this.animationLoop);this.fire("change")}},_recalculate:function(e){for(var r in this.sources)this.sources[r].used=!1;this._updateZoomHistory(e),this.rasterFadeDuration=300;for(r in this._layers){var t=this._layers[r];t.recalculate(e,this.zoomHistory)&&t.source&&(this.sources[t.source].used=!0)}var s=300;Math.floor(this.z)!==Math.floor(e)&&this.animationLoop.set(s),this.z=e,this.fire("zoom")},_updateZoomHistory:function(e){var r=this.zoomHistory;void 0===r.lastIntegerZoom&&(r.lastIntegerZoom=Math.floor(e),r.lastIntegerZoomTime=0,r.lastZoom=e),Math.floor(r.lastZoom)<Math.floor(e)?(r.lastIntegerZoom=Math.floor(e),r.lastIntegerZoomTime=Date.now()):Math.floor(r.lastZoom)>Math.floor(e)&&(r.lastIntegerZoom=Math.floor(e+1),r.lastIntegerZoomTime=Date.now()),r.lastZoom=e},addSource:function(e,r){if(void 0!==this.sources[e])throw new Error("There is already a source with this ID");return r=Source.create(r),this.sources[e]=r,r.id=e,r.style=this,r.dispatcher=this.dispatcher,r.glyphAtlas=this.glyphAtlas,r.on("load",this._forwardSourceEvent).on("error",this._forwardSourceEvent).on("change",this._forwardSourceEvent).on("tile.add",this._forwardTileEvent).on("tile.load",this._forwardTileEvent).on("tile.error",this._forwardTileEvent).on("tile.remove",this._forwardTileEvent),this.fire("source.add",{source:r}),this},removeSource:function(e){if(void 0===this.sources[e])throw new Error("There is no source with this ID");var r=this.sources[e];return delete this.sources[e],r.off("load",this._forwardSourceEvent).off("error",this._forwardSourceEvent).off("change",this._forwardSourceEvent).off("tile.add",this._forwardTileEvent).off("tile.load",this._forwardTileEvent).off("tile.error",this._forwardTileEvent).off("tile.remove",this._forwardTileEvent),this.fire("source.remove",{source:r}),this},getSource:function(e){return this.sources[e]},addLayer:function(e,r){if(void 0!==this._layers[e.id])throw new Error("There is already a layer with this ID");return e=new StyleLayer(e,this.stylesheet.constants||{}),this._layers[e.id]=e,this._order.splice(r?this._order.indexOf(r):1/0,0,e.id),e.resolveLayout(),e.resolveReference(this._layers),e.resolvePaint(),this._groupLayers(),this._broadcastLayers(),this.fire("layer.add",{layer:e}),this},removeLayer:function(e){var r=this._layers[e];if(void 0===r)throw new Error("There is no layer with this ID");for(var t in this._layers)this._layers[t].ref===e&&this.removeLayer(t);return delete this._layers[e],this._order.splice(this._order.indexOf(e),1),this._groupLayers(),this._broadcastLayers(),this.fire("layer.remove",{layer:r}),this},getLayer:function(e){return this._layers[e]},getReferentLayer:function(e){var r=this.getLayer(e);return r.ref&&(r=this.getLayer(r.ref)),r},setFilter:function(e,r){e=this.getReferentLayer(e),e.filter=r,this._broadcastLayers(),this.sources[e.source].reload()},getFilter:function(e){return this.getReferentLayer(e).filter},setLayoutProperty:function(e,r,t){e=this.getReferentLayer(e),e.setLayoutProperty(r,t),this._broadcastLayers(),this.sources[e.source].reload()},getLayoutProperty:function(e,r){return this.getReferentLayer(e).getLayoutProperty(r)},setPaintProperty:function(e,r,t,s){this.getLayer(e).setPaintProperty(r,t,s)},getPaintProperty:function(e,r,t){return this.getLayer(e).getPaintProperty(r,t)},featuresAt:function(e,r,t){var s=[],i=null;e=Point.convert(e),r.layer&&(r.layer={id:r.layer.id}),util.asyncEach(Object.keys(this.sources),function(t,o){var a=this.sources[t];a.featuresAt(e,r,function(e,r){r&&(s=s.concat(r)),e&&(i=e),o()})}.bind(this),function(){return i?t(i):(s.forEach(function(e){e.layer=this._layers[e.layer].json()}.bind(this)),void t(null,s))}.bind(this))},_remove:function(){this.dispatcher.remove()},_updateSources:function(e){for(var r in this.sources)this.sources[r].update(e)},_forwardSourceEvent:function(e){this.fire("source."+e.type,util.extend({source:e.target},e))},_forwardTileEvent:function(e){this.fire(e.type,util.extend({source:e.target},e))},"get sprite json":function(e,r){var t=this.sprite;t.loaded()?r(null,{sprite:t.data,retina:t.retina}):t.on("load",function(){r(null,{sprite:t.data,retina:t.retina})})},"get icons":function(e,r){var t=this.sprite,s=this.spriteAtlas;t.loaded()?(s.setSprite(t),s.addIcons(e.icons,r)):t.on("load",function(){s.setSprite(t),s.addIcons(e.icons,r)})},"get glyphs":function(e,r){this.glyphSource.getRects(e.fontstack,e.codepoints,e.uid,r)}});
},{"../render/line_atlas":30,"../source/source":36,"../symbol/glyph_atlas":58,"../symbol/glyph_source":59,"../symbol/sprite_atlas":67,"../util/ajax":78,"../util/browser":79,"../util/dispatcher":81,"../util/evented":84,"../util/mapbox":87,"../util/util":90,"./animation_loop":44,"./image_sprite":45,"./style_layer":53,"point-geometry":104}],50:[function(require,module,exports){
"use strict";var util=require("../util/util");exports.resolve=function(r,t){function s(r){return"string"==typeof r&&"@"===r[0]?t[r]:r}var e;if(r=s(r),Array.isArray(r))for(r=r.slice(),e=0;e<r.length;e++)r[e]in t&&(r[e]=s(r[e]));if(r.stops)for(r=util.extend({},r),r.stops=r.stops.slice(),e=0;e<r.stops.length;e++)r.stops[e][1]in t&&(r.stops[e]=[r.stops[e][0],s(r.stops[e][1])]);return r},exports.resolveAll=function(r,t){if(!t)return r;var s={};for(var e in r)s[e]=exports.resolve(r[e],t);return s};
},{"../util/util":90}],51:[function(require,module,exports){
"use strict";function StyleDeclaration(t,o){this.type=t.type,this.transitionable=t.transition,this.json=JSON.stringify(o),this.value="color"!==this.type?o:o.stops?prepareColorFunction(o):parseColor(o),"interpolated"===t["function"]?this.calculate=mapboxGLFunction.interpolated(this.value):(this.calculate=mapboxGLFunction["piecewise-constant"](this.value),t.transition&&(this.calculate=transitioned(this.calculate)))}function transitioned(t){return function(o,r,e){var n,a,i,l=o%1,c=Math.min((Date.now()-r.lastIntegerZoomTime)/e,1),s=1,u=1;return o>r.lastIntegerZoom?(n=l+(1-l)*c,s*=2,a=t(o-1),i=t(o)):(n=1-(1-c)*l,i=t(o),a=t(o+1),s/=2),{from:a,fromScale:s,to:i,toScale:u,t:n}}}function parseColor(t){if(colorCache[t])return colorCache[t];var o=prepareColor(parseCSSColor(t));return colorCache[t]=o,o}function prepareColor(t){return[t[0]/255,t[1]/255,t[2]/255,t[3]/1]}function prepareColorFunction(t){return util.extend({},t,{stops:t.stops.map(function(t){return[t[0],parseColor(t[1])]})})}var parseCSSColor=require("csscolorparser").parseCSSColor,mapboxGLFunction=require("mapbox-gl-function"),util=require("../util/util");module.exports=StyleDeclaration;var colorCache={};
},{"../util/util":90,"csscolorparser":91,"mapbox-gl-function":99}],52:[function(require,module,exports){
"use strict";function makeConstructor(t){function e(t,e){this._values={},this._transitions={},this._constants=e;for(var n in t)this[n]=StyleConstant.resolve(t[n],this._constants)}return Object.keys(t).forEach(function(n){var r=t[n];Object.defineProperty(e.prototype,n,{set:function(t){this._values[n]=new StyleDeclaration(r,StyleConstant.resolve(t,this._constants))},get:function(){return this._values[n].value}}),r.transition&&Object.defineProperty(e.prototype,n+"-transition",{set:function(t){this._transitions[n]=t},get:function(){return this._transitions[n]}})}),e.prototype.values=function(){return this._values},e.prototype.transition=function(t,e){var n=this._transitions[t]||{};return{duration:util.coalesce(n.duration,e.duration,300),delay:util.coalesce(n.delay,e.delay,0)}},e.prototype.json=function(){var t={};for(var e in this._values)t[e]=this._values[e].value;for(var n in this._transitions)t[n+"-transition"]=this._transitions[e];return t},e}var util=require("../util/util"),reference=require("./reference"),StyleConstant=require("./style_constant"),StyleDeclaration=require("./style_declaration"),lookup={paint:{},layout:{}};reference.layer.type.values.forEach(function(t){lookup.paint[t]=makeConstructor(reference["paint_"+t]),lookup.layout[t]=makeConstructor(reference["layout_"+t])}),module.exports=function(t,e,n,r){return new lookup[t][e](n,r)};
},{"../util/util":90,"./reference":48,"./style_constant":50,"./style_declaration":51}],53:[function(require,module,exports){
"use strict";function StyleLayer(t,i){this._layer=t,this._constants=i,this.id=t.id,this.ref=t.ref,this._resolved={},this._cascaded={},this.assign(t)}function premultiplyLayer(t,i){var e=i+"-color",o=i+"-halo-color",a=i+"-outline-color",s=t[e],n=t[o],r=t[a],l=t[i+"-opacity"],y=s&&l*s[3],h=n&&l*n[3],u=r&&l*r[3];void 0!==y&&1>y&&(t[e]=util.premultiply([s[0],s[1],s[2],y])),void 0!==h&&1>h&&(t[o]=util.premultiply([n[0],n[1],n[2],h])),void 0!==u&&1>u&&(t[a]=util.premultiply([r[0],r[1],r[2],u]))}var util=require("../util/util"),StyleConstant=require("./style_constant"),StyleTransition=require("./style_transition"),StyleDeclarationSet=require("./style_declaration_set"),LayoutProperties=require("./layout_properties"),PaintProperties=require("./paint_properties");module.exports=StyleLayer,StyleLayer.prototype={resolveLayout:function(){this.ref||(this.layout=new LayoutProperties[this.type](StyleConstant.resolveAll(this._layer.layout,this._constants)),"line"===this.layout["symbol-placement"]&&(this.layout.hasOwnProperty("text-rotation-alignment")||(this.layout["text-rotation-alignment"]="map"),this.layout.hasOwnProperty("icon-rotation-alignment")||(this.layout["icon-rotation-alignment"]="map"),this.layout["symbol-avoid-edges"]=!0))},setLayoutProperty:function(t,i){this.layout[t]=StyleConstant.resolve(i,this._constants)},getLayoutProperty:function(t){return this.layout[t]},resolveReference:function(t){this.ref&&this.assign(t[this.ref])},resolvePaint:function(){for(var t in this._layer){var i=t.match(/^paint(?:\.(.*))?$/);i&&(this._resolved[i[1]||""]=new StyleDeclarationSet("paint",this.type,this._layer[t],this._constants))}},setPaintProperty:function(t,i,e){var o=this._resolved[e||""];o||(o=this._resolved[e||""]=new StyleDeclarationSet("paint",this.type,{},this._constants)),o[t]=i},getPaintProperty:function(t,i){var e=this._resolved[i||""];return e?e[t]:void 0},cascade:function(t,i,e,o){for(var a in this._resolved)if(""===a||t[a]){var s=this._resolved[a],n=s.values();for(var r in n){var l=n[r],y=this._cascaded[r];if(!y||y.declaration.json!==l.json){var h=i.transition?s.transition(r,e):{duration:0,delay:0},u=this._cascaded[r]=new StyleTransition(l,y,h);u.instant()||(u.loopID=o.set(u.endTime-(new Date).getTime())),y&&o.cancel(y.loopID)}}}},recalculate:function(t,i){var e=this.type,o=this.paint=new PaintProperties[e];for(var a in this._cascaded)o[a]=this._cascaded[a].at(t,i);if(this.hidden=this.minzoom&&t<this.minzoom||this.maxzoom&&t>=this.maxzoom||"none"===this.layout.visibility,"symbol"===e?0!==o["text-opacity"]&&this.layout["text-field"]||0!==o["icon-opacity"]&&this.layout["icon-image"]?(premultiplyLayer(o,"text"),premultiplyLayer(o,"icon")):this.hidden=!0:0===o[e+"-opacity"]?this.hidden=!0:premultiplyLayer(o,e),this._cascaded["line-dasharray"]){var s=o["line-dasharray"],n=this._cascaded["line-width"]?this._cascaded["line-width"].at(Math.floor(t),1/0):o["line-width"];s.fromScale*=n,s.toScale*=n}return!this.hidden},assign:function(t){util.extend(this,util.pick(t,"type","source","source-layer","minzoom","maxzoom","filter","layout"))},json:function(){return util.extend({},this._layer,util.pick(this,"type","source","source-layer","minzoom","maxzoom","filter","layout","paint"))}};
},{"../util/util":90,"./layout_properties":46,"./paint_properties":47,"./style_constant":50,"./style_declaration_set":52,"./style_transition":54}],54:[function(require,module,exports){
"use strict";function StyleTransition(t,i,e){this.declaration=t,this.startTime=this.endTime=(new Date).getTime();var n=t.type;this.interp="string"!==n&&"array"!==n||!t.transitionable?interpolate[n]:interpZoomTransitioned,this.oldTransition=i,this.duration=e.duration||0,this.delay=e.delay||0,this.instant()||(this.endTime=this.startTime+this.duration+this.delay,this.ease=util.easeCubicInOut),i&&i.endTime<=this.startTime&&delete i.oldTransition}function interpZoomTransitioned(t,i,e){return{from:t.to,fromScale:t.toScale,to:i.to,toScale:i.toScale,t:e}}var util=require("../util/util"),interpolate=require("../util/interpolate");module.exports=StyleTransition,StyleTransition.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},StyleTransition.prototype.at=function(t,i,e){var n=this.declaration.calculate(t,i,this.duration);if(this.instant())return n;if(e=e||Date.now(),e<this.endTime){var a=this.oldTransition.at(t,i,this.startTime),r=this.ease((e-this.startTime-this.delay)/this.duration);n=this.interp(a,n,r)}return n};
},{"../util/interpolate":86,"../util/util":90}],55:[function(require,module,exports){
"use strict";function Anchor(t,e,o,n,i){this.x=t,this.y=e,this.angle=o,this.scale=n,void 0!==i&&(this.segment=i)}var Point=require("point-geometry");module.exports=Anchor,Anchor.prototype=Object.create(Point.prototype),Anchor.prototype.clone=function(){return new Anchor(this.x,this.y,this.angle,this.scale,this.segment)};
},{"point-geometry":104}],56:[function(require,module,exports){
"use strict";function BinPack(e,h){this.width=e,this.height=h,this.free=[{x:0,y:0,w:e,h:h}]}module.exports=BinPack,BinPack.prototype.release=function(e){for(var h=0;h<this.free.length;h++){var i=this.free[h];if(i.y===e.y&&i.h===e.h&&i.x+i.w===e.x)i.w+=e.w;else if(i.x===e.x&&i.w===e.w&&i.y+i.h===e.y)i.h+=e.h;else if(e.y===i.y&&e.h===i.h&&e.x+e.w===i.x)i.x=e.x,i.w+=e.w;else{if(e.x!==i.x||e.w!==i.w||e.y+e.h!==i.y)continue;i.y=e.y,i.h+=e.h}return this.free.splice(h,1),void this.release(i)}this.free.push(e)},BinPack.prototype.allocate=function(e,h){for(var i={x:1/0,y:1/0,w:1/0,h:1/0},t=-1,s=0;s<this.free.length;s++){var r=this.free[s];e<=r.w&&h<=r.h&&r.y<=i.y&&r.x<=i.x&&(i=r,t=s)}return 0>t?{x:-1,y:-1}:(this.free.splice(t,1),i.w<i.h?(i.w>e&&this.free.push({x:i.x+e,y:i.y,w:i.w-e,h:h}),i.h>h&&this.free.push({x:i.x,y:i.y+h,w:i.w,h:i.h-h})):(i.w>e&&this.free.push({x:i.x+e,y:i.y,w:i.w-e,h:i.h}),i.h>h&&this.free.push({x:i.x,y:i.y+h,w:e,h:i.h-h})),{x:i.x,y:i.y,w:e,h:h})};
},{}],57:[function(require,module,exports){
"use strict";function Collision(a,e,t){this.hTree=rbush(),this.cTree=rbush(),this.tilePixelRatio=e/t,this.zoom=a,this.maxPlacementScale=2;var n=4096,o=n*this.tilePixelRatio*2,i=[2*Math.PI,0];this.left={anchor:new Point(0,0),box:{x1:-o,y1:-o,x2:0,y2:o},placementRange:i,placementScale:.5,maxScale:1/0,padding:0},this.top={anchor:new Point(0,0),box:{x1:-o,y1:-o,x2:o,y2:0},placementRange:i,placementScale:.5,maxScale:1/0,padding:0},this.bottom={anchor:new Point(n,n),box:{x1:-o,y1:0,x2:o,y2:o},placementRange:i,placementScale:.5,maxScale:1/0,padding:0},this.right={anchor:new Point(n,n),box:{x1:0,y1:-o,x2:o,y2:o},placementRange:i,placementScale:.5,maxScale:1/0,padding:0}}var rbush=require("rbush"),rotationRange=require("./rotation_range"),Point=require("point-geometry");module.exports=Collision,Collision.prototype.getPlacementScale=function(a,e,t){for(var n=this.left,o=this.right,i=this.top,h=this.bottom,r=0;r<a.length;r++){var x=a[r],l=x.box,c=x.hBox||l,s=x.anchor,m=x.padding,p=Math.max(e,x.minScale),y=x.maxScale||1/0;if(!(p>=y)){var g=this.getBox(s,c,p,y),u=this.hTree.search(g).concat(this.cTree.search(g));if(t&&(g[0]<0&&u.push(n),g[1]<0&&u.push(i),g[2]>=4096&&u.push(o),g[3]>=4096&&u.push(h)),u.length)for(var S=s,d=l,b=0;b<u.length;b++){var f=u[b].anchor,v=u[b].box;if(S.equals(f))return null;var M=8*Math.max(m,u[b].padding),P=(v.x1-d.x2-M)/(S.x-f.x),R=(v.x2-d.x1+M)/(S.x-f.x),B=(v.y1-d.y2-M)/(S.y-f.y),N=(v.y2-d.y1+M)/(S.y-f.y);(isNaN(P)||isNaN(R))&&(P=R=1),(isNaN(B)||isNaN(N))&&(B=N=1);var T=Math.min(Math.max(P,R),Math.max(B,N));if(T>e&&T>p&&y>T&&T<u[b].maxScale&&(e=T),e>this.maxPlacementScale)return null}}}return e},Collision.prototype.getPlacementRange=function(a,e,t){for(var n=[2*Math.PI,0],o=0;o<a.length;o++){var i=a[o],h=i.hBox||i.box,r=i.anchor,x=r.x+h.x1/e,l=r.y+h.y1/e,c=r.x+h.x2/e,s=r.y+h.y2/e,m=[x,l,c,s],p=this.hTree.search(m);t&&(p=p.concat(this.cTree.search(m)));for(var y=0;y<p.length;y++){var g,u,S,d,b,f,v=p[y],M=v.hBox||v.box;if(e>v.placementScale?(g=v.anchor.x+M.x1/e,S=v.anchor.y+M.y1/e,u=v.anchor.x+M.x2/e,d=v.anchor.y+M.y2/e,b=c>g&&u>x,f=s>S&&d>l):(g=r.x+h.x1/v.placementScale,S=r.y+h.y1/v.placementScale,u=r.x+h.x2/v.placementScale,d=r.y+h.y2/v.placementScale,b=g<v[2]&&u>v[0],f=S<v[3]&&d>v[1]),b&&f){var P=Math.max(e,v.placementScale),R=rotationRange.rotationRange(i,v,P);n[0]=Math.min(n[0],R[0]),n[1]=Math.max(n[1],R[1])}}}return n},Collision.prototype.insert=function(a,e,t,n,o){for(var i=[],h=0;h<a.length;h++){var r=a[h],x=r.hBox||r.box,l=Math.max(t,r.minScale),c=r.maxScale||1/0,s=this.getBox(e,x,l,c);s.anchor=e,s.box=r.box,r.hBox&&(s.hBox=x),s.placementRange=n,s.placementScale=l,s.maxScale=c,s.padding=r.padding,i.push(s)}(o?this.hTree:this.cTree).load(i)},Collision.prototype.getBox=function(a,e,t,n){return[a.x+Math.min(e.x1/t,e.x1/n),a.y+Math.min(e.y1/t,e.y1/n),a.x+Math.max(e.x2/t,e.x2/n),a.y+Math.max(e.y2/t,e.y2/n)]};
},{"./rotation_range":65,"point-geometry":104,"rbush":105}],58:[function(require,module,exports){
"use strict";function GlyphAtlas(t,i){this.width=t,this.height=i,this.bin=new BinPack(t,i),this.index={},this.ids={},this.data=new Uint8Array(t*i)}var BinPack=require("./bin_pack");module.exports=GlyphAtlas,GlyphAtlas.prototype={get debug(){return"canvas"in this},set debug(t){t&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!t&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},GlyphAtlas.prototype.getGlyphs=function(){var t,i,e,s={};for(var h in this.ids)t=h.split("#"),i=t[0],e=t[1],s[i]||(s[i]=[]),s[i].push(e);return s},GlyphAtlas.prototype.getRects=function(){var t,i,e,s={};for(var h in this.ids)t=h.split("#"),i=t[0],e=t[1],s[i]||(s[i]={}),s[i][e]=this.index[h];return s},GlyphAtlas.prototype.removeGlyphs=function(t){for(var i in this.ids){var e=this.ids[i],s=e.indexOf(t);if(s>=0&&e.splice(s,1),this.ids[i]=e,!e.length){for(var h=this.index[i],a=this.data,r=0;r<h.h;r++)for(var n=this.width*(h.y+r)+h.x,d=0;d<h.w;d++)a[n+d]=0;this.dirty=!0,this.bin.release(h),delete this.index[i],delete this.ids[i]}}this.updateTexture(this.gl)},GlyphAtlas.prototype.addGlyph=function(t,i,e,s){if(!e)return null;var h=i+"#"+e.id;if(this.index[h])return this.ids[h].indexOf(t)<0&&this.ids[h].push(t),this.index[h];if(!e.bitmap)return null;var a=e.width+2*s,r=e.height+2*s,n=a,d=r;n+=4-n%4,d+=4-d%4;var l=this.bin.allocate(n,d);if(l.x<0)return console.warn("glyph bitmap overflow"),{glyph:e,rect:null};l.l=e.left,l.t=e.top,this.index[h]=l,this.ids[h]=[t];for(var o=this.data,c=e.bitmap,p=0;r>p;p++)for(var u=this.width*(l.y+p)+l.x,x=a*p,E=0;a>E;E++)o[u+E]=c[x+E];return this.dirty=!0,l},GlyphAtlas.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},GlyphAtlas.prototype.updateTexture=function(t){if(this.bind(t),this.dirty){if(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.ctx){for(var i=this.ctx.getImageData(0,0,this.width,this.height),e=0,s=0;e<this.data.length;e++,s+=4)i.data[s]=this.data[e],i.data[s+1]=this.data[e],i.data[s+2]=this.data[e],i.data[s+3]=255;this.ctx.putImageData(i,0,0),this.ctx.strokeStyle="red";for(var h=0;h<this.bin.free.length;h++){var a=this.bin.free[h];this.ctx.strokeRect(a.x,a.y,a.w,a.h)}}this.dirty=!1}};
},{"./bin_pack":56}],59:[function(require,module,exports){
"use strict";function GlyphSource(t,e){this.url=t&&normalizeURL(t),this.glyphAtlas=e,this.stacks={},this.loading={}}function simpleGlyph(t){return{advance:t.advance,left:t.left,top:t.top}}function glyphUrl(t,e,r,l){return l=l||"abc",r.replace("{s}",l[t.length%l.length]).replace("{fontstack}",t).replace("{range}",e)}var normalizeURL=require("../util/mapbox").normalizeGlyphsURL,getArrayBuffer=require("../util/ajax").getArrayBuffer,Glyphs=require("../util/glyphs"),Protobuf=require("pbf");module.exports=GlyphSource,GlyphSource.prototype.getRects=function(t,e,r,l){void 0===this.stacks[t]&&(this.stacks[t]={});for(var i,s={},a={},o={rects:s,glyphs:a},h=this.stacks[t],n=this.glyphAtlas,p={},u=0,f=0;f<e.length;f++){var c=e[f];if(i=Math.floor(c/256),h[i]){var y=h[i].glyphs[c],g=3;s[c]=n.addGlyph(r,t,y,g),y&&(a[c]=simpleGlyph(y))}else void 0===p[i]&&(p[i]=[],u++),p[i].push(c)}u||l(void 0,o);var d=function(e,i,h){if(!e)for(var f=this.stacks[t][i]=h.stacks[t],c=0;c<p[i].length;c++){var y=p[i][c],g=f.glyphs[y],d=3;s[y]=n.addGlyph(r,t,g,d),g&&(a[y]=simpleGlyph(g))}u--,u||l(void 0,o)}.bind(this);for(var v in p)this.loadRange(t,v,d)},GlyphSource.prototype.loadRange=function(t,e,r){if(256*e>=65280)return r("gyphs > 65280 not supported");void 0===this.loading[t]&&(this.loading[t]={});var l=this.loading[t];if(l[e])l[e].push(r);else{l[e]=[r];var i=256*e+"-"+(256*e+255),s=glyphUrl(t,i,this.url);getArrayBuffer(s,function(t,r){for(var i=!t&&new Glyphs(new Protobuf(new Uint8Array(r))),s=0;s<l[e].length;s++)l[e][s](t,e,i);delete l[e]})}};
},{"../util/ajax":78,"../util/glyphs":85,"../util/mapbox":87,"pbf":102}],60:[function(require,module,exports){
"use strict";function interpolate(r,e,n,a,i,t){void 0===n&&(n=0),a=Math.round(Math.max(Math.min(8,a/2),1)),e*=i/a,t*=i;for(var l=minScaleArrays[a],o=l.length,c=0,m=t?t-e:0,h=0,u=[],p=0;p<r.length-1;p++){for(var s=r[p],S=r[p+1],v=s.dist(S),y=S.angleTo(s);c+v>m+e;){m+=e;var d=(m-c)/v,x=interp(s.x,S.x,d),A=interp(s.y,S.y,d),f=l[h%o];x>=0&&4096>x&&A>=0&&4096>A&&u.push(new Anchor(x,A,y,f,p)),h++}c+=v}return u}var interp=require("../util/interpolate"),Anchor=require("../symbol/anchor");module.exports=interpolate;var minScale=.5,minScaleArrays={1:[minScale],2:[minScale,2],4:[minScale,4,2,4],8:[minScale,8,4,8,2,8,4,8]};
},{"../symbol/anchor":55,"../util/interpolate":86}],61:[function(require,module,exports){
"use strict";module.exports=function(e,t,n){function r(r){c.push(e[r]),f.push(n[r]),v.push(t[r]),h++}function u(e,t,n){var r=l[e];return delete l[e],l[t]=r,f[r][0].pop(),f[r][0]=f[r][0].concat(n[0]),r}function i(e,t,n){var r=a[t];return delete a[t],a[e]=r,f[r][0].shift(),f[r][0]=n[0].concat(f[r][0]),r}function o(e,t,n){var r=n?t[0][t[0].length-1]:t[0][0];return e+":"+r.x+":"+r.y}var s,a={},l={},c=[],f=[],v=[],h=0;for(s=0;s<e.length;s++){var p=n[s],d=t[s];if(d){var g=o(d,p),x=o(d,p,!0);if(g in l&&x in a&&l[g]!==a[x]){var m=i(g,x,p),y=u(g,x,f[m]);delete a[g],delete l[x],l[o(d,f[y],!0)]=y,f[m]=null}else g in l?u(g,x,p):x in a?i(g,x,p):(r(s),a[g]=h-1,l[x]=h-1)}else r(s)}return{features:c,textFeatures:v,geometries:f}};
},{}],62:[function(require,module,exports){
"use strict";function getIcon(a,t,e,n,i){var x=i["icon-offset"][0],l=i["icon-offset"][1],h=x-t.originalWidth/2,o=h+t.w,r=l-t.originalHeight/2,m=r+t.h,c=new Point(h,r),y=new Point(o,r),s=new Point(o,m),g=new Point(h,m),M=i["icon-rotate"]*Math.PI/180;if(void 0!==a.segment&&"viewport"!==i["icon-rotation-alignment"]){var f=n[a.segment];M+=-Math.atan2(f.x-a.x,f.y-a.y)+Math.PI/2}if(M){var S=Math.sin(M),p=Math.cos(M),u=[p,-S,S,p];c=c.matMult(u),y=y.matMult(u),g=g.matMult(u),s=s.matMult(u),h=Math.min(c.x,y.x,g.x,s.x),o=Math.max(c.x,y.x,g.x,s.x),r=Math.min(c.y,y.y,g.y,s.y),m=Math.max(c.y,y.y,g.y,s.y)}var v={x1:h*e,x2:o*e,y1:r*e,y2:m*e},d={box:v,anchor:a,minScale:minScale,maxScale:1/0,padding:i["icon-padding"]},P={tl:c,tr:y,br:s,bl:g,tex:t,angle:0,anchor:a,minScale:minScale,maxScale:1/0};return{shapes:[P],boxes:[d],minScale:a.scale}}function getGlyphs(a,t,e,n,i,x,l,h){for(var o=h["text-max-angle"]*Math.PI/180,r=h["text-rotate"]*Math.PI/180,m=h["text-padding"],c="viewport"!==h["text-rotation-alignment"],y=h["text-keep-upright"],s=[],g=[],M=3,f=0;f<e.length;f++){var S=e[f],p=n[S.fontstack],u=p.glyphs[S.glyph],v=p.rects[S.glyph];if(u&&v&&v.w>0&&v.h>0){var d,P=(t.x+S.x+u.left-M+v.w/2)*i;void 0!==a.segment&&c?(d=[],getSegmentGlyphs(d,a,P,l,a.segment,1,o),y&&getSegmentGlyphs(d,a,P,l,a.segment,-1,o)):d=[{anchor:a,offset:0,angle:0,maxScale:1/0,minScale:minScale}];for(var b=t.x+S.x+u.left-M,I=t.y+S.y-u.top-M,w=b+v.w,G=I+v.h,k=new Point(b,I),q=new Point(w,I),B=new Point(b,G),_=new Point(w,G),H={x1:i*b,y1:i*I,x2:i*w,y2:i*G},W=0;W<d.length;W++){var j=d[W],z=k,A=q,C=B,D=_,E=H,F=j.angle+r;if(F){var J=Math.sin(F),K=Math.cos(F),L=[K,-J,J,K];z=z.matMult(L),A=A.matMult(L),C=C.matMult(L),D=D.matMult(L)}var N=Math.max(j.minScale,a.scale);s.push({tl:z,tr:A,bl:C,br:D,tex:v,angle:(a.angle+r+j.offset+2*Math.PI)%(2*Math.PI),anchor:j.anchor,minScale:N,maxScale:j.maxScale}),j.offset||(F&&(E={x1:i*Math.min(z.x,A.x,C.x,D.x),y1:i*Math.min(z.y,A.y,C.y,D.y),x2:i*Math.max(z.x,A.x,C.x,D.x),y2:i*Math.max(z.y,A.y,C.y,D.y)}),g.push({box:E,anchor:j.anchor,minScale:N,maxScale:j.maxScale,padding:m}))}}}x&&(g=[getMergedBoxes(g,a)]);for(var O=a.scale,Q=1/0,R=0;R<g.length;R++)Q=Math.min(Q,g[R].minScale);return Q=Math.max(O,minScale),{boxes:g,shapes:s,minScale:Q}}function getSegmentGlyphs(a,t,e,n,i,x,l){var h=0>x;0>e&&(x*=-1),x>0&&i++;var o,r=t,m=n[i],c=1/0;e=Math.abs(e);for(var y=t.scale;;){var s=r.dist(m),g=e/s,M=-Math.atan2(m.x-r.x,m.y-r.y)+x*Math.PI/2;h&&(M+=Math.PI);var f=(M-o)%(2*Math.PI);if(o&&Math.abs(f)>l){t.scale=c;break}if(a.push({anchor:r,offset:h?Math.PI:0,minScale:g,maxScale:c,angle:(M+2*Math.PI)%(2*Math.PI)}),y>=g)break;for(r=m;r.equals(m);)if(i+=x,m=n[i],!m)return void(t.scale=g);var S=m.sub(r)._unit();r=r.sub(S._mult(s)),c=g,o=M}}function getMergedBoxes(a,t){for(var e={box:{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0},anchor:t,minScale:0,padding:-1/0},n=e.box,i=0;i<a.length;i++){var x=a[i].box;n.x1=Math.min(n.x1,x.x1),n.y1=Math.min(n.y1,x.y1),n.x2=Math.max(n.x2,x.x2),n.y2=Math.max(n.y2,x.y2),e.minScale=Math.max(e.minScale,a[i].minScale),e.padding=Math.max(e.padding,a[i].padding)}var l=n.x1*n.x1,h=n.y1*n.y1,o=n.x2*n.x2,r=n.y2*n.y2,m=Math.sqrt(Math.max(l+h,l+r,o+h,o+r));return e.hBox={x1:-m,y1:-m,x2:m,y2:m},e}var Point=require("point-geometry");module.exports={getIcon:getIcon,getGlyphs:getGlyphs};var minScale=.5;
},{"point-geometry":104}],63:[function(require,module,exports){
"use strict";function resolveIcons(e,r){for(var o=[],s=0,n=e.length;n>s;s++){var t=resolveTokens(e[s].properties,r["icon-image"]);t&&o.indexOf(t)<0&&o.push(t)}return o}var resolveTokens=require("../util/token");module.exports=resolveIcons;
},{"../util/token":89}],64:[function(require,module,exports){
"use strict";function resolveText(e,r,t){for(var o=[],s=[],n=0,u=e.length;u>n;n++){var a=resolveTokens(e[n].properties,r["text-field"]),l=!1;if(a){a=a.toString();var i=r["text-transform"];"uppercase"===i?a=a.toLocaleUpperCase():"lowercase"===i&&(a=a.toLocaleLowerCase());for(var c=0,v=a.length;v>c;c++)a.charCodeAt(c)<=65533&&(s.push(a.charCodeAt(c)),l=!0);l&&(o[n]=a)}else o[n]=null}return s=uniq(s,t),{textFeatures:o,codepoints:s}}function uniq(e,r){var t,o=[];e.sort(sortNumbers);for(var s=0;s<e.length;s++)e[s]!==t&&(t=e[s],r[t]||o.push(e[s]));return o}function sortNumbers(e,r){return e-r}var resolveTokens=require("../util/token");module.exports=resolveText;
},{"../util/token":89}],65:[function(require,module,exports){
"use strict";function rotationRange(o,n,t){var i,r,e=o,a=n,s=new Point((a.anchor.x-e.anchor.x)*t,(a.anchor.y-e.anchor.y)*t);return e.hBox&&a.hBox?i=rotatingRotatingCollisions(e.box,a.box,s):e.hBox?(r={x1:a.box.x1+s.x,y1:a.box.y1+s.y,x2:a.box.x2+s.x,y2:a.box.y2+s.y},i=rotatingFixedCollisions(e.box,r)):a.hBox?(r={x1:e.box.x1-s.x,y1:e.box.y1-s.y,x2:e.box.x2-s.x,y2:e.box.y2-s.y},i=rotatingFixedCollisions(a.box,r)):i=[],mergeCollisions(i,n.placementRange)}function mergeCollisions(o,n){for(var t=2*Math.PI,i=0,r=0;r<o.length;r++){var e=o[r],a=n[0]<=e[0]&&e[0]<=n[1],s=n[0]<=e[1]&&e[1]<=n[1];a&&s||(a?(t=Math.min(t,n[1]),i=Math.max(i,e[1])):s?(t=Math.min(t,e[0]),i=Math.max(i,n[0])):(t=Math.min(t,e[0]),i=Math.max(i,e[1])))}return[t,i]}function rotatingRotatingCollisions(o,n,t){var i,r=t.mag(),e=t.angleWith(horizontal),a=[],s=[];a[0]=Math.asin((o.y2-n.y1)/r),a[1]=Math.asin((o.y2-n.y1)/r)+Math.PI,a[2]=2*Math.PI-Math.asin((-o.y1+n.y2)/r),a[3]=Math.PI-Math.asin((-o.y1+n.y2)/r),a[4]=2*Math.PI-Math.acos((o.x2-n.x1)/r),a[5]=Math.acos((o.x2-n.x1)/r),a[6]=Math.PI-Math.acos((-o.x1+n.x2)/r),a[7]=Math.PI+Math.acos((-o.x1+n.x2)/r);var x=o.x2-n.x1,l=-o.x1+n.x2,h=o.y2-n.y1,g=-o.y1+n.y2,y=[];for(y[0]=x*x+h*h,y[1]=l*l+h*h,y[2]=x*x+g*g,y[3]=l*l+g*g,y[4]=x*x+h*h,y[5]=x*x+g*g,y[6]=l*l+g*g,y[7]=l*l+h*h,a=a.filter(function(o,n){return!isNaN(o)&&r*r<=y[n]}).map(function(o){return(o+e+2*Math.PI)%(2*Math.PI)}),a.sort(),i=0;i<a.length;i+=2)s.push([a[i],a[i+1]]);return s}function rotatingFixedCollisions(o,n){for(var t=getCorners(o),i=getCorners(n),r=[],e=0;4>e;e++)cornerBoxCollisions(r,t[e],i),cornerBoxCollisions(r,i[e],t,!0);return r}function cornerBoxCollisions(o,n,t,i){for(var r=n.mag(),e=[],a=0,s=3;4>a;s=a++)circleEdgeCollisions(e,n,r,t[s],t[a]);if(e.length%2!==0)throw new Error("expecting an even number of intersections");e.sort();for(var x=0;x<e.length;x+=2)o[x/2]=i?[2*Math.PI-e[x+1],2*Math.PI-e[x]]:[e[x],e[x+1]];return o}function circleEdgeCollisions(o,n,t,i,r){var e=r.x-i.x,a=r.y-i.y,s=e*e+a*a,x=2*(e*i.x+a*i.y),l=i.x*i.x+i.y*i.y-t*t,h=x*x-4*s*l;if(h>0){var g=(-x-Math.sqrt(h))/(2*s),y=(-x+Math.sqrt(h))/(2*s);g>0&&1>g&&o.push(getAngle(i,r,g,n)),y>0&&1>y&&o.push(getAngle(i,r,y,n))}return o}function getAngle(o,n,t,i){return(-i.angleWithSep(interpolate(o.x,n.x,t),interpolate(o.y,n.y,t))+2*Math.PI)%(2*Math.PI)}function getCorners(o){return[new Point(o.x1,o.y1),new Point(o.x1,o.y2),new Point(o.x2,o.y2),new Point(o.x2,o.y1)]}var interpolate=require("../util/interpolate"),Point=require("point-geometry");module.exports={rotationRange:rotationRange,mergeCollisions:mergeCollisions,rotatingFixedCollisions:rotatingFixedCollisions,rotatingRotatingCollisions:rotatingRotatingCollisions,cornerBoxCollisions:cornerBoxCollisions,circleEdgeCollisions:circleEdgeCollisions,getCorners:getCorners};var horizontal=new Point(1,0);
},{"../util/interpolate":86,"point-geometry":104}],66:[function(require,module,exports){
"use strict";function shape(n,a,e,r,l,t,i,h,f,u){for(var o,g,s=e[a].glyphs,p=[],v=u[0],x=u[1],y=0;y<n.length;y++)g=n.charCodeAt(y),o=s[g],0!==g&&o&&(p.push({fontstack:a,glyph:g,x:v,y:x}),v+=o.advance+f);return p.length?p=linewrap(p,s,l,r,t,i,h):!1}function linewrap(n,a,e,r,l,t,i){var h=null,f=0,u=0,o=0,g=0;if(r)for(var s=0;s<n.length;s++){var p=n[s];if(p.x-=f,p.y+=e*o,p.x>r&&null!==h){var v=n[h+1].x;g=Math.max(v,g);for(var x=h+1;s>=x;x++)n[x].y+=e,n[x].x-=v;i&&justifyLine(n,a,u,h-1,i),u=h+1,h=null,f+=v,o++}breakable[p.glyph]&&(h=s)}return g=g||n[n.length-1].x,justifyLine(n,a,u,n.length-1,i),align(n,i,l,t,g,e,o),n}function justifyLine(n,a,e,r,l){for(var t=a[n[r].glyph].advance,i=(n[r].x+t)*l,h=e;r>=h;h++)n[h].x-=i}function align(n,a,e,r,l,t,i){for(var h=(a-e)*l,f=(-r*(i+1)+.5)*t,u=0;u<n.length;u++)n[u].x+=h,n[u].y+=f}module.exports={shape:shape};var breakable={32:!0};
},{}],67:[function(require,module,exports){
"use strict";function SpriteAtlas(t,i){this.width=t,this.height=i,this.bin=new BinPack(t,i),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0}function copyBitmap(t,i,e,h,a,s,r,o,n,l,p){var d,c,x=h*i+e,f=o*s+r;if(p)for(f-=s,c=-1;l>=c;c++,x=((c+l)%l+h)*i+e,f+=s)for(d=-1;n>=d;d++)a[f+d]=t[x+(d+n)%n];else for(c=0;l>c;c++,x+=i,f+=s)for(d=0;n>d;d++)a[f+d]=t[x+d]}var BinPack=require("./bin_pack");module.exports=SpriteAtlas,SpriteAtlas.prototype={get debug(){return"canvas"in this},set debug(t){t&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.canvas.style.width=this.width+"px",this.canvas.style.width=this.width+"px",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!t&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},SpriteAtlas.prototype.resize=function(t){if(this.pixelRatio===t)return!1;var i=this.pixelRatio;if(this.pixelRatio=t,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio),this.data){var e=this.data;this.data=!1,this.allocate(),this.texture=!1;for(var h=this.width*i,a=this.height*i,s=this.width*t,r=this.height*t,o=this.data,n=e,l=0;r>l;l++)for(var p=Math.floor(l*a/r)*h,d=l*s,c=0;s>c;c++){var x=Math.floor(c*h/s);o[d+c]=n[p+x]}e=null,this.dirty=!0}return this.dirty},SpriteAtlas.prototype.allocateImage=function(t,i){var e=2,h=t+e+(4-(t+e)%4),a=i+e+(4-(i+e)%4),s=this.bin.allocate(h,a);return 0===s.w?s:(s.originalWidth=t,s.originalHeight=i,s)},SpriteAtlas.prototype.getImage=function(t,i){if(this.images[t])return this.images[t];if(!this.sprite)return null;var e=this.sprite.getSpritePosition(t);if(!e.width||!e.height)return null;var h=this.allocateImage(e.width/e.pixelRatio,e.height/e.pixelRatio);return 0===h.w?h:(h.sdf=e.sdf,this.images[t]=h,this.copy(h,e,i),h)},SpriteAtlas.prototype.getPosition=function(t,i){var e=this.getImage(t,i);if(!e)return null;if(i){var h=this.sprite.getSpritePosition(t);if(!h.width||!h.height)return null;e.w=h.width/h.pixelRatio,e.h=h.height/h.pixelRatio}return{size:[e.w,e.h],tl:[e.x/this.width,e.y/this.height],br:[(e.x+e.w)/this.width,(e.y+e.h)/this.height]}},SpriteAtlas.prototype.allocate=function(){if(!this.data){var t=Math.floor(this.width*this.pixelRatio),i=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(t*i);for(var e=0;e<this.data.length;e++)this.data[e]=0}},SpriteAtlas.prototype.copy=function(t,i,e){if(this.sprite.img.data){var h=new Uint32Array(this.sprite.img.data.buffer);this.allocate();var a=this.data;copyBitmap(h,this.sprite.img.width,i.x,i.y,a,this.width*this.pixelRatio,t.x*this.pixelRatio,t.y*this.pixelRatio,i.width,i.height,e),this.dirty=!0}},SpriteAtlas.prototype.setSprite=function(t){this.sprite=t},SpriteAtlas.prototype.addIcons=function(t,i){for(var e=0;e<t.length;e++)this.getImage(t[e]);i(null,this.images)},SpriteAtlas.prototype.bind=function(t,i){var e=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e=!0);var h=i?t.LINEAR:t.NEAREST;if(h!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,h),this.filter=h),this.dirty&&(this.allocate(),e?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1,this.ctx)){var a=this.ctx.getImageData(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio);a.data.set(new Uint8ClampedArray(this.data.buffer)),this.ctx.putImageData(a,0,0),this.ctx.strokeStyle="red";for(var s=0;s<this.bin.free.length;s++){var r=this.bin.free[s];this.ctx.strokeRect(r.x*this.pixelRatio,r.y*this.pixelRatio,r.w*this.pixelRatio,r.h*this.pixelRatio)}}};
},{"./bin_pack":56}],68:[function(require,module,exports){
"use strict";function Attribution(){}var Control=require("./control"),DOM=require("../../util/dom"),util=require("../../util/util");module.exports=Attribution,Attribution.prototype=util.inherit(Control,{onAdd:function(t){var i="mapboxgl-ctrl-attrib",e=this._container=DOM.create("div",i,t.getContainer());return this._update(),t.on("source.load",this._update.bind(this)),t.on("source.change",this._update.bind(this)),t.on("source.remove",this._update.bind(this)),t.on("moveend",this._updateEditLink.bind(this)),e},_update:function(){var t=[];if(this._map.style)for(var i in this._map.style.sources){var e=this._map.style.sources[i];e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}this._container.innerHTML=t.join(" | "),this._editLink=this._container.getElementsByClassName("mapbox-improve-map")[0],this._updateEditLink()},_updateEditLink:function(){if(this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}}});
},{"../../util/dom":82,"../../util/util":90,"./control":69}],69:[function(require,module,exports){
"use strict";function Control(){}module.exports=Control,Control.prototype={addTo:function(t){return this._map=t,this._container=this.onAdd(t),this.options&&this.options.position&&(this._container.className+=" mapboxgl-ctrl-"+this.options.position),this},remove:function(){return this._container.parentNode.removeChild(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this}};
},{}],70:[function(require,module,exports){
"use strict";function Navigation(t){util.setOptions(this,t)}var Control=require("./control"),DOM=require("../../util/dom"),util=require("../../util/util");module.exports=Navigation,Navigation.prototype=util.inherit(Control,{options:{position:"topright"},onAdd:function(t){var o="mapboxgl-ctrl-nav",e=this._container=DOM.create("div",o,t.getContainer());this._zoomInButton=this._createButton(o+"-zoom-in",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(o+"-zoom-out",t.zoomOut.bind(t)),this._compass=this._createButton(o+"-compass",t.resetNorth.bind(t));var s=this._compassCanvas=DOM.create("canvas",o+"-compass-canvas",this._compass);return s.style.cssText="width:26px; height:26px;",s.width=52,s.height=52,this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._compassCtx=s.getContext("2d"),t.on("rotate",this._drawNorth.bind(this)),this._drawNorth(),e},_onCompassDown:function(t){DOM.disableDrag(),document.addEventListener("mousemove",this._onCompassMove),document.addEventListener("mouseup",this._onCompassUp),this._prevX=t.screenX,t.stopPropagation()},_onCompassMove:function(t){var o=t.screenX,e=2>o?-5:o>window.screen.width-2?5:(o-this._prevX)/4;this._map.setBearing(this._map.getBearing()-e),this._prevX=t.screenX,t.preventDefault()},_onCompassUp:function(){document.removeEventListener("mousemove",this._onCompassMove),document.removeEventListener("mouseup",this._onCompassUp),DOM.enableDrag()},_createButton:function(t,o){var e=DOM.create("button",t,this._container);return e.addEventListener("click",function(){o()}),e},_drawNorth:function(){var t=20,o=8,e=26,s=this._map.transform.angle+Math.PI/2,i=this._compassCtx;this._compassCanvas.width=this._compassCanvas.width,i.translate(e,e),i.rotate(s),i.beginPath(),i.fillStyle="#000",i.lineTo(0,-o),i.lineTo(-t,0),i.lineTo(0,o),i.fill(),i.beginPath(),i.fillStyle="#bbb",i.moveTo(0,0),i.lineTo(0,o),i.lineTo(t,0),i.lineTo(0,-o),i.fill(),i.beginPath(),i.strokeStyle="#fff",i.lineWidth=4,i.moveTo(0,-o),i.lineTo(0,o),i.stroke()}});
},{"../../util/dom":82,"../../util/util":90,"./control":69}],71:[function(require,module,exports){
"use strict";var util=require("../util/util"),interpolate=require("../util/interpolate"),browser=require("../util/browser"),LatLng=require("../geo/lat_lng"),LatLngBounds=require("../geo/lat_lng_bounds"),Point=require("point-geometry");util.extend(exports,{isEasing:function(){return!!this._abortFn},stop:function(){return this._abortFn&&(this._abortFn.call(this),delete this._abortFn,this._finishFn.call(this),delete this._finishFn),this},_ease:function(t,i,e){this._finishFn=i,this._abortFn=browser.timed(function(i){t.call(this,e.easing(i)),1===i&&(delete this._abortFn,this._finishFn.call(this),delete this._finishFn)},e.animate===!1?0:e.duration,this)},panBy:function(t,i){return this.panTo(this.transform.center,util.extend({offset:Point.convert(t).mult(-1)},i)),this},panTo:function(t,i){this.stop(),t=LatLng.convert(t),i=util.extend({duration:500,easing:util.ease,offset:[0,0]},i);var e=this.transform,n=Point.convert(i.offset).rotate(-e.angle),o=e.point,r=e.project(t).sub(n);return i.noMoveStart||this.fire("movestart"),this._ease(function(t){e.center=e.unproject(o.add(r.sub(o).mult(t))),this._move()},function(){this.fire("moveend")},i),this},zoomTo:function(t,i){this.stop(),i=util.extend({duration:500},i),i.easing=this._updateEasing(i.duration,t,i.easing);var e=this.transform,n=e.center,o=e.zoom;return i.around?n=LatLng.convert(i.around):i.offset&&(n=e.pointLocation(e.centerPoint.add(Point.convert(i.offset)))),i.animate===!1&&(i.duration=0),this.zooming||(this.zooming=!0,this.fire("movestart")),this._ease(function(i){e.setZoomAround(interpolate(o,t,i),n),this.animationLoop.set(300),this._move(!0)},function(){this.ease=null,i.duration>=200&&(this.zooming=!1,this.fire("moveend"))},i),i.duration<200&&(clearTimeout(this._onZoomEnd),this._onZoomEnd=setTimeout(function(){this.zooming=!1,this._rerender(),this.fire("moveend")}.bind(this),200)),this},zoomIn:function(t){this.zoomTo(this.getZoom()+1,t)},zoomOut:function(t){this.zoomTo(this.getZoom()-1,t)},rotateTo:function(t,i){this.stop(),i=util.extend({duration:500,easing:util.ease},i);var e=this.transform,n=this.getBearing(),o=e.center;return i.around?o=LatLng.convert(i.around):i.offset&&(o=e.pointLocation(e.centerPoint.add(Point.convert(i.offset)))),t=this._normalizeBearing(t,n),this.rotating=!0,this.fire("movestart"),this._ease(function(i){e.setBearingAround(interpolate(n,t,i),o),this._move(!1,!0)},function(){this.rotating=!1,this.fire("moveend")},i),this},resetNorth:function(t){return this.rotateTo(0,util.extend({duration:1e3},t))},fitBounds:function(t,i){i=util.extend({padding:0,offset:[0,0],maxZoom:1/0},i),t=LatLngBounds.convert(t);var e=Point.convert(i.offset),n=this.transform,o=n.project(t.getNorthWest()),r=n.project(t.getSouthEast()),s=r.sub(o),a=n.unproject(o.add(r).div(2)),u=(n.width-2*i.padding-2*Math.abs(e.x))/s.x,h=(n.height-2*i.padding-2*Math.abs(e.y))/s.y,f=Math.min(n.scaleZoom(n.scale*Math.min(u,h)),i.maxZoom);return i.linear?this.easeTo(a,f,0,i):this.flyTo(a,f,0,i)},easeTo:function(t,i,e,n){this.stop(),n=util.extend({offset:[0,0],duration:500,easing:util.ease},n);var o=this.transform,r=Point.convert(n.offset).rotate(-o.angle),s=this.getZoom(),a=this.getBearing();t=LatLng.convert(t),i=void 0===i?s:i,e=void 0===e?a:this._normalizeBearing(e,a);var u,h=o.zoomScale(i-s),f=o.point,d=t?o.project(t).sub(r.div(h)):o.point;return i!==s&&(u=o.pointLocation(o.centerPoint.add(d.sub(f).div(1-1/h))),this.zooming=!0),a!==e&&(this.rotating=!0),this.fire("movestart"),this._ease(function(t){i!==s?o.setZoomAround(interpolate(s,i,t),u):o.center=o.unproject(f.add(d.sub(f).mult(t))),e!==a&&(o.bearing=interpolate(a,e,t)),this.animationLoop.set(300),this._move(i!==s,e!==a)},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},n),this},flyTo:function(t,i,e,n){function o(t){var i=(b*b-_*_+(t?-1:1)*M*M*z*z)/(2*(t?b:_)*M*z);return Math.log(Math.sqrt(i*i+1)-i)}function r(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function a(t){return r(t)/s(t)}this.stop(),n=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},n),t=LatLng.convert(t);var u=Point.convert(n.offset),h=this.transform,f=this.getZoom(),d=this.getBearing();i=void 0===i?f:i,e=void 0===e?d:this._normalizeBearing(e,d);var c=h.zoomScale(i-f),m=h.point,l=h.project(t).sub(u.div(c));if(n.animate===!1)return this.setView(t,i,e);var g=h.worldSize,v=n.curve,p=n.speed,_=Math.max(h.width,h.height),b=_/c,z=l.sub(m).mag(),M=v*v,L=o(0),x=function(t){return s(L)/s(L+v*t)},T=function(t){return _*((s(L)*a(L+v*t)-r(L))/M)/z},B=(o(1)-L)/v;if(Math.abs(z)<1e-6){if(Math.abs(_-b)<1e-6)return this;var Z=_>b?-1:1;B=Math.abs(Math.log(b/_))/v,T=function(){return 0},x=function(t){return Math.exp(Z*v*t)}}return n.duration=1e3*B/p,this.zooming=!0,d!==e&&(this.rotating=!0),this.fire("movestart"),this._ease(function(t){var i=t*B,n=T(i);h.zoom=f+h.scaleZoom(1/x(i)),h.center=h.unproject(m.add(l.sub(m).mult(n)),g),e!==d&&(h.bearing=interpolate(d,e,t)),this.animationLoop.set(300),this._move(!0,e!==d)},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},n),this},_normalizeBearing:function(t,i){t=util.wrap(t,-180,180);var e=Math.abs(t-i);return Math.abs(t-360-i)<e&&(t-=360),Math.abs(t+360-i)<e&&(t+=360),t},_updateEasing:function(t,i,e){var n;if(this.ease){var o=this.ease,r=(Date.now()-o.start)/o.duration,s=o.easing(r+.01)-o.easing(r),a=.27/Math.sqrt(s*s+1e-4)*.01,u=Math.sqrt(.0729-a*a);n=util.bezier(a,u,.25,1)}else n=e?util.bezier.apply(util,e):util.ease;return this.ease={start:(new Date).getTime(),to:Math.pow(2,i),duration:t,easing:n},n}});
},{"../geo/lat_lng":16,"../geo/lat_lng_bounds":17,"../util/browser":79,"../util/interpolate":86,"../util/util":90,"point-geometry":104}],72:[function(require,module,exports){
"use strict";function Handlers(e){function t(){o&&(o.parentNode.removeChild(o),e.getContainer().classList.remove("mapboxgl-crosshair"),o=!1,DOM.enableDrag())}var n,o,a=.2,r=util.bezier(0,0,a,1);this.interaction=new Interaction(e.getCanvas()).on("click",function(t){e.fire("click",t)}).on("mousemove",function(t){e.fire("mousemove",t)}).on("down",function(){e.fire("movestart")}).on("resize",function(){e.stop(),e.resize(),e.update()}).on("keydown",function(t){function n(n){e.zoomTo(Math.round(e.getZoom())+(t.shiftKey?2:1)*n)}function o(t){e.panBy(t)}function a(t){e.setBearing(e.getBearing()+t)}if(!(t.altKey||t.ctrlKey||t.metaKey)){var r=80,i=2;switch(t.keyCode){case 61:case 107:case 171:case 187:n(1);break;case 189:case 109:case 173:n(-1);break;case 37:t.shiftKey?a(-i):o([-r,0]);break;case 39:t.shiftKey?a(i):o([r,0]);break;case 38:o([0,-r]);break;case 40:o([0,r]);break;default:return}}}).on("pan",function(t){e.stop(),e.transform.panBy(t.offset),e._move()}).on("panend",function(t){if(t.inertia){var n=t.inertia.mult(1e3*a),o=n.mag(),i=4e3;o>=i&&(o=i,n._unit()._mult(i));var s=8e3,u=o/(s*a),c=n.mult(-u/2).round();e.panBy(c,{duration:1e3*u,easing:r,noMoveStart:!0})}else e.fire("moveend")}).on("zoom",function(t){var n=2/(1+Math.exp(-Math.abs(t.delta/100)));t.delta<0&&0!==n&&(n=1/n);var o=e.ease&&isFinite(t.delta)?e.ease.to:e.transform.scale,a=isFinite(t.delta)?"trackpad"===t.source?0:300:800;e.zoomTo(e.transform.scaleZoom(o*n),{duration:a,around:e.unproject(t.point)})}).on("rotate",function(t){var o=e.transform.centerPoint,a=t.start.sub(o),r=a.mag();e.rotating=!0,200>r&&(o=t.start.add(new Point(-200,0)._rotate(a.angle())));var i=t.prev.sub(o).angleWith(t.current.sub(o))/Math.PI*180;e.transform.bearing=e.getBearing()-i,e._move(!1,!0),window.clearTimeout(n),n=window.setTimeout(function(){e.rotating=!1,e._rerender()},200)}).on("boxzoomstart",function(t){o||(o=DOM.create("div","mapboxgl-boxzoom",e.getContainer()),e.getContainer().classList.add("mapboxgl-crosshair"),e.fire("boxzoomstart"),DOM.disableDrag());var n=Math.min(t.start.x,t.current.x),a=Math.max(t.start.x,t.current.x),r=Math.min(t.start.y,t.current.y),i=Math.max(t.start.y,t.current.y);DOM.setTransform(o,"translate("+n+"px,"+r+"px)"),o.style.width=a-n+"px",o.style.height=i-r+"px"}).on("boxzoomend",function(n){t();var o=new LatLngBounds(e.unproject(n.start),e.unproject(n.current));e.fitBounds(o,{linear:!0}).fire("boxzoomend",{boxZoomBounds:o})}).on("boxzoomcancel",t)}var Interaction=require("./interaction"),Point=require("point-geometry"),util=require("../util/util"),DOM=require("../util/dom"),LatLngBounds=require("../geo/lat_lng_bounds");module.exports=Handlers;
},{"../geo/lat_lng_bounds":17,"../util/dom":82,"../util/util":90,"./interaction":74,"point-geometry":104}],73:[function(require,module,exports){
"use strict";function Hash(){util.bindAll(["_onHashChange","_updateHash"],this)}module.exports=Hash;var util=require("../util/util");Hash.prototype={addTo:function(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},remove:function(){return window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},_onHashChange:function(){var t=location.hash.replace("#","").split("/");return t.length>=3?(this._map.setView([+t[1],+t[2]],+t[0],+(t[3]||0)),!0):!1},_updateHash:function(){var t=this._map.getCenter(),e=this._map.getZoom(),a=this._map.getBearing(),h=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),n="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(h)+"/"+t.lng.toFixed(h)+(a?"/"+Math.round(10*a)/10:"");window.history.replaceState("","",n)}};
},{"../util/util":90}],74:[function(require,module,exports){
"use strict";function Interaction(e){function t(t){var n=e.getBoundingClientRect();return new Point(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)}function n(e,t,n){h.fire("zoom",{source:e,delta:t,point:n}),y=null,m=null}function i(e){h.fire("click",{point:e})}function r(e){h.fire("mousemove",{point:e})}function o(e){if(D){var t=D.sub(e);if(h.fire("pan",{offset:t}),y){var n=Date.now()-m;if(n){var i=n+m;for(y.push([i,e]);y.length>2&&i-y[0][0]>100;)y.shift()}}else y=[];m=Date.now(),D=e}}function l(){h.fire("resize")}function a(e){b&&27===e.keyCode&&(h.fire("boxzoomcancel"),b=!1),h.fire("keydown",e)}function u(e){D&&(h.fire("rotate",{start:g,prev:D,current:e}),D=e)}function f(e){h.fire("dblclick",{point:e})}function c(e){g=D=t(e),h.fire("down"),(e.shiftKey||1===e.which&&1===e.button)&&(b=!0)}function d(e){if(L=D&&g&&(D.x!==g.x||D.y!==g.y),E=!1,D=null,b)h.fire("boxzoomend",{start:g,current:t(e)}),b=!1;else if(y&&y.length>=2&&m>Date.now()-100){var n=y[y.length-1],i=y[0],r=n[1].sub(i[1]).div(n[0]-i[0]);h.fire("panend",{inertia:r})}else h.fire("panend");y=null,m=null}function s(n){var i=t(n);if(b)h.fire("boxzoomstart",{start:g,current:i});else if(E)u(i);else if(D)o(i);else{for(var l=n.toElement||n.target;l&&l!==e&&l.parentNode;)l=l.parentNode;l===e&&r(i)}}function v(e){L||i(t(e))}function w(e){f(t(e)),n("wheel",1/0*(e.shiftKey?-1:1),t(e)),e.preventDefault()}function p(n){function i(e,i){var r=u.now(),o=r-f;f=r;var l=t(i);0!==e&&e%4.000244140625===0?c="wheel":0!==e&&Math.abs(e)<4?c="trackpad":o>400?(c=null,s=e,d=setTimeout(function(){c="wheel",n(c,-s,l)},40)):null===c&&(c=Math.abs(o*e)<200?"trackpad":"wheel",d&&(clearTimeout(d),d=null,e+=s)),i.shiftKey&&e&&(e/=4),null!==c&&n(c,-e,l)}function r(e){var t=e.deltaY;l&&e.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL&&(t/=browser.devicePixelRatio),e.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(t*=40),i(t,e),e.preventDefault()}function o(e){var t=-e.wheelDeltaY;a&&(t/=3),i(t,e),e.preventDefault()}var l=/Firefox/i.test(navigator.userAgent),a=/Safari/i.test(navigator.userAgent)&&!/Chrom(ium|e)/i.test(navigator.userAgent),u=window.performance||Date;e.addEventListener("wheel",r,!1),e.addEventListener("mousewheel",o,!1);var f=0,c=null,d=null,s=null}var h=this;if(e){var m,E=!1,L=!1,b=!1,g=null,D=null,y=null;e.addEventListener("contextmenu",function(e){E=!0,g=D=t(e),e.preventDefault()},!1),e.addEventListener("mousedown",c,!1),document.addEventListener("mouseup",d,!1),document.addEventListener("mousemove",s,!1),e.addEventListener("click",v,!1),p(n),e.addEventListener("dblclick",w,!1),window.addEventListener("resize",l,!1),e.addEventListener("keydown",a,!1)}}var Evented=require("../util/evented"),browser=require("../util/browser"),Point=require("point-geometry");module.exports=Interaction,Interaction.prototype=Object.create(Evented);
},{"../util/browser":79,"../util/evented":84,"point-geometry":104}],75:[function(require,module,exports){
"use strict";var Canvas=require("../util/canvas"),util=require("../util/util"),browser=require("../util/browser"),Evented=require("../util/evented"),Style=require("../style/style"),AnimationLoop=require("../style/animation_loop"),GLPainter=require("../render/painter"),Transform=require("../geo/transform"),Hash=require("./hash"),Handlers=require("./handlers"),Easings=require("./easings"),LatLng=require("../geo/lat_lng"),LatLngBounds=require("../geo/lat_lng_bounds"),Point=require("point-geometry"),Attribution=require("./control/attribution"),Map=module.exports=function(t){if(t=this.options=util.inherit(this.options,t),this.animationLoop=new AnimationLoop,this.transform=new Transform(t.minZoom,t.maxZoom),t.maxBounds){var e=LatLngBounds.convert(t.maxBounds);this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform.lngRange=[e.getWest(),e.getEast()]}util.bindAll(["_forwardStyleEvent","_forwardSourceEvent","_forwardLayerEvent","_forwardTileEvent","_onStyleLoad","_onStyleChange","_onSourceAdd","_onSourceRemove","_onSourceUpdate","update","render"],this),this._setupContainer(),this._setupPainter(),this.handlers=t.interactive&&new Handlers(this),this._hash=t.hash&&(new Hash).addTo(this),this._hash&&this._hash._onHashChange()||this.setView(t.center,t.zoom,t.bearing),this.sources={},this.stacks={},this._classes={},this.resize(),t.classes&&this.setClasses(t.classes),t.style&&this.setStyle(t.style),t.attributionControl&&this.addControl(new Attribution)};util.extend(Map.prototype,Evented),util.extend(Map.prototype,Easings),util.extend(Map.prototype,{options:{center:[0,0],zoom:0,bearing:0,minZoom:0,maxZoom:20,interactive:!0,hash:!1,attributionControl:!0},addControl:function(t){return t.addTo(this),this},setView:function(t,e,s){this.stop();var i=this.transform,r=i.zoom!==+e,o=i.bearing!==+s;return i.center=LatLng.convert(t),i.zoom=+e,i.bearing=+s,this.fire("movestart")._move(r,o).fire("moveend")},setCenter:function(t){this.setView(t,this.getZoom(),this.getBearing())},setZoom:function(t){this.setView(this.getCenter(),t,this.getBearing())},setBearing:function(t){this.setView(this.getCenter(),this.getZoom(),t)},getCenter:function(){return this.transform.center},getZoom:function(){return this.transform.zoom},getBearing:function(){return this.transform.bearing},addClass:function(t,e){this._classes[t]||(this._classes[t]=!0,this.style&&this.style._cascade(this._classes,e))},removeClass:function(t,e){this._classes[t]&&(delete this._classes[t],this.style&&this.style._cascade(this._classes,e))},setClasses:function(t,e){this._classes={};for(var s=0;s<t.length;s++)this._classes[t[s]]=!0;this.style&&this.style._cascade(this._classes,e)},hasClass:function(t){return!!this._classes[t]},getClasses:function(){return Object.keys(this._classes)},resize:function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),this._canvas.resize(t,e),this.transform.width=t,this.transform.height=e,this.transform._constrain(),this.painter.resize(t,e),this.fire("movestart")._move().fire("resize").fire("moveend")},getBounds:function(){return new LatLngBounds(this.transform.pointLocation(new Point(0,0)),this.transform.pointLocation(this.transform.size))},project:function(t){return this.transform.locationPoint(LatLng.convert(t))},unproject:function(t){return this.transform.pointLocation(Point.convert(t))},featuresAt:function(t,e,s){return this.style.featuresAt(t,e,s),this},setStyle:function(t){return this.style&&this.style.off("load",this._onStyleLoad).off("error",this._forwardStyleEvent).off("change",this._onStyleChange).off("source.add",this._onSourceAdd).off("source.remove",this._onSourceRemove).off("source.load",this._onSourceUpdate).off("source.error",this._forwardSourceEvent).off("source.change",this._onSourceUpdate).off("layer.add",this._forwardLayerEvent).off("layer.remove",this._forwardLayerEvent).off("tile.add",this._forwardTileEvent).off("tile.remove",this._forwardTileEvent).off("tile.load",this.update).off("tile.error",this._forwardTileEvent)._remove(),t?(this.style=t instanceof Style?t:new Style(t,this.animationLoop),this.style.on("load",this._onStyleLoad).on("error",this._forwardStyleEvent).on("change",this._onStyleChange).on("source.add",this._onSourceAdd).on("source.remove",this._onSourceRemove).on("source.load",this._onSourceUpdate).on("source.error",this._forwardSourceEvent).on("source.change",this._onSourceUpdate).on("layer.add",this._forwardLayerEvent).on("layer.remove",this._forwardLayerEvent).on("tile.add",this._forwardTileEvent).on("tile.remove",this._forwardTileEvent).on("tile.load",this.update).on("tile.error",this._forwardTileEvent),this):(this.style=null,this)},addSource:function(t,e){return this.style.addSource(t,e),this},removeSource:function(t){return this.style.removeSource(t),this},addLayer:function(t,e){return this.style.addLayer(t,e),this.style._cascade(this._classes),this},removeLayer:function(t){return this.style.removeLayer(t),this.style._cascade(this._classes),this},setFilter:function(t,e){return this.style.setFilter(t,e),this},getFilter:function(t){return this.style.getFilter(t)},setPaintProperty:function(t,e,s,i){return this.style.setPaintProperty(t,e,s,i),this.style._cascade(this._classes),this.update(!0),this},getPaintProperty:function(t,e,s){return this.style.getPaintProperty(t,e,s)},setLayoutProperty:function(t,e,s){return this.style.setLayoutProperty(t,e,s),this},getLayoutProperty:function(t,e){return this.style.getLayoutProperty(t,e)},getContainer:function(){return this._container},getCanvas:function(){return this._canvas.getElement()},_move:function(t,e){return this.update(t).fire("move"),t&&this.fire("zoom"),e&&this.fire("rotate"),this},_setupContainer:function(){var t=this.options.container,e=this._container="string"==typeof t?document.getElementById(t):t;e&&e.classList.add("mapboxgl-map"),this._canvas=new Canvas(this,e)},_setupPainter:function(){var t=this._canvas.getWebGLContext();return t?void(this.painter=new GLPainter(t,this.transform)):void console.error("Failed to initialize WebGL")},_contextLost:function(t){t.preventDefault(),this._frameId&&browser.cancelFrame(this._frameId)},_contextRestored:function(){this._setupPainter(),this.resize(),this.update()},loaded:function(){return this._styleDirty||this._sourcesDirty?!1:this.style&&!this.style.loaded()?!1:!0},update:function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},render:function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&!this._sourcesDirtyTimeout&&(this._sourcesDirty=!1,this._sourcesDirtyTimeout=setTimeout(function(){this._sourcesDirtyTimeout=null}.bind(this),50),this.style._updateSources(this.transform)),this.painter.render(this.style,{debug:this.debug,vertices:this.vertices,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||!this.animationLoop.stopped())&&this._rerender(),this},remove:function(){return this._hash&&this._hash.remove(),browser.cancelFrame(this._frameId),clearTimeout(this._sourcesDirtyTimeout),this.setStyle(null),this},_rerender:function(){this.style&&!this._frameId&&(this._frameId=browser.frame(this.render))},_forwardStyleEvent:function(t){this.fire("style."+t.type,util.extend({style:t.target},t))},_forwardSourceEvent:function(t){this.fire(t.type,util.extend({style:t.target},t))},_forwardLayerEvent:function(t){this.fire(t.type,util.extend({style:t.target},t))},_forwardTileEvent:function(t){this.fire(t.type,util.extend({style:t.target},t))},_onStyleLoad:function(t){this.style._cascade(this._classes,{transition:!1}),this._forwardStyleEvent(t)},_onStyleChange:function(t){this.update(!0),this._forwardStyleEvent(t)},_onSourceAdd:function(t){var e=t.source;e.onAdd&&e.onAdd(this),this._forwardSourceEvent(t)},_onSourceRemove:function(t){var e=t.source;e.onRemove&&e.onRemove(this),this._forwardSourceEvent(t)},_onSourceUpdate:function(t){this.update(),this._forwardSourceEvent(t)}}),util.extendAll(Map.prototype,{_debug:!1,get debug(){return this._debug},set debug(t){this._debug=t,this.update()},_repaint:!1,get repaint(){return this._repaint},set repaint(t){this._repaint=t,this.update()},_vertices:!1,get vertices(){return this._vertices},set vertices(t){this._vertices=t,this.update()}});
},{"../geo/lat_lng":16,"../geo/lat_lng_bounds":17,"../geo/transform":18,"../render/painter":31,"../style/animation_loop":44,"../style/style":49,"../util/browser":79,"../util/canvas":80,"../util/evented":84,"../util/util":90,"./control/attribution":68,"./easings":71,"./handlers":72,"./hash":73,"point-geometry":104}],76:[function(require,module,exports){
"use strict";function Popup(t){util.setOptions(this,t),util.bindAll(["_updatePosition","_onClickClose"],this)}module.exports=Popup;var util=require("../util/util"),Evented=require("../util/evented"),DOM=require("../util/dom"),LatLng=require("../geo/lat_lng");Popup.prototype=util.inherit(Evented,{options:{closeButton:!0,closeOnClick:!0},addTo:function(t){return this._map=t,this._map.on("move",this._updatePosition),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},remove:function(){return this._container&&this._container.parentNode.removeChild(this._container),this._map&&(this._map.off("move",this._updatePosition),this._map.off("click",this._onClickClose),delete this._map),this},getLatLng:function(){return this._latLng},setLatLng:function(t){return this._latLng=LatLng.convert(t),this._update(),this},setText:function(t){return this._content=document.createTextNode(t),this._updateContent(),this},setHTML:function(t){this._content=document.createDocumentFragment();var i,e=document.createElement("body");for(e.innerHTML=t;;){if(i=e.firstChild,!i)break;this._content.appendChild(i)}return this._updateContent(),this},_update:function(){this._map&&(this._container||(this._container=DOM.create("div","mapboxgl-popup",this._map.getContainer()),this.options.closeButton&&(this._closeButton=DOM.create("button","mapboxgl-popup-close-button",this._container),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose)),this._wrapper=DOM.create("div","mapboxgl-popup-content",this._container),this._tip=DOM.create("div","mapboxgl-popup-tip",this._container)),this._updateContent(),this._updatePosition())},_updateContent:function(){if(this._content&&this._container){for(var t=this._wrapper;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(this._content)}},_updatePosition:function(){if(this._latLng&&this._container){var t=this._map.project(this._latLng).round();DOM.setTransform(this._container,"translate(-50%,-100%) translate("+t.x+"px,"+t.y+"px)")}},_onClickClose:function(){this.remove()}});
},{"../geo/lat_lng":16,"../util/dom":82,"../util/evented":84,"../util/util":90}],77:[function(require,module,exports){
"use strict";function Actor(t,e){this.target=t,this.parent=e,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)}module.exports=Actor,Actor.prototype.receive=function(t){var e,s=t.data;if("<response>"===s.type)e=this.callbacks[s.id],delete this.callbacks[s.id],e(s.error||null,s.data);else if("undefined"!=typeof s.id){var i=s.id;this.parent[s.type](s.data,function(t,e,s){this.postMessage({type:"<response>",id:String(i),error:t?String(t):null,data:e},s)}.bind(this))}else this.parent[s.type](s.data)},Actor.prototype.send=function(t,e,s,i){var a=null;s&&(this.callbacks[a=this.callbackID++]=s),this.postMessage({type:t,id:String(a),data:e},i)},Actor.prototype.postMessage=function(t,e){try{this.target.postMessage(t,e)}catch(s){this.target.postMessage(t)}};
},{}],78:[function(require,module,exports){
"use strict";exports.getJSON=function(e,t){var n=new XMLHttpRequest;return n.open("GET",e,!0),n.onerror=function(e){t(e)},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var e;try{e=JSON.parse(n.response)}catch(r){return t(r)}t(null,e)}else t(new Error(n.statusText))},n.send(),n},exports.getArrayBuffer=function(e,t){var n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onerror=function(e){t(e)},n.onload=function(){n.status>=200&&n.status<300&&n.response?t(null,n.response):t(new Error(n.statusText))},n.send(),n},exports.getImage=function(e,t){var n=new Image;return n.crossOrigin="Anonymous",n.onload=function(){t(null,n)},n.src=e,n.getData=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height).data},n},exports.getVideo=function(e,t){var n=document.createElement("video");n.crossOrigin="Anonymous",n.onloadstart=function(){t(null,n)};for(var r=0;r<e.length;r++){var o=document.createElement("source");o.src=e[r],n.appendChild(o)}return n.getData=function(){return n},n};
},{}],79:[function(require,module,exports){
"use strict";var frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;exports.frame=function(e){return frame(e)};var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;exports.cancelFrame=function(e){cancel(e)},exports.timed=function(e,t,r){function n(a){o||(window.performance||(a=Date.now()),a>=i+t?e.call(r,1):(e.call(r,(a-i)/t),exports.frame(n)))}if(!t)return e.call(r,1),null;var o=!1,i=window.performance?window.performance.now():Date.now();return exports.frame(n),function(){o=!0}},exports.supported=function(){for(var e=([function(){return"undefined"!=typeof window},function(){return"undefined"!=typeof document},function(){return!!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)},function(){return!(!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions))},function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON},function(){var e=document.createElement("canvas");return"supportsContext"in e?e.supportsContext("webgl")||e.supportsContext("experimental-webgl"):!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},function(){return"Worker"in window}]),t=0;t<e.length;t++)if(!e[t]())return!1;return!0},exports.hardwareConcurrency=navigator.hardwareConcurrency||8,Object.defineProperty(exports,"devicePixelRatio",{get:function(){return window.devicePixelRatio}});
},{}],80:[function(require,module,exports){
"use strict";function Canvas(t,a){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.classList.add("mapboxgl-canvas"),t.options.interactive&&this.canvas.classList.add("mapboxgl-interactive"),this.canvas.addEventListener("webglcontextlost",t._contextLost.bind(t),!1),this.canvas.addEventListener("webglcontextrestored",t._contextRestored.bind(t),!1),this.canvas.setAttribute("tabindex",0),a.appendChild(this.canvas)}module.exports=Canvas,Canvas.prototype.resize=function(t,a){var e=window.devicePixelRatio||1;this.canvas.width=e*t,this.canvas.height=e*a,this.canvas.style.width=t+"px",this.canvas.style.height=a+"px"},Canvas.prototype.getWebGLContext=function(){return this.canvas.getContext("experimental-webgl",{antialias:!1,alpha:!0,stencil:!0,depth:!1})},Canvas.prototype.getElement=function(){return this.canvas};
},{}],81:[function(require,module,exports){
"use strict";function Dispatcher(t,r){this.actors=[],this.currentActor=0;var e,s,o;for(o=0;t>o;o++){absolute?(s=new Blob(['importScripts("'+workerFile+'");'],{type:"application/javascript"}),e=window.URL.createObjectURL(s)):e=workerFile;var c=new window.Worker(e),i=new Actor(c,r);i.name="Worker "+o,this.actors.push(i)}}var Actor=require("../actor"),scripts=document.getElementsByTagName("script"),workerFile=(document.currentScript||scripts[scripts.length-1]).getAttribute("src"),absolute=-1!==workerFile.indexOf("http");module.exports=Dispatcher,Dispatcher.prototype={broadcast:function(t,r){for(var e=0;e<this.actors.length;e++)this.actors[e].send(t,r)},send:function(t,r,e,s,o){return("number"!=typeof s||isNaN(s))&&(s=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[s].send(t,r,e,o),s},remove:function(){for(var t=0;t<this.actors.length;t++)this.actors[t].target.terminate();this.actors=[]}};
},{"../actor":77}],82:[function(require,module,exports){
"use strict";function testProp(e){for(var t=0;t<e.length;t++)if(e[t]in docStyle)return e[t]}exports.create=function(e,t,r){var o=document.createElement(e);return t&&(o.className=t),r&&r.appendChild(o),o};var docStyle=document.documentElement.style,selectProp=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),userSelect;exports.disableDrag=function(){selectProp&&(userSelect=docStyle[selectProp],docStyle[selectProp]="none")},exports.enableDrag=function(){selectProp&&(docStyle[selectProp]=userSelect)};var transformProp=testProp(["transform","WebkitTransform"]);exports.setTransform=function(e,t){e.style[transformProp]=t};
},{}],83:[function(require,module,exports){
"use strict";module.exports={HTTP_URL:"http://a.tiles.mapbox.com",HTTPS_URL:"https://a.tiles.mapbox.com",FORCE_HTTPS:!1,REQUIRE_ACCESS_TOKEN:!0};
},{}],84:[function(require,module,exports){
"use strict";var util=require("./util");module.exports={on:function(t,e){return this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e),this},off:function(t,e){if(!t)return delete this._events,this;if(!this.listens(t))return this;if(e){var s=this._events[t].indexOf(e);s>=0&&this._events[t].splice(s,1),this._events[t].length||delete this._events[t]}else delete this._events[t];return this},once:function(t,e){var s=function(i){this.off(t,s),e.call(this,i)}.bind(this);return this.on(t,s),this},fire:function(t,e){if(!this.listens(t))return this;e=util.extend({},e),util.extend(e,{type:t,target:this});for(var s=this._events[t].slice(),i=0;i<s.length;i++)s[i].call(this,e);return this},listens:function(t){return!(!this._events||!this._events[t])}};
},{"./util":90}],85:[function(require,module,exports){
"use strict";function Glyphs(a,e){this.stacks=a.readFields(readFontstacks,{},e)}function readFontstacks(a,e,r){if(1===a){var t=r.readMessage(readFontstack,{glyphs:{}});e[t.name]=t}}function readFontstack(a,e,r){if(1===a)e.name=r.readString();else if(2===a)e.range=r.readString();else if(3===a){var t=r.readMessage(readGlyph,{});e.glyphs[t.id]=t}}function readGlyph(a,e,r){1===a?e.id=r.readVarint():2===a?e.bitmap=r.readBytes():3===a?e.width=r.readVarint():4===a?e.height=r.readVarint():5===a?e.left=r.readSVarint():6===a?e.top=r.readSVarint():7===a&&(e.advance=r.readVarint())}module.exports=Glyphs;
},{}],86:[function(require,module,exports){
"use strict";function interpolate(t,e,n){return t*(1-n)+e*n}module.exports=interpolate,interpolate.number=interpolate,interpolate.vec2=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n)]},interpolate.color=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n),interpolate(t[2],e[2],n),interpolate(t[3],e[3],n)]},interpolate.array=function(t,e,n){return t.map(function(t,r){return interpolate(t,e[r],n)})};
},{}],87:[function(require,module,exports){
"use strict";function normalizeURL(e,o,r){if(r=r||config.ACCESS_TOKEN,!r&&config.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox GL. See https://www.mapbox.com/developers/api/#access-tokens");var n=config.FORCE_HTTPS||"undefined"!=typeof document&&"https:"===document.location.protocol;if(e=e.replace(/^mapbox:\/\//,(n?config.HTTPS_URL:config.HTTP_URL)+o),e+=-1!==e.indexOf("?")?"&access_token=":"?access_token=",config.REQUIRE_ACCESS_TOKEN){if("s"===r[0])throw new Error("Use a public access token (pk.*) with Mapbox GL JS, not a secret access token (sk.*). See https://www.mapbox.com/developers/api/#access-tokens");e+=r}return e}var config=require("./config"),browser=require("./browser");module.exports.normalizeStyleURL=function(e,o){var r=e.match(/^mapbox:\/\/([^.]+)/);return r?normalizeURL(e,"/styles/v1/"+r[1]+"/",o):e},module.exports.normalizeSourceURL=function(e,o){return e.match(/^mapbox:\/\//)?(e=normalizeURL(e+".json","/v4/",o),0===e.indexOf("https")&&(e+="&secure"),e):e},module.exports.normalizeGlyphsURL=function(e,o){return e.match(/^mapbox:\/\//)?normalizeURL(e,"/v4/",o):e},module.exports.normalizeTileURL=function(e,o){return o&&o.match(/^mapbox:\/\//)?e.replace(/\.((?:png|jpg)\d*)(?=$|\?)/,browser.devicePixelRatio>=2?"@2x.$1":".$1"):e};
},{"./browser":79,"./config":83}],88:[function(require,module,exports){
"use strict";function MRUCache(t,e){this.max=t,this.onRemove=e,this.reset()}module.exports=MRUCache,MRUCache.prototype.reset=function(){for(var t in this.list)this.onRemove(this.list[t]);return this.list={},this.order=[],this},MRUCache.prototype.add=function(t,e){if(this.list[t]=e,this.order.push(t),this.order.length>this.max){var i=this.get(this.order[0]);i&&this.onRemove(i)}return this},MRUCache.prototype.has=function(t){return t in this.list},MRUCache.prototype.keys=function(){return this.order},MRUCache.prototype.get=function(t){if(!this.has(t))return null;var e=this.list[t];return delete this.list[t],this.order.splice(this.order.indexOf(t),1),e};
},{}],89:[function(require,module,exports){
"use strict";function resolveTokens(e,t){for(var r,n,o=t;r=o.match(tokenPattern);)n="undefined"==typeof e[r[1]]?"":e[r[1]],o=o.replace(r[0],n);return o}module.exports=resolveTokens;var tokenPattern=/{([^{}()\[\]<>$=:;.,^]+)}/;
},{}],90:[function(require,module,exports){
"use strict";var UnitBezier=require("unitbezier");exports.easeCubicInOut=function(r){if(0>=r)return 0;if(r>=1)return 1;var t=r*r,n=t*r;return 4*(.5>r?n:3*(r-t)+n-.75)},exports.bezier=function(r,t,n,e){var o=new UnitBezier(r,t,n,e);return function(r){return o.solve(r)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.premultiply=function(r){return r[0]*=r[3],r[1]*=r[3],r[2]*=r[3],r},exports.clamp=function(r,t,n){return Math.min(n,Math.max(t,r))},exports.wrap=function(r,t,n){var e=n-t;return r===n?r:((r-t)%e+e)%e+t},exports.coalesce=function(){for(var r=0;r<arguments.length;r++){var t=arguments[r];if(null!==t&&void 0!==t)return t}},exports.asyncEach=function(r,t,n){function e(){0===--o&&n()}var o=r.length;if(0===o)return n();for(var i=0;i<r.length;i++)t(r[i],e)},exports.keysDifference=function(r,t){var n=[];for(var e in r)e in t||n.push(e);return n},exports.extend=function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)r[e]=n[e]}return r},exports.extendAll=function(r,t){for(var n in t)Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n));return r},exports.inherit=function(r,t){var n="function"==typeof r?r.prototype:r,e=Object.create(n);return exports.extendAll(e,t),e},exports.pick=function(r){for(var t={},n=1;n<arguments.length;n++){var e=arguments[n];e in r&&(t[e]=r[e])}return t};var id=1;exports.uniqueId=function(){return id++},exports.throttle=function(r,t,n){var e,o,i,u;return u=function(){e=!1,o&&(i.apply(n,o),o=!1)},i=function(){e?o=arguments:(r.apply(n,arguments),setTimeout(u,t),e=!0)}},exports.debounce=function(r,t){var n,e;return function(){e=arguments,clearTimeout(n),n=setTimeout(function(){r.apply(null,e)},t)}},exports.bindAll=function(r,t){r.forEach(function(r){t[r]=t[r].bind(t)})},exports.setOptions=function(r,t){r.hasOwnProperty("options")||(r.options=r.options?Object.create(r.options):{});for(var n in t)r.options[n]=t[n];return r.options};
},{"unitbezier":106}],91:[function(require,module,exports){
function clamp_css_byte(e){return e=Math.round(e),0>e?0:e>255?255:e}function clamp_css_float(e){return 0>e?0:e>1?1:e}function parse_css_int(e){return clamp_css_byte("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function parse_css_float(e){return clamp_css_float("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function css_hue_to_rgb(e,r,l){return 0>l?l+=1:l>1&&(l-=1),1>6*l?e+(r-e)*l*6:1>2*l?r:2>3*l?e+(r-e)*(2/3-l)*6:e}function parseCSSColor(e){var r=e.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0]){if(4===r.length){var l=parseInt(r.substr(1),16);return l>=0&&4095>=l?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null}if(7===r.length){var l=parseInt(r.substr(1),16);return l>=0&&16777215>=l?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null}return null}var a=r.indexOf("("),t=r.indexOf(")");if(-1!==a&&t+1===r.length){var n=r.substr(0,a),s=r.substr(a+1,t-(a+1)).split(","),o=1;switch(n){case"rgba":if(4!==s.length)return null;o=parse_css_float(s.pop());case"rgb":return 3!==s.length?null:[parse_css_int(s[0]),parse_css_int(s[1]),parse_css_int(s[2]),o];case"hsla":if(4!==s.length)return null;o=parse_css_float(s.pop());case"hsl":if(3!==s.length)return null;var i=(parseFloat(s[0])%360+360)%360/360,u=parse_css_float(s[1]),g=parse_css_float(s[2]),d=.5>=g?g*(u+1):g+u-g*u,c=2*g-d;return[clamp_css_byte(255*css_hue_to_rgb(c,d,i+1/3)),clamp_css_byte(255*css_hue_to_rgb(c,d,i)),clamp_css_byte(255*css_hue_to_rgb(c,d,i-1/3)),o];default:return null}}return null}var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{exports.parseCSSColor=parseCSSColor}catch(e){}
},{}],92:[function(require,module,exports){
"use strict";function infix(t){return function(n,r,i){return"$type"===r?"t"+t+VectorTileFeatureTypes.indexOf(i):"p["+JSON.stringify(r)+"]"+t+JSON.stringify(i)}}function strictInfix(t){var n=infix(t);return function(t,r,i){return"$type"===r?n(t,r,i):"typeof(p["+JSON.stringify(r)+"]) === typeof("+JSON.stringify(i)+") && "+n(t,r,i)}}function compile(t){return operators[t[0]].apply(t,t)}function truth(){return!0}var VectorTileFeatureTypes=["Unknown","Point","LineString","Polygon"],operators={"==":infix("==="),"!=":infix("!=="),">":strictInfix(">"),"<":strictInfix("<"),"<=":strictInfix("<="),">=":strictInfix(">="),"in":function(t,n){return Array.prototype.slice.call(arguments,2).map(function(r){return"("+operators["=="](t,n,r)+")"}).join("||")||"false"},"!in":function(){return"!("+operators["in"].apply(this,arguments)+")"},any:function(){return Array.prototype.slice.call(arguments,1).map(function(t){return"("+compile(t)+")"}).join("||")||"false"},all:function(){return Array.prototype.slice.call(arguments,1).map(function(t){return"("+compile(t)+")"}).join("&&")||"true"},none:function(){return"!("+operators.any.apply(this,arguments)+")"}};module.exports=function(t){if(!t)return truth;var n="var p = f.properties || f.tags || {}, t = f.type; return "+compile(t)+";";return new Function("f",n)};
},{}],93:[function(require,module,exports){
"use strict";function clip(e,n,t,i,u,l){t/=n,i/=n;for(var r=[],p=0;p<e.length;p++){var s,h,c=e[p],o=c.geometry,a=c.type;if(c.min){if(s=c.min[u],h=c.max[u],s>=t&&i>=h){r.push(c);continue}if(s>i||t>h)continue}var g=1===a?clipPoints(o,t,i,u):clipGeometry(o,t,i,u,l,3===a);g.length&&r.push({geometry:g,type:a,tags:e[p].tags||null})}return r.length?r:null}function clipPoints(e,n,t,i){for(var u=[],l=0;l<e.length;l++){var r=e[l],p=r[i];p>=n&&t>=p&&u.push(r)}return u}function clipGeometry(e,n,t,i,u,l){for(var r=[],p=0;p<e.length;p++){var s,h,c=0,o=0,a=null,g=e[p],f=g.area,m=g.dist,v=g.length,w=[];for(h=0;v-1>h;h++)s=a||g[h],a=g[h+1],c=o||s[i],o=a[i],n>c?o>t?(w.push(u(s,a,n),u(s,a,t)),l||(w=newSlice(r,w,f,m))):o>=n&&w.push(u(s,a,n)):c>t?n>o?(w.push(u(s,a,t),u(s,a,n)),l||(w=newSlice(r,w,f,m))):t>=o&&w.push(u(s,a,t)):(w.push(s),n>o?(w.push(u(s,a,n)),l||(w=newSlice(r,w,f,m))):o>t&&(w.push(u(s,a,t)),l||(w=newSlice(r,w,f,m))));s=g[v-1],c=s[i],c>=n&&t>=c&&w.push(s),l&&w[0]!==w[w.length-1]&&w.push(w[0]),newSlice(r,w,f,m)}return r}function newSlice(e,n,t,i){return n.length&&(n.area=t,n.dist=i,e.push(n)),[]}module.exports=clip;
},{}],94:[function(require,module,exports){
"use strict";function convert(e,t){var r=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)convertFeature(r,e.features[o],t);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r){var o,n,a,i=t.geometry,c=i.type,l=i.coordinates,u=t.properties;if("Point"===c)e.push(create(u,1,[projectPoint(l)]));else if("MultiPoint"===c)e.push(create(u,1,project(l)));else if("LineString"===c)e.push(create(u,2,[project(l,r)]));else if("MultiLineString"===c||"Polygon"===c){for(a=[],o=0;o<l.length;o++)a.push(project(l[o],r));e.push(create(u,"Polygon"===c?3:2,a))}else if("MultiPolygon"===c){for(a=[],o=0;o<l.length;o++)for(n=0;n<l[o].length;n++)a.push(project(l[o][n],r));e.push(create(u,3,a))}else if("GeometryCollection"===c)for(o=0;o<i.geometries.length;o++)convertFeature(e,{geometry:i.geometries[o],properties:u},r);else console.warn("Unsupported GeoJSON type: "+i.type)}function create(e,t,r){var o={geometry:r,type:t,tags:e||null,min:[1,1],max:[0,0]};return calcBBox(o),o}function project(e,t){for(var r=[],o=0;o<e.length;o++)r.push(projectPoint(e[o]));return t&&(simplify(r,t),calcSize(r)),r}function projectPoint(e){var t=Math.sin(e[1]*Math.PI/180),r=e[0]/360+.5,o=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return[r,o,0]}function calcSize(e){for(var t,r,o=0,n=0,a=0;a<e.length-1;a++)t=r||e[a],r=e[a+1],o+=t[0]*r[1]-r[0]*t[1],n+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]);e.area=Math.abs(o/2),e.dist=n}function calcBBox(e){var t=e.geometry,r=e.min,o=e.max;if(1===e.type)calcRingBBox(r,o,t);else for(var n=0;n<t.length;n++)calcRingBBox(r,o,t[n]);return e}function calcRingBBox(e,t,r){for(var o,n=0;n<r.length;n++)o=r[n],e[0]=Math.min(o[0],e[0]),t[0]=Math.max(o[0],t[0]),e[1]=Math.min(o[1],e[1]),t[1]=Math.max(o[1],t[1])}module.exports=convert;var simplify=require("./simplify");
},{"./simplify":96}],95:[function(require,module,exports){
"use strict";function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var i=t.debug;i&&console.time("preprocess data");var o=1<<t.baseZoom,s=convert(e,t.tolerance/(o*t.extent));this.tiles={},i&&(console.timeEnd("preprocess data"),console.time("generate tiles up to z"+t.maxZoom),this.stats={},this.total=0),this.splitTile(s,0,0,0),i&&(console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles up to z"+t.maxZoom),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function isClippedSquare(e,t,i){if(1!==e.length)return!1;var o=e[0];if(3!==o.type||o.geometry.length>1)return!1;for(var s=0;s<o.geometry[0].length;s++){var n=o.geometry[0][s];if(n[0]!==-i&&n[0]!==t+i||n[1]!==-i&&n[1]!==t+i)return!1}return!0}function toID(e,t,i){return 32*((1<<e)*i+t)+e}function intersectX(e,t,i){return[i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function intersectY(e,t,i){return[(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i,1]}function extend(e,t){for(var i in t)e[i]=t[i];return e}module.exports=geojsonvt;var convert=require("./convert"),clip=require("./clip"),createTile=require("./tile");GeoJSONVT.prototype.options={baseZoom:14,maxZoom:4,maxPoints:100,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,i,o,s,n,r){for(var l=[e,t,i,o],c=this.options,u=c.debug,a=c.extent,p=c.buffer;l.length;){e=l.shift(),t=l.shift(),i=l.shift(),o=l.shift();var d=1<<t,f=toID(t,i,o),m=this.tiles[f],h=t===c.baseZoom?0:c.tolerance/(d*a);if(!m&&(u>1&&console.time("creation"),m=this.tiles[f]=createTile(e,d,i,o,h,a,t===c.baseZoom),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,o,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var g="z"+t+":";this.stats[g]=(this.stats[g]||0)+1,this.total++}if(!s&&(t===c.maxZoom||m.numPoints<=c.maxPoints||isClippedSquare(m.features,a,p))||t===c.baseZoom||t===s)m.source=e;else{m.source=s?e:null,u>1&&console.time("clipping");var v,b,x,T,S,Z,y,O,q,z=.5*p/a,J=.5-z,N=.5+z,E=1+z;s&&(y=1<<s-t,O=.5>n/y-i,q=.5>r/y-o),v=b=x=T=S=Z=null,(!s||O)&&(S=clip(e,d,i-z,i+N,0,intersectX)),s&&O||(Z=clip(e,d,i+J,i+E,0,intersectX)),S&&((!s||q)&&(v=clip(S,d,o-z,o+N,1,intersectY)),s&&q||(b=clip(S,d,o+J,o+E,1,intersectY))),Z&&((!s||q)&&(x=clip(Z,d,o-z,o+N,1,intersectY)),s&&q||(T=clip(Z,d,o+J,o+E,1,intersectY))),u>1&&console.timeEnd("clipping"),v&&l.push(v,t+1,2*i,2*o),b&&l.push(b,t+1,2*i,2*o+1),x&&l.push(x,t+1,2*i+1,2*o),T&&l.push(T,t+1,2*i+1,2*o+1)}}},GeoJSONVT.prototype.getTile=function(e,t,i){var o=toID(e,t,i);if(this.tiles[o])return this.tiles[o];var s=this.options,n=s.debug;n>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var r,l=e,c=t,u=i;!r&&l>0;)l--,c=Math.floor(c/2),u=Math.floor(u/2),r=this.tiles[toID(l,c,u)];if(n>1&&console.log("found parent tile z%d-%d-%d",l,c,u),r.source){if(isClippedSquare(r.features,s.extent,s.buffer))return r;n&&console.time("drilling down"),this.splitTile(r.source,l,c,u,e,t,i),n&&console.timeEnd("drilling down")}return this.tiles[o]};
},{"./clip":93,"./convert":94,"./tile":97}],96:[function(require,module,exports){
"use strict";function simplify(t,i){var e,r,o,p,s=i*i,f=t.length,n=0,u=f-1,g=[];for(t[n][2]=1,t[u][2]=1;u;){for(r=0,e=n+1;u>e;e++)o=getSqSegDist(t[e],t[n],t[u]),o>r&&(p=e,r=o);r>s&&(t[p][2]=r,g.push(n,p,p,u)),u=g.pop(),n=g.pop()}}function getSqSegDist(t,i,e){var r=i[0],o=i[1],p=e[0],s=e[1],f=t[0],n=t[1],u=p-r,g=s-o;if(0!==u||0!==g){var l=((f-r)*u+(n-o)*g)/(u*u+g*g);l>1?(r=p,o=s):l>0&&(r+=u*l,o+=g*l)}return u=f-r,g=n-o,u*u+g*g}module.exports=simplify;
},{}],97:[function(require,module,exports){
"use strict";function createTile(e,t,n,r,u,i,o){for(var s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null},a=0;a<e.length;a++)s.numFeatures++,addFeature(s,e[a],t,n,r,u,i,o);return s}function addFeature(e,t,n,r,u,i,o,s){var a,l,m,f,h=t.geometry,d=t.type,g=[],p=i*i;if(1===d)for(a=0;a<h.length;a++)g.push(transformPoint(h[a],n,r,u,o)),e.numPoints++,e.numSimplified++;else for(a=0;a<h.length;a++)if(m=h[a],s||!(2===d&&m.dist<i||3===d&&m.area<p)){var c=[];for(l=0;l<m.length;l++)f=m[l],(s||f[2]>p)&&(c.push(transformPoint(f,n,r,u,o)),e.numSimplified++),e.numPoints++;g.push(c)}else e.numPoints+=m.length;g.length&&e.features.push({geometry:g,type:d,tags:t.tags||null})}function transformPoint(e,t,n,r,u){var i=Math.round(u*(e[0]*t-n)),o=Math.round(u*(e[1]*t-r));return[i,o]}module.exports=createTile;
},{}],98:[function(require,module,exports){
!function(t){"use strict";var n={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(n.exports={},define(function(){return n.exports})):n.exports="undefined"!=typeof window?window:t:n.exports=exports,function(t){if(!n)var n=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!e)var e=Math.random;var a={};a.setMatrixArrayType=function(t){r=t},"undefined"!=typeof t&&(t.glMatrix=a);var u=Math.PI/180;a.toRadian=function(t){return t*u};var o={};o.create=function(){var t=new r(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var n=new r(2);return n[0]=t[0],n[1]=t[1],n},o.fromValues=function(t,n){var e=new r(2);return e[0]=t,e[1]=n,e},o.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},o.set=function(t,n,r){return t[0]=n,t[1]=r,t},o.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},o.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t},o.sub=o.subtract,o.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t},o.mul=o.multiply,o.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t},o.div=o.divide,o.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t},o.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t},o.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t},o.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t},o.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return Math.sqrt(r*r+e*e)},o.dist=o.distance,o.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return r*r+e*e},o.sqrDist=o.squaredDistance,o.length=function(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},o.len=o.length,o.squaredLength=function(t){var n=t[0],r=t[1];return n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t},o.normalize=function(t,n){var r=n[0],e=n[1],a=r*r+e*e;return a>0&&(a=1/Math.sqrt(a),t[0]=n[0]*a,t[1]=n[1]*a),t},o.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]},o.cross=function(t,n,r){var e=n[0]*r[1]-n[1]*r[0];return t[0]=t[1]=0,t[2]=e,t},o.lerp=function(t,n,r,e){var a=n[0],u=n[1];return t[0]=a+e*(r[0]-a),t[1]=u+e*(r[1]-u),t},o.random=function(t,n){n=n||1;var r=2*e()*Math.PI;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t},o.transformMat2=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[2]*a,t[1]=r[1]*e+r[3]*a,t},o.transformMat2d=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[2]*a+r[4],t[1]=r[1]*e+r[3]*a+r[5],t},o.transformMat3=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[3]*a+r[6],t[1]=r[1]*e+r[4]*a+r[7],t},o.transformMat4=function(t,n,r){var e=n[0],a=n[1];return t[0]=r[0]*e+r[4]*a+r[12],t[1]=r[1]*e+r[5]*a+r[13],t},o.forEach=function(){var t=o.create();return function(n,r,e,a,u,o){var i,c;for(r||(r=2),e||(e=0),c=a?Math.min(a*r+e,n.length):n.length,i=e;c>i;i+=r)t[0]=n[i],t[1]=n[i+1],u(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=o);var i={};i.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},i.clone=function(t){var n=new r(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},i.fromValues=function(t,n,e){var a=new r(3);return a[0]=t,a[1]=n,a[2]=e,a},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},i.set=function(t,n,r,e){return t[0]=n,t[1]=r,t[2]=e,t},i.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},i.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t},i.sub=i.subtract,i.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t},i.mul=i.multiply,i.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t},i.div=i.divide,i.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t},i.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t},i.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t},i.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t},i.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2];return Math.sqrt(r*r+e*e+a*a)},i.dist=i.distance,i.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2];return r*r+e*e+a*a},i.sqrDist=i.squaredDistance,i.length=function(t){var n=t[0],r=t[1],e=t[2];return Math.sqrt(n*n+r*r+e*e)},i.len=i.length,i.squaredLength=function(t){var n=t[0],r=t[1],e=t[2];return n*n+r*r+e*e},i.sqrLen=i.squaredLength,i.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},i.normalize=function(t,n){var r=n[0],e=n[1],a=n[2],u=r*r+e*e+a*a;return u>0&&(u=1/Math.sqrt(u),t[0]=n[0]*u,t[1]=n[1]*u,t[2]=n[2]*u),t},i.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},i.cross=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=r[0],i=r[1],c=r[2];return t[0]=a*c-u*i,t[1]=u*o-e*c,t[2]=e*i-a*o,t},i.lerp=function(t,n,r,e){var a=n[0],u=n[1],o=n[2];return t[0]=a+e*(r[0]-a),t[1]=u+e*(r[1]-u),t[2]=o+e*(r[2]-o),t},i.random=function(t,n){n=n||1;var r=2*e()*Math.PI,a=2*e()-1,u=Math.sqrt(1-a*a)*n;return t[0]=Math.cos(r)*u,t[1]=Math.sin(r)*u,t[2]=a*n,t},i.transformMat4=function(t,n,r){var e=n[0],a=n[1],u=n[2];return t[0]=r[0]*e+r[4]*a+r[8]*u+r[12],t[1]=r[1]*e+r[5]*a+r[9]*u+r[13],t[2]=r[2]*e+r[6]*a+r[10]*u+r[14],t},i.transformMat3=function(t,n,r){var e=n[0],a=n[1],u=n[2];return t[0]=e*r[0]+a*r[3]+u*r[6],t[1]=e*r[1]+a*r[4]+u*r[7],t[2]=e*r[2]+a*r[5]+u*r[8],t},i.transformQuat=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=r[0],i=r[1],c=r[2],f=r[3],s=f*e+i*u-c*a,h=f*a+c*e-o*u,v=f*u+o*a-i*e,M=-o*e-i*a-c*u;return t[0]=s*f+M*-o+h*-c-v*-i,t[1]=h*f+M*-i+v*-o-s*-c,t[2]=v*f+M*-c+s*-i-h*-o,t},i.rotateX=function(t,n,r,e){var a=[],u=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],u[0]=a[0],u[1]=a[1]*Math.cos(e)-a[2]*Math.sin(e),u[2]=a[1]*Math.sin(e)+a[2]*Math.cos(e),t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},i.rotateY=function(t,n,r,e){var a=[],u=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],u[0]=a[2]*Math.sin(e)+a[0]*Math.cos(e),u[1]=a[1],u[2]=a[2]*Math.cos(e)-a[0]*Math.sin(e),t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},i.rotateZ=function(t,n,r,e){var a=[],u=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],u[0]=a[0]*Math.cos(e)-a[1]*Math.sin(e),u[1]=a[0]*Math.sin(e)+a[1]*Math.cos(e),u[2]=a[2],t[0]=u[0]+r[0],t[1]=u[1]+r[1],t[2]=u[2]+r[2],t},i.forEach=function(){var t=i.create();return function(n,r,e,a,u,o){var i,c;for(r||(r=3),e||(e=0),c=a?Math.min(a*r+e,n.length):n.length,i=e;c>i;i+=r)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],u(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2];return n}}(),i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=i);var c={};c.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},c.clone=function(t){var n=new r(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},c.fromValues=function(t,n,e,a){var u=new r(4);return u[0]=t,u[1]=n,u[2]=e,u[3]=a,u},c.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},c.set=function(t,n,r,e,a){return t[0]=n,t[1]=r,t[2]=e,t[3]=a,t},c.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},c.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t},c.sub=c.subtract,c.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t[3]=n[3]*r[3],t},c.mul=c.multiply,c.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t[3]=n[3]/r[3],t},c.div=c.divide,c.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t[3]=Math.min(n[3],r[3]),t},c.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t[3]=Math.max(n[3],r[3]),t},c.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},c.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t[3]=n[3]+r[3]*e,t},c.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2],u=n[3]-t[3];return Math.sqrt(r*r+e*e+a*a+u*u)},c.dist=c.distance,c.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],a=n[2]-t[2],u=n[3]-t[3];return r*r+e*e+a*a+u*u},c.sqrDist=c.squaredDistance,c.length=function(t){var n=t[0],r=t[1],e=t[2],a=t[3];return Math.sqrt(n*n+r*r+e*e+a*a)},c.len=c.length,c.squaredLength=function(t){var n=t[0],r=t[1],e=t[2],a=t[3];return n*n+r*r+e*e+a*a},c.sqrLen=c.squaredLength,c.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},c.normalize=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r*r+e*e+a*a+u*u;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o,t[3]=n[3]*o),t},c.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},c.lerp=function(t,n,r,e){var a=n[0],u=n[1],o=n[2],i=n[3];return t[0]=a+e*(r[0]-a),t[1]=u+e*(r[1]-u),t[2]=o+e*(r[2]-o),t[3]=i+e*(r[3]-i),t},c.random=function(t,n){return n=n||1,t[0]=e(),t[1]=e(),t[2]=e(),t[3]=e(),c.normalize(t,t),c.scale(t,t,n),t},c.transformMat4=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3];return t[0]=r[0]*e+r[4]*a+r[8]*u+r[12]*o,t[1]=r[1]*e+r[5]*a+r[9]*u+r[13]*o,t[2]=r[2]*e+r[6]*a+r[10]*u+r[14]*o,t[3]=r[3]*e+r[7]*a+r[11]*u+r[15]*o,t},c.transformQuat=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=r[0],i=r[1],c=r[2],f=r[3],s=f*e+i*u-c*a,h=f*a+c*e-o*u,v=f*u+o*a-i*e,M=-o*e-i*a-c*u;return t[0]=s*f+M*-o+h*-c-v*-i,t[1]=h*f+M*-i+v*-o-s*-c,t[2]=v*f+M*-c+s*-i-h*-o,t},c.forEach=function(){var t=c.create();return function(n,r,e,a,u,o){var i,c;for(r||(r=4),e||(e=0),c=a?Math.min(a*r+e,n.length):n.length,i=e;c>i;i+=r)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],u(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}(),c.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=c);var f={};f.create=function(){var t=new r(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},f.clone=function(t){var n=new r(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},f.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},f.transpose=function(t,n){if(t===n){var r=n[1];t[1]=n[2],t[2]=r}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},f.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r*u-a*e;return o?(o=1/o,t[0]=u*o,t[1]=-e*o,t[2]=-a*o,t[3]=r*o,t):null},f.adjoint=function(t,n){var r=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=r,t},f.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},f.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=r[0],c=r[1],f=r[2],s=r[3];return t[0]=e*i+u*c,t[1]=a*i+o*c,t[2]=e*f+u*s,t[3]=a*f+o*s,t},f.mul=f.multiply,f.rotate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+u*i,t[1]=a*c+o*i,t[2]=e*-i+u*c,t[3]=a*-i+o*c,t},f.scale=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=r[0],c=r[1];return t[0]=e*i,t[1]=a*i,t[2]=u*c,t[3]=o*c,t},f.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},f.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},f.LDU=function(t,n,r,e){return t[2]=e[2]/e[0],r[0]=e[0],r[1]=e[1],r[3]=e[3]-t[2]*r[1],[t,n,r]},"undefined"!=typeof t&&(t.mat2=f);var s={};s.create=function(){var t=new r(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},s.clone=function(t){var n=new r(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},s.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},s.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=r*u-e*a;return c?(c=1/c,t[0]=u*c,t[1]=-e*c,t[2]=-a*c,t[3]=r*c,t[4]=(a*i-u*o)*c,t[5]=(e*o-r*i)*c,t):null},s.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},s.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=r[0],s=r[1],h=r[2],v=r[3],M=r[4],l=r[5];return t[0]=e*f+u*s,t[1]=a*f+o*s,t[2]=e*h+u*v,t[3]=a*h+o*v,t[4]=e*M+u*l+i,t[5]=a*M+o*l+c,t},s.mul=s.multiply,s.rotate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=Math.sin(r),s=Math.cos(r);return t[0]=e*s+u*f,t[1]=a*s+o*f,t[2]=e*-f+u*s,t[3]=a*-f+o*s,t[4]=i,t[5]=c,t},s.scale=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=r[0],s=r[1];return t[0]=e*f,t[1]=a*f,t[2]=u*s,t[3]=o*s,t[4]=i,t[5]=c,t},s.translate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=r[0],s=r[1];return t[0]=e,t[1]=a,t[2]=u,t[3]=o,t[4]=e*f+u*s+i,t[5]=a*f+o*s+c,t},s.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},s.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},"undefined"!=typeof t&&(t.mat2d=s);var h={};h.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.fromMat4=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},h.clone=function(t){var n=new r(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},h.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],a=n[5];t[1]=n[3],t[2]=n[6],t[3]=r,t[5]=n[7],t[6]=e,t[7]=a}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},h.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=s*o-i*f,v=-s*u+i*c,M=f*u-o*c,l=r*h+e*v+a*M;return l?(l=1/l,t[0]=h*l,t[1]=(-s*e+a*f)*l,t[2]=(i*e-a*o)*l,t[3]=v*l,t[4]=(s*r-a*c)*l,t[5]=(-i*r+a*u)*l,t[6]=M*l,t[7]=(-f*r+e*c)*l,t[8]=(o*r-e*u)*l,t):null},h.adjoint=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8];return t[0]=o*s-i*f,t[1]=a*f-e*s,t[2]=e*i-a*o,t[3]=i*c-u*s,t[4]=r*s-a*c,t[5]=a*u-r*i,t[6]=u*f-o*c,t[7]=e*c-r*f,t[8]=r*o-e*u,t},h.determinant=function(t){var n=t[0],r=t[1],e=t[2],a=t[3],u=t[4],o=t[5],i=t[6],c=t[7],f=t[8];return n*(f*u-o*c)+r*(-f*a+o*i)+e*(c*a-u*i)},h.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=r[0],M=r[1],l=r[2],d=r[3],m=r[4],p=r[5],w=r[6],y=r[7],q=r[8];return t[0]=v*e+M*o+l*f,t[1]=v*a+M*i+l*s,t[2]=v*u+M*c+l*h,t[3]=d*e+m*o+p*f,t[4]=d*a+m*i+p*s,t[5]=d*u+m*c+p*h,t[6]=w*e+y*o+q*f,t[7]=w*a+y*i+q*s,t[8]=w*u+y*c+q*h,t},h.mul=h.multiply,h.translate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=r[0],M=r[1];return t[0]=e,t[1]=a,t[2]=u,t[3]=o,t[4]=i,t[5]=c,t[6]=v*e+M*o+f,t[7]=v*a+M*i+s,t[8]=v*u+M*c+h,t},h.rotate=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=Math.sin(r),M=Math.cos(r);return t[0]=M*e+v*o,t[1]=M*a+v*i,t[2]=M*u+v*c,t[3]=M*o-v*e,t[4]=M*i-v*a,t[5]=M*c-v*u,t[6]=f,t[7]=s,t[8]=h,t},h.scale=function(t,n,r){var e=r[0],a=r[1];return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=a*n[3],t[4]=a*n[4],t[5]=a*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},h.fromMat2d=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},h.fromQuat=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r+r,i=e+e,c=a+a,f=r*o,s=e*o,h=e*i,v=a*o,M=a*i,l=a*c,d=u*o,m=u*i,p=u*c;return t[0]=1-h-l,t[3]=s-p,t[6]=v+m,t[1]=s+p,t[4]=1-f-l,t[7]=M-d,t[2]=v-m,t[5]=M+d,t[8]=1-f-h,t},h.normalFromMat4=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=n[9],v=n[10],M=n[11],l=n[12],d=n[13],m=n[14],p=n[15],w=r*i-e*o,y=r*c-a*o,q=r*f-u*o,g=e*c-a*i,x=e*f-u*i,b=a*f-u*c,A=s*d-h*l,L=s*m-v*l,D=s*p-M*l,z=h*m-v*d,V=h*p-M*d,j=v*p-M*m,I=w*j-y*V+q*z+g*D-x*L+b*A;return I?(I=1/I,t[0]=(i*j-c*V+f*z)*I,t[1]=(c*D-o*j-f*L)*I,t[2]=(o*V-i*D+f*A)*I,t[3]=(a*V-e*j-u*z)*I,t[4]=(r*j-a*D+u*L)*I,t[5]=(e*D-r*V-u*A)*I,t[6]=(d*b-m*x+p*g)*I,t[7]=(m*q-l*b-p*y)*I,t[8]=(l*x-d*q+p*w)*I,t):null},h.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},h.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof t&&(t.mat3=h);var v={};v.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.clone=function(t){var n=new r(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},v.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},v.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],a=n[3],u=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=r,t[6]=n[9],t[7]=n[13],t[8]=e,t[9]=u,t[11]=n[14],t[12]=a,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},v.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=n[9],v=n[10],M=n[11],l=n[12],d=n[13],m=n[14],p=n[15],w=r*i-e*o,y=r*c-a*o,q=r*f-u*o,g=e*c-a*i,x=e*f-u*i,b=a*f-u*c,A=s*d-h*l,L=s*m-v*l,D=s*p-M*l,z=h*m-v*d,V=h*p-M*d,j=v*p-M*m,I=w*j-y*V+q*z+g*D-x*L+b*A;return I?(I=1/I,t[0]=(i*j-c*V+f*z)*I,t[1]=(a*V-e*j-u*z)*I,t[2]=(d*b-m*x+p*g)*I,t[3]=(v*x-h*b-M*g)*I,t[4]=(c*D-o*j-f*L)*I,t[5]=(r*j-a*D+u*L)*I,t[6]=(m*q-l*b-p*y)*I,t[7]=(s*b-v*q+M*y)*I,t[8]=(o*V-i*D+f*A)*I,t[9]=(e*D-r*V-u*A)*I,t[10]=(l*x-d*q+p*w)*I,t[11]=(h*q-s*x-M*w)*I,t[12]=(i*L-o*z-c*A)*I,t[13]=(r*z-e*L+a*A)*I,t[14]=(d*y-l*g-m*w)*I,t[15]=(s*g-h*y+v*w)*I,t):null},v.adjoint=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=n[4],i=n[5],c=n[6],f=n[7],s=n[8],h=n[9],v=n[10],M=n[11],l=n[12],d=n[13],m=n[14],p=n[15];return t[0]=i*(v*p-M*m)-h*(c*p-f*m)+d*(c*M-f*v),t[1]=-(e*(v*p-M*m)-h*(a*p-u*m)+d*(a*M-u*v)),t[2]=e*(c*p-f*m)-i*(a*p-u*m)+d*(a*f-u*c),t[3]=-(e*(c*M-f*v)-i*(a*M-u*v)+h*(a*f-u*c)),t[4]=-(o*(v*p-M*m)-s*(c*p-f*m)+l*(c*M-f*v)),t[5]=r*(v*p-M*m)-s*(a*p-u*m)+l*(a*M-u*v),t[6]=-(r*(c*p-f*m)-o*(a*p-u*m)+l*(a*f-u*c)),t[7]=r*(c*M-f*v)-o*(a*M-u*v)+s*(a*f-u*c),t[8]=o*(h*p-M*d)-s*(i*p-f*d)+l*(i*M-f*h),t[9]=-(r*(h*p-M*d)-s*(e*p-u*d)+l*(e*M-u*h)),t[10]=r*(i*p-f*d)-o*(e*p-u*d)+l*(e*f-u*i),t[11]=-(r*(i*M-f*h)-o*(e*M-u*h)+s*(e*f-u*i)),t[12]=-(o*(h*m-v*d)-s*(i*m-c*d)+l*(i*v-c*h)),t[13]=r*(h*m-v*d)-s*(e*m-a*d)+l*(e*v-a*h),t[14]=-(r*(i*m-c*d)-o*(e*m-a*d)+l*(e*c-a*i)),t[15]=r*(i*v-c*h)-o*(e*v-a*h)+s*(e*c-a*i),t},v.determinant=function(t){var n=t[0],r=t[1],e=t[2],a=t[3],u=t[4],o=t[5],i=t[6],c=t[7],f=t[8],s=t[9],h=t[10],v=t[11],M=t[12],l=t[13],d=t[14],m=t[15],p=n*o-r*u,w=n*i-e*u,y=n*c-a*u,q=r*i-e*o,g=r*c-a*o,x=e*c-a*i,b=f*l-s*M,A=f*d-h*M,L=f*m-v*M,D=s*d-h*l,z=s*m-v*l,V=h*m-v*d;return p*V-w*z+y*D+q*L-g*A+x*b},v.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=n[9],M=n[10],l=n[11],d=n[12],m=n[13],p=n[14],w=n[15],y=r[0],q=r[1],g=r[2],x=r[3];return t[0]=y*e+q*i+g*h+x*d,t[1]=y*a+q*c+g*v+x*m,t[2]=y*u+q*f+g*M+x*p,t[3]=y*o+q*s+g*l+x*w,y=r[4],q=r[5],g=r[6],x=r[7],t[4]=y*e+q*i+g*h+x*d,t[5]=y*a+q*c+g*v+x*m,t[6]=y*u+q*f+g*M+x*p,t[7]=y*o+q*s+g*l+x*w,y=r[8],q=r[9],g=r[10],x=r[11],t[8]=y*e+q*i+g*h+x*d,t[9]=y*a+q*c+g*v+x*m,t[10]=y*u+q*f+g*M+x*p,t[11]=y*o+q*s+g*l+x*w,y=r[12],q=r[13],g=r[14],x=r[15],t[12]=y*e+q*i+g*h+x*d,t[13]=y*a+q*c+g*v+x*m,t[14]=y*u+q*f+g*M+x*p,t[15]=y*o+q*s+g*l+x*w,t},v.mul=v.multiply,v.translate=function(t,n,r){var e,a,u,o,i,c,f,s,h,v,M,l,d=r[0],m=r[1],p=r[2];return n===t?(t[12]=n[0]*d+n[4]*m+n[8]*p+n[12],t[13]=n[1]*d+n[5]*m+n[9]*p+n[13],t[14]=n[2]*d+n[6]*m+n[10]*p+n[14],t[15]=n[3]*d+n[7]*m+n[11]*p+n[15]):(e=n[0],a=n[1],u=n[2],o=n[3],i=n[4],c=n[5],f=n[6],s=n[7],h=n[8],v=n[9],M=n[10],l=n[11],t[0]=e,t[1]=a,t[2]=u,t[3]=o,t[4]=i,t[5]=c,t[6]=f,t[7]=s,t[8]=h,t[9]=v,t[10]=M,t[11]=l,t[12]=e*d+i*m+h*p+n[12],t[13]=a*d+c*m+v*p+n[13],t[14]=u*d+f*m+M*p+n[14],t[15]=o*d+s*m+l*p+n[15]),t},v.scale=function(t,n,r){var e=r[0],a=r[1],u=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*u,t[9]=n[9]*u,t[10]=n[10]*u,t[11]=n[11]*u,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},v.rotate=function(t,r,e,a){var u,o,i,c,f,s,h,v,M,l,d,m,p,w,y,q,g,x,b,A,L,D,z,V,j=a[0],I=a[1],P=a[2],Q=Math.sqrt(j*j+I*I+P*P);return Math.abs(Q)<n?null:(Q=1/Q,j*=Q,I*=Q,P*=Q,u=Math.sin(e),o=Math.cos(e),i=1-o,c=r[0],f=r[1],s=r[2],h=r[3],v=r[4],M=r[5],l=r[6],d=r[7],m=r[8],p=r[9],w=r[10],y=r[11],q=j*j*i+o,g=I*j*i+P*u,x=P*j*i-I*u,b=j*I*i-P*u,A=I*I*i+o,L=P*I*i+j*u,D=j*P*i+I*u,z=I*P*i-j*u,V=P*P*i+o,t[0]=c*q+v*g+m*x,t[1]=f*q+M*g+p*x,t[2]=s*q+l*g+w*x,t[3]=h*q+d*g+y*x,t[4]=c*b+v*A+m*L,t[5]=f*b+M*A+p*L,t[6]=s*b+l*A+w*L,t[7]=h*b+d*A+y*L,t[8]=c*D+v*z+m*V,t[9]=f*D+M*z+p*V,t[10]=s*D+l*z+w*V,t[11]=h*D+d*z+y*V,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},v.rotateX=function(t,n,r){var e=Math.sin(r),a=Math.cos(r),u=n[4],o=n[5],i=n[6],c=n[7],f=n[8],s=n[9],h=n[10],v=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=u*a+f*e,t[5]=o*a+s*e,t[6]=i*a+h*e,t[7]=c*a+v*e,t[8]=f*a-u*e,t[9]=s*a-o*e,t[10]=h*a-i*e,t[11]=v*a-c*e,t},v.rotateY=function(t,n,r){var e=Math.sin(r),a=Math.cos(r),u=n[0],o=n[1],i=n[2],c=n[3],f=n[8],s=n[9],h=n[10],v=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=u*a-f*e,t[1]=o*a-s*e,t[2]=i*a-h*e,t[3]=c*a-v*e,t[8]=u*e+f*a,t[9]=o*e+s*a,t[10]=i*e+h*a,t[11]=c*e+v*a,t},v.rotateZ=function(t,n,r){var e=Math.sin(r),a=Math.cos(r),u=n[0],o=n[1],i=n[2],c=n[3],f=n[4],s=n[5],h=n[6],v=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=u*a+f*e,t[1]=o*a+s*e,t[2]=i*a+h*e,t[3]=c*a+v*e,t[4]=f*a-u*e,t[5]=s*a-o*e,t[6]=h*a-i*e,t[7]=v*a-c*e,t},v.fromRotationTranslation=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=e+e,c=a+a,f=u+u,s=e*i,h=e*c,v=e*f,M=a*c,l=a*f,d=u*f,m=o*i,p=o*c,w=o*f;return t[0]=1-(M+d),t[1]=h+w,t[2]=v-p,t[3]=0,t[4]=h-w,t[5]=1-(s+d),t[6]=l+m,t[7]=0,t[8]=v+p,t[9]=l-m,t[10]=1-(s+M),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},v.fromQuat=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r+r,i=e+e,c=a+a,f=r*o,s=e*o,h=e*i,v=a*o,M=a*i,l=a*c,d=u*o,m=u*i,p=u*c;return t[0]=1-h-l,t[1]=s+p,t[2]=v-m,t[3]=0,t[4]=s-p,t[5]=1-f-l,t[6]=M+d,t[7]=0,t[8]=v+m,t[9]=M-d,t[10]=1-f-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.frustum=function(t,n,r,e,a,u,o){var i=1/(r-n),c=1/(a-e),f=1/(u-o);return t[0]=2*u*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*c,t[6]=0,t[7]=0,t[8]=(r+n)*i,t[9]=(a+e)*c,t[10]=(o+u)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*u*2*f,t[15]=0,t},v.perspective=function(t,n,r,e,a){var u=1/Math.tan(n/2),o=1/(e-a);return t[0]=u/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*o,t[15]=0,t},v.ortho=function(t,n,r,e,a,u,o){var i=1/(n-r),c=1/(e-a),f=1/(u-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(n+r)*i,t[13]=(a+e)*c,t[14]=(o+u)*f,t[15]=1,t},v.lookAt=function(t,r,e,a){var u,o,i,c,f,s,h,M,l,d,m=r[0],p=r[1],w=r[2],y=a[0],q=a[1],g=a[2],x=e[0],b=e[1],A=e[2];return Math.abs(m-x)<n&&Math.abs(p-b)<n&&Math.abs(w-A)<n?v.identity(t):(h=m-x,M=p-b,l=w-A,d=1/Math.sqrt(h*h+M*M+l*l),h*=d,M*=d,l*=d,u=q*l-g*M,o=g*h-y*l,i=y*M-q*h,d=Math.sqrt(u*u+o*o+i*i),d?(d=1/d,u*=d,o*=d,i*=d):(u=0,o=0,i=0),c=M*i-l*o,f=l*u-h*i,s=h*o-M*u,d=Math.sqrt(c*c+f*f+s*s),d?(d=1/d,c*=d,f*=d,s*=d):(c=0,f=0,s=0),t[0]=u,t[1]=c,t[2]=h,t[3]=0,t[4]=o,t[5]=f,t[6]=M,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=-(u*m+o*p+i*w),t[13]=-(c*m+f*p+s*w),t[14]=-(h*m+M*p+l*w),t[15]=1,t)},v.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},v.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof t&&(t.mat4=v);var M={};M.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},M.rotationTo=function(){var t=i.create(),n=i.fromValues(1,0,0),r=i.fromValues(0,1,0);return function(e,a,u){var o=i.dot(a,u);return-.999999>o?(i.cross(t,n,a),i.length(t)<1e-6&&i.cross(t,r,a),i.normalize(t,t),M.setAxisAngle(e,t,Math.PI),e):o>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(i.cross(t,a,u),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+o,M.normalize(e,e))}}(),M.setAxes=function(){var t=h.create();return function(n,r,e,a){return t[0]=e[0],t[3]=e[1],t[6]=e[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],M.normalize(n,M.fromMat3(n,t))}}(),M.clone=c.clone,M.fromValues=c.fromValues,M.copy=c.copy,M.set=c.set,M.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},M.setAxisAngle=function(t,n,r){r=.5*r;var e=Math.sin(r);return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=Math.cos(r),t},M.add=c.add,M.multiply=function(t,n,r){var e=n[0],a=n[1],u=n[2],o=n[3],i=r[0],c=r[1],f=r[2],s=r[3];return t[0]=e*s+o*i+a*f-u*c,t[1]=a*s+o*c+u*i-e*f,t[2]=u*s+o*f+e*c-a*i,t[3]=o*s-e*i-a*c-u*f,t},M.mul=M.multiply,M.scale=c.scale,M.rotateX=function(t,n,r){r*=.5;var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+o*i,t[1]=a*c+u*i,t[2]=u*c-a*i,t[3]=o*c-e*i,t},M.rotateY=function(t,n,r){r*=.5;var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c-u*i,t[1]=a*c+o*i,t[2]=u*c+e*i,t[3]=o*c-a*i,t},M.rotateZ=function(t,n,r){r*=.5;var e=n[0],a=n[1],u=n[2],o=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+a*i,t[1]=a*c-e*i,t[2]=u*c+o*i,t[3]=o*c-u*i,t},M.calculateW=function(t,n){var r=n[0],e=n[1],a=n[2];return t[0]=r,t[1]=e,t[2]=a,t[3]=-Math.sqrt(Math.abs(1-r*r-e*e-a*a)),t},M.dot=c.dot,M.lerp=c.lerp,M.slerp=function(t,n,r,e){var a,u,o,i,c,f=n[0],s=n[1],h=n[2],v=n[3],M=r[0],l=r[1],d=r[2],m=r[3];return u=f*M+s*l+h*d+v*m,0>u&&(u=-u,M=-M,l=-l,d=-d,m=-m),1-u>1e-6?(a=Math.acos(u),o=Math.sin(a),i=Math.sin((1-e)*a)/o,c=Math.sin(e*a)/o):(i=1-e,c=e),t[0]=i*f+c*M,t[1]=i*s+c*l,t[2]=i*h+c*d,t[3]=i*v+c*m,t},M.invert=function(t,n){var r=n[0],e=n[1],a=n[2],u=n[3],o=r*r+e*e+a*a+u*u,i=o?1/o:0;return t[0]=-r*i,t[1]=-e*i,t[2]=-a*i,t[3]=u*i,t},M.conjugate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},M.length=c.length,M.len=M.length,M.squaredLength=c.squaredLength,M.sqrLen=M.squaredLength,M.normalize=c.normalize,M.fromMat3=function(t,n){var r,e=n[0]+n[4]+n[8];if(e>0)r=Math.sqrt(e+1),t[3]=.5*r,r=.5/r,t[0]=(n[7]-n[5])*r,t[1]=(n[2]-n[6])*r,t[2]=(n[3]-n[1])*r;else{var a=0;n[4]>n[0]&&(a=1),n[8]>n[3*a+a]&&(a=2);var u=(a+1)%3,o=(a+2)%3;r=Math.sqrt(n[3*a+a]-n[3*u+u]-n[3*o+o]+1),t[a]=.5*r,r=.5/r,t[3]=(n[3*o+u]-n[3*u+o])*r,t[u]=(n[3*u+a]+n[3*a+u])*r,t[o]=(n[3*o+a]+n[3*a+o])*r}return t},M.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=M)}(n.exports)}(this);
},{}],99:[function(require,module,exports){
"use strict";function constant(r){return function(){return r}}function interpolateNumber(r,t,n){return r*(1-n)+t*n}function interpolateArray(r,t,n){for(var e=[],o=0;o<r.length;o++)e[o]=interpolateNumber(r[o],t[o],n);return e}exports.interpolated=function(r){if(!r.stops)return constant(r);var t=r.stops,n=r.base||1,e=Array.isArray(t[0][1])?interpolateArray:interpolateNumber;return function(r){for(var o,a,i=0;i<t.length;i++){var u=t[i];if(u[0]<=r&&(o=u),u[0]>r){a=u;break}}if(o&&a){var s=a[0]-o[0],f=r-o[0],p=1===n?f/s:(Math.pow(n,f)-1)/(Math.pow(n,s)-1);return e(o[1],a[1],p)}return o?o[1]:a?a[1]:void 0}},exports["piecewise-constant"]=function(r){if(!r.stops)return constant(r);var t=r.stops;return function(r){for(var n=0;n<t.length;n++)if(t[n][0]>r)return t[0===n?0:n-1][1];return t[t.length-1][1]}};
},{}],100:[function(require,module,exports){
module.exports={"$version":7,"$root":{"version":{"required":true,"type":"enum","values":[7],"doc":"Stylesheet version number. Must be 7."},"name":{"type":"string","doc":"A human-readable name for the style."},"constants":{"type":"constants","doc":"An object of constants to be referenced in layers."},"sources":{"required":true,"type":"sources","doc":"Data source specifications."},"sprite":{"type":"string","doc":"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended."},"glyphs":{"type":"string","doc":"A URL template for loading signed-distance-field glyph sets in PBF format. Valid tokens are {fontstack} and {range}."},"transition":{"type":"transition","doc":"A global transition definition to use as a default across properties."},"layers":{"required":true,"type":"array","value":"layer","doc":"Layers will be drawn in the order of this array."}},"constants":{"*":{"type":"*","doc":"A constant that will be replaced verbatim in the referencing place. This can be anything, including objects and arrays. All variable names must be prefixed with an `@` symbol."}},"sources":{"*":{"type":"source","doc":"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For GeoJSON and video sources, a URL must be provided."}},"source":["source_tile","source_geojson","source_video"],"source_tile":{"type":{"required":true,"type":"enum","values":["vector","raster"],"doc":"The data type of the source."},"url":{"type":"string","doc":"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."},"tiles":{"type":"array","value":"string","doc":"An array of one or more tile source URLs, as in the TileJSON spec."},"minzoom":{"type":"number","default":0,"doc":"Minimum zoom level for which tiles are available, as in the TileJSON spec."},"maxzoom":{"type":"number","default":22,"doc":"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},"tileSize":{"type":"number","default":512,"units":"pixels","doc":"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},"*":{"type":"*","doc":"Other keys to configure the data source."}},"source_geojson":{"type":{"required":true,"type":"enum","values":["geojson"]},"data":{"type":"*"}},"source_video":{"type":{"required":true,"type":"enum","values":["video"]},"url":{"required":true,"type":"array","value":"string","doc":"URLs to video content in order of preferred format."},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","doc":"Unique layer name."},"type":{"type":"enum","values":["fill","line","symbol","raster","background"],"doc":"Rendering type of this layer."},"ref":{"type":"string","doc":"References another layer to copy `type`, `source`, `source-layer`, `minzoom`, `maxzoom`, `filter`, and `layout` properties from. This allows the layers to share processing and be more efficient."},"source":{"type":"string","doc":"Name of a source description to be used for this layer."},"source-layer":{"type":"string","doc":"Layer to use from a vector tile source. Required if the source supports multiple layers."},"minzoom":{"type":"number","minimum":0,"maximum":22,"doc":"The minimum zoom level on which the layer gets parsed and appears on."},"maxzoom":{"type":"number","minimum":0,"maximum":22,"doc":"The maximum zoom level on which the layer gets parsed and appears on."},"interactive":{"type":"boolean","doc":"Enable querying of feature data from this layer for interactivity.","default":false},"filter":{"type":"filter","doc":"A expression specifying conditions on source features. Only features that match the filter are displayed."},"layout":{"type":"layout","doc":"Layout properties for the layer."},"paint":{"type":"paint","doc":"Default paint properties for this layer."},"paint.*":{"type":"paint","doc":"Class-specific paint properties for this layer. The class name is the part after the first dot."}},"layout":["layout_fill","layout_line","layout_symbol","layout_raster","layout_background"],"layout_background":{"visibility":{"type":"enum","function":"piecewise-constant","values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"layout_fill":{"visibility":{"type":"enum","function":"piecewise-constant","values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"layout_line":{"line-cap":{"type":"enum","function":"piecewise-constant","values":["butt","round","square"],"default":"butt","doc":"The display of line endings."},"line-join":{"type":"enum","function":"piecewise-constant","values":["bevel","round","miter"],"default":"miter","doc":"The display of lines when joining."},"line-miter-limit":{"type":"number","default":2,"function":"interpolated","doc":"Used to automatically convert miter joins to bevel joins for sharp angles.","requires":[{"line-join":"miter"}]},"line-round-limit":{"type":"number","default":1,"function":"interpolated","doc":"Used to automatically convert round joins to miter joins for shallow angles.","requires":[{"line-join":"round"}]},"visibility":{"type":"enum","function":"piecewise-constant","values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"layout_symbol":{"symbol-placement":{"type":"enum","function":"piecewise-constant","values":["point","line"],"default":"point","doc":"Label placement relative to its geometry. `line` can only be used on LineStrings and Polygons."},"symbol-min-distance":{"type":"number","default":250,"minimum":1,"function":"interpolated","units":"pixels","doc":"Minimum distance between two symbol anchors.","requires":[{"symbol-placement":"line"}]},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer."},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, the icon will be visible even if it collides with other icons and text.","requires":["icon-image"]},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, the icon won't affect placement of other icons and text.","requires":["icon-image"]},"icon-optional":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, text can be shown without its corresponding icon.","requires":["icon-image","text-field"]},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","values":["map","viewport"],"default":"viewport","doc":"Orientation of icon when map is rotated.","requires":["icon-image"]},"icon-max-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","doc":"The maximum factor to scale the icon.","requires":["icon-image"]},"icon-image":{"type":"string","function":"piecewise-constant","doc":"A string with {tokens} replaced, referencing the data property to pull from.","tokens":true},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","units":"degrees","doc":"Rotates the icon clockwise.","requires":["icon-image"]},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","units":"pixels","doc":"Padding value around icon bounding box to avoid icon collisions.","requires":["icon-image"]},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, the icon may be flipped to prevent it from being rendered upside-down","requires":["icon-image",{"icon-rotation-alignment":"map"}]},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","doc":"Icon's offset distance. Values are [x, y] where negatives indicate left and up, respectively.","requires":["icon-image"]},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","values":["map","viewport"],"default":"viewport","doc":"Orientation of icon or text when map is rotated.","requires":["text-field"]},"text-field":{"type":"string","function":"piecewise-constant","default":"","tokens":true,"doc":"Value to use for a text label. Feature properties are specified using tokens like {field_name}."},"text-font":{"type":"string","function":"piecewise-constant","default":"Open Sans Regular, Arial Unicode MS Regular","doc":"Font stack to use for displaying text.","requires":["text-field"]},"text-max-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","doc":"The maximum size text will be laid out, to calculate collisions with.","requires":["text-field"]},"text-max-width":{"type":"number","default":15,"minimum":0,"units":"em","function":"interpolated","doc":"The maximum line width for text wrapping.","requires":["text-field"]},"text-line-height":{"type":"number","default":1.2,"units":"em","function":"interpolated","doc":"Text leading value for multi-line text.","requires":["text-field"]},"text-letter-spacing":{"type":"number","default":0,"units":"em","function":"interpolated","doc":"Text kerning value.","requires":["text-field"]},"text-justify":{"type":"enum","function":"piecewise-constant","values":["left","center","right"],"default":"center","doc":"Text justification options.","requires":["text-field"]},"text-anchor":{"type":"enum","function":"piecewise-constant","values":["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],"default":"center","doc":"Which part of the text to place closest to the anchor.","requires":["text-field"]},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","doc":"Maximum angle change between adjacent characters.","requires":["text-field",{"symbol-placement":"line"}]},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","doc":"Rotates the text clockwise.","requires":["text-field"]},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","doc":"Padding value around text bounding box to avoid label collisions.","requires":["text-field"]},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","default":true,"doc":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.","requires":["text-field",{"text-rotation-alignment":"map"}]},"text-transform":{"type":"enum","function":"piecewise-constant","values":["none","uppercase","lowercase"],"default":"none","doc":"Specifies how to capitalize text, similar to the CSS `text-transform` property.","requires":["text-field"]},"text-offset":{"type":"array","doc":"Specifies the distance that text is offset from its anchor horizontally and vertically.","value":"number","units":"ems","function":"interpolated","length":2,"default":[0,0],"requires":["text-field"]},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, the text will be visible even if it collides with other icons and labels.","requires":["text-field"]},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, the text won't affect placement of other icons and labels.","requires":["text-field"]},"text-optional":{"type":"boolean","function":"piecewise-constant","default":false,"doc":"If true, icons can be shown without their corresponding text.","requires":["text-field","icon-image"]},"visibility":{"type":"enum","function":"piecewise-constant","values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"layout_raster":{"visibility":{"type":"enum","function":"piecewise-constant","values":["visible","none"],"default":"visible","doc":"The display of this layer. `none` hides this layer."}},"filter":{"type":"array","value":"*"},"filter_operator":{"type":"enum","values":["==","!=",">",">=","<","<=","in","!in","all","any","none"]},"geometry_type":{"type":"enum","values":["Point","LineString","Polygon"]},"function":{"stops":{"type":"array","required":true,"doc":"An array of stops.","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0,"doc":"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."}},"function_stop":{"type":"array","minimum":0,"maximum":22,"value":["number","color"],"length":2,"doc":"Zoom level and value pair."},"paint":["paint_fill","paint_line","paint_symbol","paint_raster","paint_background"],"paint_fill":{"fill-antialias":{"type":"boolean","function":"piecewise-constant","default":true,"doc":"Whether or not the fill should be antialiased."},"fill-opacity":{"type":"number","function":"interpolated","default":1,"minimum":0,"maximum":1,"doc":"The opacity given to the fill color.","transition":true},"fill-color":{"type":"color","default":"#000000","doc":"The color of the fill.","function":"interpolated","transition":true,"requires":[{"!":"fill-image"}]},"fill-outline-color":{"type":"color","doc":"The outline color of the fill. Matches the value of `fill-color` if unspecified.","function":"interpolated","transition":true,"requires":[{"!":"fill-image"},{"fill-antialias":true}]},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"fill-translate-anchor":{"type":"enum","function":"piecewise-constant","values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["fill-translate"]},"fill-image":{"type":"string","function":"piecewise-constant","transition":true,"doc":"Name of image in sprite to use for drawing image fills."}},"paint_line":{"line-opacity":{"type":"number","doc":"The opacity at which the line will be drawn.","function":"interpolated","default":1,"minimum":0,"maximum":1,"transition":true},"line-color":{"type":"color","doc":"The color with which the line will be drawn.","default":"#000000","function":"interpolated","transition":true,"requires":[{"!":"line-image"}]},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","transition":true,"units":"pixels","doc":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"line-translate-anchor":{"type":"enum","function":"piecewise-constant","values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["line-translate"]},"line-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"Stroke thickness."},"line-gap-width":{"type":"number","default":0,"minimum":0,"doc":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.","function":"interpolated","transition":true,"units":"pixels"},"line-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"Blur applied to the line, in pixels."},"line-dasharray":{"type":"array","function":"piecewise-constant","value":"number","doc":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-image"}]},"line-image":{"type":"string","function":"piecewise-constant","transition":true,"doc":"Name of image in sprite to use for drawing image lines."}},"paint_symbol":{"icon-opacity":{"doc":"The opacity at which the icon will be drawn.","type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","transition":true,"requires":["icon-image"]},"icon-size":{"type":"number","default":1,"function":"interpolated","transition":true,"doc":"Scale factor for icon. 1 is original size, 3 triples the size.","requires":["icon-image"]},"icon-color":{"type":"color","default":"#000000","function":"interpolated","transition":true,"doc":"The color of the icon. This can only be used with sdf icons.","requires":["icon-image"]},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","transition":true,"doc":"The color of the icon's halo. Icon halos can only be used with sdf icons.","requires":["icon-image"]},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"Distance of halo to the icon outline.","requires":["icon-image"]},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"Fade out the halo towards the outside.","requires":["icon-image"]},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","transition":true,"units":"pixels","doc":"An icon's offset distance. Values are [x, y] where negatives indicate left and up, respectively.","requires":["icon-image"]},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["icon-image","icon-translate"]},"text-opacity":{"type":"number","doc":"The opacity at which the text will be drawn.","default":1,"minimum":0,"maximum":1,"function":"interpolated","transition":true,"requires":["text-field"]},"text-size":{"type":"number","default":16,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"Font size. If unspecified, the text will be as big as allowed by the layer definition.","requires":["text-field"]},"text-color":{"type":"color","doc":"The color with which the text will be drawn.","default":"#000000","function":"interpolated","transition":true,"requires":["text-field"]},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","transition":true,"doc":"The color of the text's halo, which helps it stand out from backgrounds.","requires":["text-field"]},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.","requires":["text-field"]},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","transition":true,"units":"pixels","doc":"The halo's fadeout distance towards the outside.","requires":["text-field"]},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","transition":true,"units":"pixels","doc":"Label offset. Values are [x, y] where negatives indicate left and up, respectively.","requires":["text-field"]},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","values":["map","viewport"],"doc":"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map","requires":["text-field","text-translate"]}},"paint_raster":{"raster-opacity":{"type":"number","doc":"The opacity at which the image will be drawn.","default":1,"minimum":0,"maximum":1,"function":"interpolated","transition":true},"raster-hue-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","transition":true,"units":"degrees","doc":"Rotates hues around the color wheel."},"raster-brightness-min":{"type":"number","function":"interpolated","doc":"Increase or reduce the brightness of the image. The value is the minimum brightness.","default":0,"minimum":0,"maximum":1,"transition":true},"raster-brightness-max":{"type":"number","function":"interpolated","doc":"Increase or reduce the brightness of the image. The value is the maximum brightness.","default":1,"minimum":0,"maximum":1,"transition":true},"raster-saturation":{"type":"number","doc":"Increase or reduce the saturation of the image.","default":0,"minimum":-1,"maximum":1,"function":"interpolated","transition":true},"raster-contrast":{"type":"number","doc":"Increase or reduce the contrast of the image.","default":0,"minimum":-1,"maximum":1,"function":"interpolated","transition":true},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"function":"interpolated","transition":true,"units":"milliseconds","doc":"Fade duration when a new tile is added."}},"paint_background":{"background-color":{"type":"color","default":"#000000","doc":"The color with which the background will be drawn.","function":"interpolated","transition":true,"requires":[{"!":"background-image"}]},"background-image":{"type":"string","function":"piecewise-constant","transition":true,"doc":"Optionally an image which is drawn as the background."},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"doc":"The opacity at which the background will be drawn.","function":"interpolated","transition":true}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds","doc":"Time allotted for transitions to complete."},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds","doc":"Length of time before a transition begins."}}}
},{}],101:[function(require,module,exports){
"use strict";function Buffer(t){var e;t&&t.length&&(e=t,t=e.length);var r=new Uint8Array(t||0);return e&&r.set(e),r.readUInt32LE=BufferMethods.readUInt32LE,r.writeUInt32LE=BufferMethods.writeUInt32LE,r.readInt32LE=BufferMethods.readInt32LE,r.writeInt32LE=BufferMethods.writeInt32LE,r.readFloatLE=BufferMethods.readFloatLE,r.writeFloatLE=BufferMethods.writeFloatLE,r.readDoubleLE=BufferMethods.readDoubleLE,r.writeDoubleLE=BufferMethods.writeDoubleLE,r.toString=BufferMethods.toString,r.write=BufferMethods.write,r.slice=BufferMethods.slice,r.copy=BufferMethods.copy,r._isBuffer=!0,r}function encodeString(t){for(var e,r,n=t.length,i=[],o=0;n>o;o++){if(e=t.charCodeAt(o),e>55295&&57344>e){if(!r){e>56319||o+1===n?i.push(239,191,189):r=e;continue}if(56320>e){i.push(239,191,189),r=e;continue}e=r-55296<<10|e-56320|65536,r=null}else r&&(i.push(239,191,189),r=null);128>e?i.push(e):2048>e?i.push(e>>6|192,63&e|128):65536>e?i.push(e>>12|224,e>>6&63|128,63&e|128):i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return i}module.exports=Buffer;var ieee754=require("ieee754"),BufferMethods,lastStr,lastStrEncoded;BufferMethods={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return ieee754.read(this,t,!0,23,4)},readDoubleLE:function(t){return ieee754.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return ieee754.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return ieee754.write(this,t,e,!0,52,8)},toString:function(t,e,r){var n="",i="";e=e||0,r=Math.min(this.length,r||this.length);for(var o=e;r>o;o++){var u=this[o];127>=u?(n+=decodeURIComponent(i)+String.fromCharCode(u),i=""):i+="%"+u.toString(16)}return n+=decodeURIComponent(i)},write:function(t,e){for(var r=t===lastStr?lastStrEncoded:encodeString(t),n=0;n<r.length;n++)this[e+n]=r[n]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var r=0;r<this.length;r++)t[e+r]=this[r]}},BufferMethods.writeInt32LE=BufferMethods.writeUInt32LE,Buffer.byteLength=function(t){return lastStr=t,lastStrEncoded=encodeString(t),lastStrEncoded.length},Buffer.isBuffer=function(t){return!(!t||!t._isBuffer)};
},{"ieee754":103}],102:[function(require,module,exports){
(function (global){
"use strict";function Pbf(t){this.buf=Buffer.isBuffer(t)?t:new Buffer(t||0),this.pos=0,this.length=this.buf.length}function writePackedVarint(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function writePackedSVarint(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function writePackedFloat(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function writePackedDouble(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function writePackedBoolean(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function writePackedFixed32(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function writePackedSFixed32(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function writePackedFixed64(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function writePackedSFixed64(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32;Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),s=r>>3,n=this.pos;t(s,i,this),this.pos===n&&this.skip(r)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,i,e,r,s,n,o=this.buf;if(e=o[this.pos++],128>e)return e;if(e=127&e,r=o[this.pos++],128>r)return e|r<<7;if(r=(127&r)<<7,s=o[this.pos++],128>s)return e|r|s<<14;if(s=(127&s)<<14,n=o[this.pos++],128>n)return e|r|s|n<<21;if(t=e|r|s|(127&n)<<21,i=o[this.pos++],t+=268435456*(127&i),128>i)return t;if(i=o[this.pos++],t+=34359738368*(127&i),128>i)return t;if(i=o[this.pos++],t+=4398046511104*(127&i),128>i)return t;if(i=o[this.pos++],t+=562949953421312*(127&i),128>i)return t;if(i=o[this.pos++],t+=72057594037927940*(127&i),128>i)return t;if(i=o[this.pos++],t+=0x8000000000000000*(127&i),128>i)return t;throw new Error("Expected varint not more than 10 bytes")},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=this.buf.toString("utf8",this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.slice(this.pos,t);return this.pos=t,i},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readVarint());return i},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,i=[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(t){var i=7&t;if(i===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(i===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Pbf.Fixed32)this.pos+=4;else{if(i!==Pbf.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var e=new Buffer(i);this.buf.copy(e),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeUInt32LE(Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeInt32LE(Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t,127>=t)this.realloc(1),this.buf[this.pos++]=t;else if(16383>=t)this.realloc(2),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127;else if(2097151>=t)this.realloc(3),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127|128,this.buf[this.pos++]=t>>>14&127;else if(268435455>=t)this.realloc(4),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127|128,this.buf[this.pos++]=t>>>14&127|128,this.buf[this.pos++]=t>>>21&127;else{for(var i=this.pos;t>=128;)this.realloc(1),this.buf[this.pos++]=255&t|128,t/=128;if(this.realloc(1),this.buf[this.pos++]=0|t,this.pos-i>10)throw new Error("Given varint doesn't fit into 10 bytes")}},writeSVarint:function(t){this.writeVarint(0>t?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var i=Buffer.byteLength(t);this.writeVarint(i),this.realloc(i),this.buf.write(t,this.pos),this.pos+=i},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;i>e;e++)this.buf[this.pos++]=t[e]},writeMessage:function(t,i,e){this.writeTag(t,Pbf.Bytes),this.pos++;var r=this.pos;i(e,this);var s=this.pos-r,n=127>=s?1:16383>=s?2:2097151>=s?3:268435455>=s?4:Math.ceil(Math.log(s)/(7*Math.LN2));if(n>1){this.realloc(n-1);for(var o=this.pos-1;o>=r;o--)this.buf[o+n-1]=this.buf[o]}this.pos=r-1,this.writeVarint(s),this.pos+=s},writePackedVarint:function(t,i){this.writeMessage(t,writePackedVarint,i)},writePackedSVarint:function(t,i){this.writeMessage(t,writePackedSVarint,i)},writePackedBoolean:function(t,i){this.writeMessage(t,writePackedBoolean,i)},writePackedFloat:function(t,i){this.writeMessage(t,writePackedFloat,i)},writePackedDouble:function(t,i){this.writeMessage(t,writePackedDouble,i)},writePackedFixed32:function(t,i){this.writeMessage(t,writePackedFixed32,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,writePackedSFixed32,i)},writePackedFixed64:function(t,i){this.writeMessage(t,writePackedFixed64,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,writePackedSFixed64,i)},writeBytesField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./buffer":101}],103:[function(require,module,exports){
exports.read=function(o,t,a,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,n=a?h-1:0,s=a?-1:1,N=o[t+n];for(n+=s,M=N&(1<<-i)-1,N>>=-i,i+=w;i>0;M=256*M+o[t+n],n+=s,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+o[t+n],n+=s,i-=8);if(0===M)M=1-e;else{if(M===f)return p?0/0:1/0*(N?-1:1);p+=Math.pow(2,r),M-=e}return(N?-1:1)*p*Math.pow(2,M-r)},exports.write=function(o,t,a,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,n=i>>1,s=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,N=r?0:M-1,u=r?1:-1,l=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(w=isNaN(t)?1:0,p=i):(p=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-p))<1&&(p--,f*=2),t+=p+n>=1?s/f:s*Math.pow(2,1-n),t*f>=2&&(p++,f/=2),p+n>=i?(w=0,p=i):p+n>=1?(w=(t*f-1)*Math.pow(2,h),p+=n):(w=t*Math.pow(2,n-1)*Math.pow(2,h),p=0));h>=8;o[a+N]=255&w,N+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;o[a+N]=255&p,N+=u,p/=256,e-=8);o[a+N-u]|=128*l};
},{}],104:[function(require,module,exports){
"use strict";function Point(t,n){this.x=t,this.y=n}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),i=Math.sin(t),s=n*this.x-i*this.y,r=i*this.x+n*this.y;return this.x=s,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t};
},{}],105:[function(require,module,exports){
!function(){"use strict";function t(i,n){return this instanceof t?(this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&this._initFormat(n),void this.clear()):new t(i,n)}function i(t,i){t.bbox=n(t,0,t.children.length,i)}function n(t,i,n,r){for(var o,a=h(),s=i;n>s;s++)o=t.children[s],e(a,t.leaf?r(o):o.bbox);return a}function h(){return[1/0,1/0,-1/0,-1/0]}function e(t,i){return t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.max(t[2],i[2]),t[3]=Math.max(t[3],i[3]),t}function r(t,i){return t.bbox[0]-i.bbox[0]}function o(t,i){return t.bbox[1]-i.bbox[1]}function a(t){return(t[2]-t[0])*(t[3]-t[1])}function s(t){return t[2]-t[0]+(t[3]-t[1])}function l(t,i){return(Math.max(i[2],t[2])-Math.min(i[0],t[0]))*(Math.max(i[3],t[3])-Math.min(i[1],t[1]))}function u(t,i){var n=Math.max(t[0],i[0]),h=Math.max(t[1],i[1]),e=Math.min(t[2],i[2]),r=Math.min(t[3],i[3]);return Math.max(0,e-n)*Math.max(0,r-h)}function c(t,i){return t[0]<=i[0]&&t[1]<=i[1]&&i[2]<=t[2]&&i[3]<=t[3]}function f(t,i){return i[0]<=t[2]&&i[1]<=t[3]&&i[2]>=t[0]&&i[3]>=t[1]}function d(t,i,n,h,e){for(var r,o=[i,n];o.length;)n=o.pop(),i=o.pop(),h>=n-i||(r=i+Math.ceil((n-i)/h/2)*h,x(t,i,n,r,e),o.push(i,r,r,n))}function x(t,i,n,h,e){for(var r,o,a,s,l,u,c,f,d;n>i;){for(n-i>600&&(r=n-i+1,o=h-i+1,a=Math.log(r),s=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*s*(r-s)/r)*(0>o-r/2?-1:1),u=Math.max(i,Math.floor(h-o*s/r+l)),c=Math.min(n,Math.floor(h+(r-o)*s/r+l)),x(t,u,c,h,e)),f=t[h],o=i,d=n,p(t,i,h),e(t[n],f)>0&&p(t,i,n);d>o;){for(p(t,o,d),o++,d--;e(t[o],f)<0;)o++;for(;e(t[d],f)>0;)d--}0===e(t[i],f)?p(t,i,d):(d++,p(t,d,n)),h>=d&&(i=d+1),d>=h&&(n=d-1)}}function p(t,i,n){var h=t[i];t[i]=t[n],t[n]=h}t.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],h=this.toBBox;if(!f(t,i.bbox))return n;for(var e,r,o,a,s=[];i;){for(e=0,r=i.children.length;r>e;e++)o=i.children[e],a=i.leaf?h(o):o.bbox,f(t,a)&&(i.leaf?n.push(o):c(t,a)?this._all(o,n):s.push(o));i=s.pop()}return n},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;n>i;i++)this.insert(t[i]);return this}var h=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var e=this.data;this.data=h,h=e}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:h(),leaf:!0},this},remove:function(t){if(!t)return this;for(var i,n,h,e,r=this.data,o=this.toBBox(t),a=[],s=[];r||a.length;){if(r||(r=a.pop(),n=a[a.length-1],i=s.pop(),e=!0),r.leaf&&(h=r.children.indexOf(t),-1!==h))return r.children.splice(h,1),a.push(r),this._condense(a),this;e||r.leaf||!c(r.bbox,o)?n?(i++,r=n.children[i],e=!1):r=null:(a.push(r),s.push(i),i=0,n=r,r=r.children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,i){return t[0]-i[0]},compareMinY:function(t,i){return t[1]-i[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,n,h,e){var r,o=h-n+1,a=this._maxEntries;if(a>=o)return r={children:t.slice(n,h+1),height:1,bbox:null,leaf:!0},i(r,this.toBBox),r;e||(e=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,e-1))),r={children:[],height:e,bbox:null};var s,l,u,c,f=Math.ceil(o/a),x=f*Math.ceil(Math.sqrt(a));for(d(t,n,h,x,this.compareMinX),s=n;h>=s;s+=x)for(u=Math.min(s+x-1,h),d(t,s,u,f,this.compareMinY),l=s;u>=l;l+=f)c=Math.min(l+f-1,u),r.children.push(this._build(t,l,c,e-1));return i(r,this.toBBox),r},_chooseSubtree:function(t,i,n,h){for(var e,r,o,s,u,c,f,d;;){if(h.push(i),i.leaf||h.length-1===n)break;for(f=d=1/0,e=0,r=i.children.length;r>e;e++)o=i.children[e],u=a(o.bbox),c=l(t,o.bbox)-u,d>c?(d=c,f=f>u?u:f,s=o):c===d&&f>u&&(f=u,s=o);i=s}return i},_insert:function(t,i,n){var h=this.toBBox,r=n?t.bbox:h(t),o=[],a=this._chooseSubtree(r,this.data,i,o);for(a.children.push(t),e(a.bbox,r);i>=0&&o[i].children.length>this._maxEntries;)this._split(o,i),i--;this._adjustParentBBoxes(r,o,i)},_split:function(t,n){var h=t[n],e=h.children.length,r=this._minEntries;this._chooseSplitAxis(h,r,e);var o={children:h.children.splice(this._chooseSplitIndex(h,r,e)),height:h.height};h.leaf&&(o.leaf=!0),i(h,this.toBBox),i(o,this.toBBox),n?t[n-1].children.push(o):this._splitRoot(h,o)},_splitRoot:function(t,n){this.data={children:[t,n],height:t.height+1},i(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,h){var e,r,o,s,l,c,f,d;for(c=f=1/0,e=i;h-i>=e;e++)r=n(t,0,e,this.toBBox),o=n(t,e,h,this.toBBox),s=u(r,o),l=a(r)+a(o),c>s?(c=s,d=e,f=f>l?l:f):s===c&&f>l&&(f=l,d=e);return d},_chooseSplitAxis:function(t,i,n){var h=t.leaf?this.compareMinX:r,e=t.leaf?this.compareMinY:o,a=this._allDistMargin(t,i,n,h),s=this._allDistMargin(t,i,n,e);s>a&&t.children.sort(h)},_allDistMargin:function(t,i,h,r){t.children.sort(r);var o,a,l=this.toBBox,u=n(t,0,i,l),c=n(t,h-i,h,l),f=s(u)+s(c);for(o=i;h-i>o;o++)a=t.children[o],e(u,t.leaf?l(a):a.bbox),f+=s(u);for(o=h-i-1;o>=i;o--)a=t.children[o],e(c,t.leaf?l(a):a.bbox),f+=s(c);return f},_adjustParentBBoxes:function(t,i,n){for(var h=n;h>=0;h--)e(i[h].bbox,t)},_condense:function(t){for(var n,h=t.length-1;h>=0;h--)0===t[h].children.length?h>0?(n=t[h-1].children,n.splice(n.indexOf(t[h]),1)):this.clear():i(t[h],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},"function"==typeof define&&define.amd?define("rbush",function(){return t}):"undefined"!=typeof module?module.exports=t:"undefined"!=typeof self?self.rbush=t:window.rbush=t}();
},{}],106:[function(require,module,exports){
function UnitBezier(t,i,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(r-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=e,this.p2y=r}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(t,i){"undefined"==typeof i&&(i=1e-6);var e,r,s,h,n;for(s=t,n=0;8>n;n++){if(h=this.sampleCurveX(s)-t,Math.abs(h)<i)return s;var u=this.sampleCurveDerivativeX(s);if(Math.abs(u)<1e-6)break;s-=h/u}if(e=0,r=1,s=t,e>s)return e;if(s>r)return r;for(;r>e;){if(h=this.sampleCurveX(s),Math.abs(h-t)<i)return s;t>h?e=s:r=s,s=.5*(r-e)+e}return s},UnitBezier.prototype.solve=function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))};
},{}],107:[function(require,module,exports){
module.exports.VectorTile=require("./lib/vectortile.js"),module.exports.VectorTileFeature=require("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=require("./lib/vectortilelayer.js");
},{"./lib/vectortile.js":108,"./lib/vectortilefeature.js":109,"./lib/vectortilelayer.js":110}],108:[function(require,module,exports){
"use strict";function VectorTile(e,r){this.layers=e.readFields(readTile,{},r)}function readTile(e,r,a){if(3===e){var i=readLayer(a);i.length&&(r[i.name]=i)}}function readLayer(e){var r=e.readVarint(),a=e.pos+r,i=new VectorTileLayer(e,a);return e.pos=a,i}var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile;
},{"./vectortilelayer":110}],109:[function(require,module,exports){
"use strict";function VectorTileFeature(e,t,r,i,o){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=o,e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t._id=r.readVarint():2==e?readTag(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function readTag(e,t){for(var r=e.readVarint(),i=e.pos+r;e.pos<i;){var o=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[o]=a}}var Point=require("point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint(),i=e.pos+r,o=1,a=0,n=0,s=0,p=[];e.pos<i;){if(!a){var h=e.readVarint();o=7&h,a=h>>3}if(a--,1===o||2===o)n+=e.readSVarint(),s+=e.readSVarint(),1===o&&(t&&p.push(t),t=[]),t.push(new Point(n,s));else{if(7!==o)throw new Error("unknown command "+o);t.push(t[0].clone())}}return t&&p.push(t),p},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint(),r=e.pos+t,i=1,o=0,a=0,n=0,s=1/0,p=-1/0,h=1/0,u=-1/0;e.pos<r;){if(!o){var d=e.readVarint();i=7&d,o=d>>3}if(o--,1===i||2===i)a+=e.readSVarint(),n+=e.readSVarint(),s>a&&(s=a),a>p&&(p=a),h>n&&(h=n),n>u&&(u=n);else if(7!==i)throw new Error("unknown command "+i)}return[s,h,p,u]},VectorTileFeature.prototype.toGeoJSON=function(e,t,r){for(var i=this.extent*Math.pow(2,r),o=this.extent*e,a=this.extent*t,n=this.loadGeometry(),s=VectorTileFeature.types[this.type],p=0;p<n.length;p++)for(var h=n[p],u=0;u<h.length;u++){var d=h[u],l=180-360*(d.y+a)/i;h[u]=[360*(d.x+o)/i-180,360/Math.PI*Math.atan(Math.exp(l*Math.PI/180))-90]}return"Point"===s&&1===n.length?n=n[0][0]:"Point"===s?(n=n[0],s="MultiPoint"):"LineString"===s&&1===n.length?n=n[0]:"LineString"===s&&(s="MultiLineString"),{type:"Feature",geometry:{type:s,coordinates:n},properties:this.properties}};
},{"point-geometry":104}],110:[function(require,module,exports){
"use strict";function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage(r))}function readValueMessage(e){for(var t=null,r=e.readVarint(),a=e.pos+r;e.pos<a;){var s=e.readVarint()>>3;t=1===s?e.readString():2===s?e.readFloat():3===s?e.readDouble():4===s||5===s?e.readVarint():6===s?e.readSVarint():7===s?Boolean(e.readVarint()):null}return t}var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(0>e||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values)};
},{"./vectortilefeature.js":109}]},{},[20])


//# sourceMappingURL=mapbox-gl.js.map